This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.editorconfig
.env.example
.gitattributes
.gitignore
app/Http/Controllers/Auth/AuthenticatedSessionController.php
app/Http/Controllers/Auth/ConfirmablePasswordController.php
app/Http/Controllers/Auth/EmailVerificationNotificationController.php
app/Http/Controllers/Auth/EmailVerificationPromptController.php
app/Http/Controllers/Auth/NewPasswordController.php
app/Http/Controllers/Auth/PasswordController.php
app/Http/Controllers/Auth/PasswordResetLinkController.php
app/Http/Controllers/Auth/RegisteredUserController.php
app/Http/Controllers/Auth/VerifyEmailController.php
app/Http/Controllers/Controller.php
app/Http/Controllers/ProfileController.php
app/Http/Middleware/HandleInertiaRequests.php
app/Http/Requests/Auth/LoginRequest.php
app/Http/Requests/ProfileUpdateRequest.php
app/Models/User.php
app/Observers/ProductObserver.php
app/Observers/UserObserver.php
app/Observers/VehiculoObserver.php
app/Observers/WorkOrderObserver.php
app/Policies/VehiculoPolicy.php
app/Providers/AppServiceProvider.php
artisan
bootstrap/app.php
bootstrap/cache/.gitignore
bootstrap/providers.php
composer.json
config/app.php
config/auth.php
config/cache.php
config/database.php
config/filesystems.php
config/logging.php
config/mail.php
config/permission.php
config/queue.php
config/services.php
config/session.php
database/.gitignore
database/factories/ProductFactory.php
database/factories/SupplierFactory.php
database/factories/UserFactory.php
database/factories/VehiculoFactory.php
database/migrations/0001_01_01_000000_create_users_table.php
database/migrations/0001_01_01_000001_create_cache_table.php
database/migrations/0001_01_01_000002_create_jobs_table.php
database/migrations/2025_11_03_130548_create_permission_tables.php
database/migrations/2025_11_04_010930_create_vehiculos_table.php
database/migrations/2025_11_04_193207_create_suppliers_table.php
database/migrations/2025_11_04_193251_create_products_table.php
database/migrations/2025_11_04_193421_create_product_supplier_table.php
database/migrations/2025_11_04_193514_create_inventory_movements_table.php
database/migrations/2025_11_06_010312_create_work_orders_table.php
database/migrations/2025_11_06_010608_create_work_order_product_table.php
database/migrations/2025_11_06_015636_create_services_table.php
database/migrations/2025_11_06_015800_create_work_order_service_table.php
database/migrations/2025_11_06_015847_create_external_costs_table.php
database/migrations/2025_11_06_224559_create_daily_capacities_table.php
database/migrations/2025_11_06_224636_create_reservations_table.php
database/seeders/DatabaseSeeder.php
database/seeders/DemoSeeder.php
jsconfig.json
lang/es.json
lang/es/actions.php
lang/es/auth.php
lang/es/http-statuses.php
lang/es/pagination.php
lang/es/passwords.php
lang/es/validation.php
package.json
phpunit.xml
postcss.config.js
public/.htaccess
public/favicon.ico
public/images/logo-dark.png
public/images/logo-light.png
public/index.php
public/robots.txt
README.md
resources/css/app.css
resources/js/app.js
resources/js/bootstrap.js
resources/js/Components/ApplicationLogo.vue
resources/js/Components/Checkbox.vue
resources/js/Components/ConfirmationModal.vue
resources/js/Components/DangerButton.vue
resources/js/Components/Dropdown.vue
resources/js/Components/DropdownLink.vue
resources/js/Components/FlashMessage.vue
resources/js/Components/InputError.vue
resources/js/Components/InputLabel.vue
resources/js/Components/Modal.vue
resources/js/Components/NavLink.vue
resources/js/Components/Pagination.vue
resources/js/Components/PrimaryButton.vue
resources/js/Components/ResponsiveNavLink.vue
resources/js/Components/SecondaryButton.vue
resources/js/Components/Sidebar.vue
resources/js/Components/TextInput.vue
resources/js/Layouts/AuthenticatedLayout.vue
resources/js/Layouts/GuestLayout.vue
resources/js/Pages/Auth/ConfirmPassword.vue
resources/js/Pages/Auth/ForgotPassword.vue
resources/js/Pages/Auth/Login.vue
resources/js/Pages/Auth/Register.vue
resources/js/Pages/Auth/ResetPassword.vue
resources/js/Pages/Auth/VerifyEmail.vue
resources/js/Pages/ClientPortal/Dashboard.vue
resources/js/Pages/ClientPortal/Vehicles/Create.vue
resources/js/Pages/ClientPortal/Vehicles/Edit.vue
resources/js/Pages/ClientPortal/Vehicles/Index.vue
resources/js/Pages/Crm/Clientes/Create.vue
resources/js/Pages/Crm/Clientes/Edit.vue
resources/js/Pages/Crm/Clientes/Index.vue
resources/js/Pages/Crm/Clientes/Show.vue
resources/js/Pages/Crm/Vehiculos/Create.vue
resources/js/Pages/Crm/Vehiculos/Edit.vue
resources/js/Pages/Dashboard.vue
resources/js/Pages/Inventory/Products/Create.vue
resources/js/Pages/Inventory/Products/Edit.vue
resources/js/Pages/Inventory/Products/Index.vue
resources/js/Pages/Inventory/Suppliers/Create.vue
resources/js/Pages/Inventory/Suppliers/Edit.vue
resources/js/Pages/Inventory/Suppliers/Index.vue
resources/js/Pages/MechanicPanel/Dashboard.vue
resources/js/Pages/Profile/Edit.vue
resources/js/Pages/Profile/Partials/DeleteUserForm.vue
resources/js/Pages/Profile/Partials/UpdatePasswordForm.vue
resources/js/Pages/Profile/Partials/UpdateProfileInformationForm.vue
resources/js/Pages/Scheduling/Admin/CapacityIndex.vue
resources/js/Pages/Welcome.vue
resources/js/Pages/WorkManagement/Create.vue
resources/js/Pages/WorkManagement/Index.vue
resources/js/Pages/WorkManagement/Show.vue
resources/js/ziggy.js
resources/views/app.blade.php
routes/auth.php
routes/console.php
src/ClientPortal/Http/Controllers/DashboardController.php
src/ClientPortal/Http/Controllers/VehiculoController.php
src/ClientPortal/Providers/ClientPortalServiceProvider.php
src/ClientPortal/routes/web.php
src/ClientScheduling/Http/Controllers/BookingController.php
src/ClientScheduling/Providers/ClientSchedulingServiceProvider.php
src/ClientScheduling/routes/web.php
src/Core/Providers/CoreServiceProvider.php
src/Core/routes/web.php
src/Crm/Actions/CreateUserAsClientAction.php
src/Crm/Http/Controllers/CrmController.php
src/Crm/Http/Controllers/VehiculoController.php
src/Crm/Http/Requests/StoreUserAsClientRequest.php
src/Crm/Http/Requests/UpdateUserAsClientRequest.php
src/Crm/Http/Requests/UpdateVehiculoRequest.php
src/Crm/Models/Vehiculo.php
src/Crm/Providers/CrmServiceProvider.php
src/Crm/routes/web.php
src/Inventory/Actions/ActualizarProductoAction.php
src/Inventory/Actions/CrearNuevoProductoAction.php
src/Inventory/Http/Controllers/ProductController.php
src/Inventory/Http/Controllers/SupplierController.php
src/Inventory/Http/Requests/StoreProductRequest.php
src/Inventory/Http/Requests/StoreSupplierRequest.php
src/Inventory/Http/Requests/UpdateProductRequest.php
src/Inventory/Http/Requests/UpdateSupplierRequest.php
src/Inventory/Models/InventoryMovement.php
src/Inventory/Models/Product.php
src/Inventory/Models/Supplier.php
src/Inventory/Providers/InventoryServiceProvider.php
src/Inventory/routes/web.php
src/MechanicPanel/Http/Controllers/DashboardController.php
src/MechanicPanel/Providers/MechanicPanelServiceProvider.php
src/MechanicPanel/routes/web.php
src/Scheduling/Http/Controllers/CapacityController.php
src/Scheduling/Models/DailyCapacity.php
src/Scheduling/Models/Reservation.php
src/Scheduling/Providers/SchedulingServiceProvider.php
src/Scheduling/routes/admin.php
src/WorkManagement/Http/Controllers/WorkOrderController.php
src/WorkManagement/Models/ExternalCost.php
src/WorkManagement/Models/Service.php
src/WorkManagement/Models/WorkOrder.php
src/WorkManagement/Providers/WorkManagementServiceProvider.php
src/WorkManagement/routes/web.php
storage/app/.gitignore
storage/app/private/.gitignore
storage/app/public/.gitignore
storage/framework/.gitignore
storage/framework/cache/.gitignore
storage/framework/cache/data/.gitignore
storage/framework/sessions/.gitignore
storage/framework/testing/.gitignore
storage/framework/views/.gitignore
storage/logs/.gitignore
tailwind.config.js
tests/Feature/Auth/AuthenticationTest.php
tests/Feature/Auth/EmailVerificationTest.php
tests/Feature/Auth/PasswordConfirmationTest.php
tests/Feature/Auth/PasswordResetTest.php
tests/Feature/Auth/PasswordUpdateTest.php
tests/Feature/Auth/RegistrationTest.php
tests/Feature/ExampleTest.php
tests/Feature/ProfileTest.php
tests/TestCase.php
tests/Unit/ExampleTest.php
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".editorconfig">
root = true

[*]
charset = utf-8
end_of_line = lf
indent_size = 4
indent_style = space
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false

[*.{yml,yaml}]
indent_size = 2

[compose.yaml]
indent_size = 4
</file>

<file path=".env.example">
APP_NAME=Laravel
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://localhost

APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

APP_MAINTENANCE_DRIVER=file
# APP_MAINTENANCE_STORE=database

# PHP_CLI_SERVER_WORKERS=4

BCRYPT_ROUNDS=12

LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

DB_CONNECTION=sqlite
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_DATABASE=laravel
# DB_USERNAME=root
# DB_PASSWORD=

SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local
QUEUE_CONNECTION=database

CACHE_STORE=database
# CACHE_PREFIX=

MEMCACHED_HOST=127.0.0.1

REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379

MAIL_MAILER=log
MAIL_SCHEME=null
MAIL_HOST=127.0.0.1
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

VITE_APP_NAME="${APP_NAME}"
</file>

<file path=".gitattributes">
* text=auto eol=lf

*.blade.php diff=html
*.css diff=css
*.html diff=html
*.md diff=markdown
*.php diff=php

/.github export-ignore
CHANGELOG.md export-ignore
.styleci.yml export-ignore
</file>

<file path=".gitignore">
*.log
.DS_Store
.env
.env.backup
.env.production
.phpactor.json
.phpunit.result.cache
/.fleet
/.idea
/.nova
/.phpunit.cache
/.vscode
/.zed
/auth.json
/node_modules
/public/build
/public/hot
/public/storage
/storage/*.key
/storage/pail
/vendor
Homestead.json
Homestead.yaml
Thumbs.db
</file>

<file path="app/Http/Controllers/Auth/ConfirmablePasswordController.php">
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\ValidationException;
use Inertia\Inertia;
use Inertia\Response;

class ConfirmablePasswordController extends Controller
{
    /**
     * Show the confirm password view.
     */
    public function show(): Response
    {
        return Inertia::render('Auth/ConfirmPassword');
    }

    /**
     * Confirm the user's password.
     */
    public function store(Request $request): RedirectResponse
    {
        if (! Auth::guard('web')->validate([
            'email' => $request->user()->email,
            'password' => $request->password,
        ])) {
            throw ValidationException::withMessages([
                'password' => __('auth.password'),
            ]);
        }

        $request->session()->put('auth.password_confirmed_at', time());

        return redirect()->intended(route('dashboard', absolute: false));
    }
}
</file>

<file path="app/Http/Controllers/Auth/EmailVerificationNotificationController.php">
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;

class EmailVerificationNotificationController extends Controller
{
    /**
     * Send a new email verification notification.
     */
    public function store(Request $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(route('dashboard', absolute: false));
        }

        $request->user()->sendEmailVerificationNotification();

        return back()->with('status', 'verification-link-sent');
    }
}
</file>

<file path="app/Http/Controllers/Auth/EmailVerificationPromptController.php">
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Inertia\Inertia;
use Inertia\Response;

class EmailVerificationPromptController extends Controller
{
    /**
     * Display the email verification prompt.
     */
    public function __invoke(Request $request): RedirectResponse|Response
    {
        return $request->user()->hasVerifiedEmail()
                    ? redirect()->intended(route('dashboard', absolute: false))
                    : Inertia::render('Auth/VerifyEmail', ['status' => session('status')]);
    }
}
</file>

<file path="app/Http/Controllers/Auth/NewPasswordController.php">
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Auth\Events\PasswordReset;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Password;
use Illuminate\Support\Str;
use Illuminate\Validation\Rules;
use Illuminate\Validation\ValidationException;
use Inertia\Inertia;
use Inertia\Response;

class NewPasswordController extends Controller
{
    /**
     * Display the password reset view.
     */
    public function create(Request $request): Response
    {
        return Inertia::render('Auth/ResetPassword', [
            'email' => $request->email,
            'token' => $request->route('token'),
        ]);
    }

    /**
     * Handle an incoming new password request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'token' => 'required',
            'email' => 'required|email',
            'password' => ['required', 'confirmed', Rules\Password::defaults()],
        ]);

        // Here we will attempt to reset the user's password. If it is successful we
        // will update the password on an actual user model and persist it to the
        // database. Otherwise we will parse the error and return the response.
        $status = Password::reset(
            $request->only('email', 'password', 'password_confirmation', 'token'),
            function ($user) use ($request) {
                $user->forceFill([
                    'password' => Hash::make($request->password),
                    'remember_token' => Str::random(60),
                ])->save();

                event(new PasswordReset($user));
            }
        );

        // If the password was successfully reset, we will redirect the user back to
        // the application's home authenticated view. If there is an error we can
        // redirect them back to where they came from with their error message.
        if ($status == Password::PASSWORD_RESET) {
            return redirect()->route('login')->with('status', __($status));
        }

        throw ValidationException::withMessages([
            'email' => [trans($status)],
        ]);
    }
}
</file>

<file path="app/Http/Controllers/Auth/PasswordController.php">
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules\Password;

class PasswordController extends Controller
{
    /**
     * Update the user's password.
     */
    public function update(Request $request): RedirectResponse
    {
        $validated = $request->validate([
            'current_password' => ['required', 'current_password'],
            'password' => ['required', Password::defaults(), 'confirmed'],
        ]);

        $request->user()->update([
            'password' => Hash::make($validated['password']),
        ]);

        return back();
    }
}
</file>

<file path="app/Http/Controllers/Auth/PasswordResetLinkController.php">
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Password;
use Illuminate\Validation\ValidationException;
use Inertia\Inertia;
use Inertia\Response;

class PasswordResetLinkController extends Controller
{
    /**
     * Display the password reset link request view.
     */
    public function create(): Response
    {
        return Inertia::render('Auth/ForgotPassword', [
            'status' => session('status'),
        ]);
    }

    /**
     * Handle an incoming password reset link request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'email' => 'required|email',
        ]);

        // We will send the password reset link to this user. Once we have attempted
        // to send the link, we will examine the response then see the message we
        // need to show to the user. Finally, we'll send out a proper response.
        $status = Password::sendResetLink(
            $request->only('email')
        );

        if ($status == Password::RESET_LINK_SENT) {
            return back()->with('status', __($status));
        }

        throw ValidationException::withMessages([
            'email' => [trans($status)],
        ]);
    }
}
</file>

<file path="app/Http/Controllers/Auth/VerifyEmailController.php">
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use Illuminate\Auth\Events\Verified;
use Illuminate\Foundation\Auth\EmailVerificationRequest;
use Illuminate\Http\RedirectResponse;

class VerifyEmailController extends Controller
{
    /**
     * Mark the authenticated user's email address as verified.
     */
    public function __invoke(EmailVerificationRequest $request): RedirectResponse
    {
        if ($request->user()->hasVerifiedEmail()) {
            return redirect()->intended(route('dashboard', absolute: false).'?verified=1');
        }

        if ($request->user()->markEmailAsVerified()) {
            event(new Verified($request->user()));
        }

        return redirect()->intended(route('dashboard', absolute: false).'?verified=1');
    }
}
</file>

<file path="app/Http/Controllers/ProfileController.php">
<?php

namespace App\Http\Controllers;

use App\Http\Requests\ProfileUpdateRequest;
use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Redirect;
use Inertia\Inertia;
use Inertia\Response;

class ProfileController extends Controller
{
    /**
     * Display the user's profile form.
     */
    public function edit(Request $request): Response
    {
        return Inertia::render('Profile/Edit', [
            'mustVerifyEmail' => $request->user() instanceof MustVerifyEmail,
            'status' => session('status'),
        ]);
    }

    /**
     * Update the user's profile information.
     */
    public function update(ProfileUpdateRequest $request): RedirectResponse
    {
        $request->user()->fill($request->validated());

        if ($request->user()->isDirty('email')) {
            $request->user()->email_verified_at = null;
        }

        $request->user()->save();

        return Redirect::route('profile.edit');
    }

    /**
     * Delete the user's account.
     */
    public function destroy(Request $request): RedirectResponse
    {
        $request->validate([
            'password' => ['required', 'current_password'],
        ]);

        $user = $request->user();

        Auth::logout();

        $user->delete();

        $request->session()->invalidate();
        $request->session()->regenerateToken();

        return Redirect::to('/');
    }
}
</file>

<file path="app/Http/Requests/Auth/LoginRequest.php">
<?php

namespace App\Http\Requests\Auth;

use Illuminate\Auth\Events\Lockout;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Support\Str;
use Illuminate\Validation\ValidationException;

class LoginRequest extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     */
    public function authorize(): bool
    {
        return true;
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, \Illuminate\Contracts\Validation\ValidationRule|array<mixed>|string>
     */
    public function rules(): array
    {
        return [
            'email' => ['required', 'string', 'email'],
            'password' => ['required', 'string'],
        ];
    }

    /**
     * Attempt to authenticate the request's credentials.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function authenticate(): void
    {
        $this->ensureIsNotRateLimited();

        if (! Auth::attempt($this->only('email', 'password'), $this->boolean('remember'))) {
            RateLimiter::hit($this->throttleKey());

            throw ValidationException::withMessages([
                'email' => trans('auth.failed'),
            ]);
        }

        RateLimiter::clear($this->throttleKey());
    }

    /**
     * Ensure the login request is not rate limited.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function ensureIsNotRateLimited(): void
    {
        if (! RateLimiter::tooManyAttempts($this->throttleKey(), 5)) {
            return;
        }

        event(new Lockout($this));

        $seconds = RateLimiter::availableIn($this->throttleKey());

        throw ValidationException::withMessages([
            'email' => trans('auth.throttle', [
                'seconds' => $seconds,
                'minutes' => ceil($seconds / 60),
            ]),
        ]);
    }

    /**
     * Get the rate limiting throttle key for the request.
     */
    public function throttleKey(): string
    {
        return Str::transliterate(Str::lower($this->string('email')).'|'.$this->ip());
    }
}
</file>

<file path="app/Http/Requests/ProfileUpdateRequest.php">
<?php

namespace App\Http\Requests;

use App\Models\User;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Validation\Rule;

class ProfileUpdateRequest extends FormRequest
{
    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, \Illuminate\Contracts\Validation\ValidationRule|array<mixed>|string>
     */
    public function rules(): array
    {
        return [
            'name' => ['required', 'string', 'max:255'],
            'email' => [
                'required',
                'string',
                'lowercase',
                'email',
                'max:255',
                Rule::unique(User::class)->ignore($this->user()->id),
            ],
        ];
    }
}
</file>

<file path="app/Observers/ProductObserver.php">
<?php

namespace App\Observers;

use FlipperBox\Inventory\Models\Product;
use Illuminate\Validation\ValidationException;

class ProductObserver
{
    /**
     * Handle the Product "deleting" event.
     */
    public function deleting(Product $product): void
    {
        // Regla de negocio: No se puede eliminar (ni siquiera soft delete) un producto
        // si ya ha sido utilizado en CUALQUIER orden de trabajo.
        if ($product->workOrders()->exists()) {
            throw ValidationException::withMessages([
                'error' => 'No se puede eliminar este producto porque tiene un historial en órdenes de trabajo. Puede desactivarlo o archivarlo en una futura actualización.',
            ]);
        }
    }
}
</file>

<file path="app/Observers/UserObserver.php">
<?php

namespace App\Observers;

use App\Models\User;
use Illuminate\Validation\ValidationException;

class UserObserver
{
    /**
     * Handle the User "deleting" event.
     * Esta es una red de seguridad para cualquier intento de borrado.
     */
    public function deleting(User $user): void
    {
        // Regla de negocio universal: Un usuario no puede ser borrado si es dueño
        // de vehículos que tienen CUALQUIER orden de trabajo (historial).
        if ($user->vehiculos()->whereHas('workOrders')->exists()) {
            throw ValidationException::withMessages([
                'error' => 'No se puede eliminar este usuario porque tiene un historial de órdenes de trabajo asociadas.',
            ]);
        }
    }
}
</file>

<file path="app/Observers/VehiculoObserver.php">
<?php

namespace App\Observers;
use FlipperBox\Crm\Models\Vehiculo;
use Illuminate\Validation\ValidationException;

class VehiculoObserver
{
    /**
     * Handle the Vehiculo "deleting" event.
     */
    public function deleting(Vehiculo $vehiculo): void
    {
        // Regla de Negocio: No se puede eliminar un vehículo si tiene
        // órdenes de trabajo que están 'Pendiente' o 'En Progreso'.
        if ($vehiculo->workOrders()->whereIn('status', ['Pendiente', 'En Progreso'])->exists()) {
            throw ValidationException::withMessages([
                'error' => 'No se puede eliminar este vehículo porque tiene órdenes de trabajo activas. Por favor, complete o cancele esas órdenes primero.',
            ]);
        }

        // Si llegamos aquí, significa que todas las órdenes asociadas (si las hay)
        // ya están 'Completada' o 'Cancelada', por lo que es seguro hacer un Soft Delete.
    }
}
</file>

<file path="app/Observers/WorkOrderObserver.php">
<?php

namespace App\Observers;

use FlipperBox\Inventory\Models\Product;
use FlipperBox\WorkManagement\Models\WorkOrder;
use Illuminate\Support\Facades\DB;

class WorkOrderObserver
{
    /**
     * Handle the WorkOrder "deleting" event.
     * Red de seguridad final para devolver el stock.
     */
    public function deleting(WorkOrder $workOrder): void
    {
        // Solo devolvemos stock si la orden no estaba 'Completada'.
        // No se devuelve stock de trabajos finalizados y pagados.
        if ($workOrder->status !== 'Completada' && $workOrder->products()->exists()) {
            DB::transaction(function () use ($workOrder) {
                foreach ($workOrder->products as $product) {
                    // Usamos lockForUpdate para prevenir condiciones de carrera
                    $productInStock = Product::lockForUpdate()->find($product->id);
                    if ($productInStock) {
                        $productInStock->increment('current_stock', $product->pivot->quantity);
                    }
                }
            });
        }
    }
}
</file>

<file path="artisan">
#!/usr/bin/env php
<?php

use Illuminate\Foundation\Application;
use Symfony\Component\Console\Input\ArgvInput;

define('LARAVEL_START', microtime(true));

// Register the Composer autoloader...
require __DIR__.'/vendor/autoload.php';

// Bootstrap Laravel and handle the command...
/** @var Application $app */
$app = require_once __DIR__.'/bootstrap/app.php';

$status = $app->handleCommand(new ArgvInput);

exit($status);
</file>

<file path="bootstrap/cache/.gitignore">
*
!.gitignore
</file>

<file path="config/auth.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Authentication Defaults
    |--------------------------------------------------------------------------
    |
    | This option defines the default authentication "guard" and password
    | reset "broker" for your application. You may change these values
    | as required, but they're a perfect start for most applications.
    |
    */

    'defaults' => [
        'guard' => env('AUTH_GUARD', 'web'),
        'passwords' => env('AUTH_PASSWORD_BROKER', 'users'),
    ],

    /*
    |--------------------------------------------------------------------------
    | Authentication Guards
    |--------------------------------------------------------------------------
    |
    | Next, you may define every authentication guard for your application.
    | Of course, a great default configuration has been defined for you
    | which utilizes session storage plus the Eloquent user provider.
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | Supported: "session"
    |
    */

    'guards' => [
        'web' => [
            'driver' => 'session',
            'provider' => 'users',
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | User Providers
    |--------------------------------------------------------------------------
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | If you have multiple user tables or models you may configure multiple
    | providers to represent the model / table. These providers may then
    | be assigned to any extra authentication guards you have defined.
    |
    | Supported: "database", "eloquent"
    |
    */

    'providers' => [
        'users' => [
            'driver' => 'eloquent',
            'model' => env('AUTH_MODEL', App\Models\User::class),
        ],

        // 'users' => [
        //     'driver' => 'database',
        //     'table' => 'users',
        // ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Resetting Passwords
    |--------------------------------------------------------------------------
    |
    | These configuration options specify the behavior of Laravel's password
    | reset functionality, including the table utilized for token storage
    | and the user provider that is invoked to actually retrieve users.
    |
    | The expiry time is the number of minutes that each reset token will be
    | considered valid. This security feature keeps tokens short-lived so
    | they have less time to be guessed. You may change this as needed.
    |
    | The throttle setting is the number of seconds a user must wait before
    | generating more password reset tokens. This prevents the user from
    | quickly generating a very large amount of password reset tokens.
    |
    */

    'passwords' => [
        'users' => [
            'provider' => 'users',
            'table' => env('AUTH_PASSWORD_RESET_TOKEN_TABLE', 'password_reset_tokens'),
            'expire' => 60,
            'throttle' => 60,
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Password Confirmation Timeout
    |--------------------------------------------------------------------------
    |
    | Here you may define the number of seconds before a password confirmation
    | window expires and users are asked to re-enter their password via the
    | confirmation screen. By default, the timeout lasts for three hours.
    |
    */

    'password_timeout' => env('AUTH_PASSWORD_TIMEOUT', 10800),

];
</file>

<file path="config/cache.php">
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Cache Store
    |--------------------------------------------------------------------------
    |
    | This option controls the default cache store that will be used by the
    | framework. This connection is utilized if another isn't explicitly
    | specified when running a cache operation inside the application.
    |
    */

    'default' => env('CACHE_STORE', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Cache Stores
    |--------------------------------------------------------------------------
    |
    | Here you may define all of the cache "stores" for your application as
    | well as their drivers. You may even define multiple stores for the
    | same cache driver to group types of items stored in your caches.
    |
    | Supported drivers: "array", "database", "file", "memcached",
    |                    "redis", "dynamodb", "octane",
    |                    "failover", "null"
    |
    */

    'stores' => [

        'array' => [
            'driver' => 'array',
            'serialize' => false,
        ],

        'database' => [
            'driver' => 'database',
            'connection' => env('DB_CACHE_CONNECTION'),
            'table' => env('DB_CACHE_TABLE', 'cache'),
            'lock_connection' => env('DB_CACHE_LOCK_CONNECTION'),
            'lock_table' => env('DB_CACHE_LOCK_TABLE'),
        ],

        'file' => [
            'driver' => 'file',
            'path' => storage_path('framework/cache/data'),
            'lock_path' => storage_path('framework/cache/data'),
        ],

        'memcached' => [
            'driver' => 'memcached',
            'persistent_id' => env('MEMCACHED_PERSISTENT_ID'),
            'sasl' => [
                env('MEMCACHED_USERNAME'),
                env('MEMCACHED_PASSWORD'),
            ],
            'options' => [
                // Memcached::OPT_CONNECT_TIMEOUT => 2000,
            ],
            'servers' => [
                [
                    'host' => env('MEMCACHED_HOST', '127.0.0.1'),
                    'port' => env('MEMCACHED_PORT', 11211),
                    'weight' => 100,
                ],
            ],
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => env('REDIS_CACHE_CONNECTION', 'cache'),
            'lock_connection' => env('REDIS_CACHE_LOCK_CONNECTION', 'default'),
        ],

        'dynamodb' => [
            'driver' => 'dynamodb',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'table' => env('DYNAMODB_CACHE_TABLE', 'cache'),
            'endpoint' => env('DYNAMODB_ENDPOINT'),
        ],

        'octane' => [
            'driver' => 'octane',
        ],

        'failover' => [
            'driver' => 'failover',
            'stores' => [
                'database',
                'array',
            ],
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Cache Key Prefix
    |--------------------------------------------------------------------------
    |
    | When utilizing the APC, database, memcached, Redis, and DynamoDB cache
    | stores, there might be other applications using the same cache. For
    | that reason, you may prefix every cache key to avoid collisions.
    |
    */

    'prefix' => env('CACHE_PREFIX', Str::slug((string) env('APP_NAME', 'laravel')).'-cache-'),

];
</file>

<file path="config/database.php">
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Database Connection Name
    |--------------------------------------------------------------------------
    |
    | Here you may specify which of the database connections below you wish
    | to use as your default connection for database operations. This is
    | the connection which will be utilized unless another connection
    | is explicitly specified when you execute a query / statement.
    |
    */

    'default' => env('DB_CONNECTION', 'sqlite'),

    /*
    |--------------------------------------------------------------------------
    | Database Connections
    |--------------------------------------------------------------------------
    |
    | Below are all of the database connections defined for your application.
    | An example configuration is provided for each database system which
    | is supported by Laravel. You're free to add / remove connections.
    |
    */

    'connections' => [

        'sqlite' => [
            'driver' => 'sqlite',
            'url' => env('DB_URL'),
            'database' => env('DB_DATABASE', database_path('database.sqlite')),
            'prefix' => '',
            'foreign_key_constraints' => env('DB_FOREIGN_KEYS', true),
            'busy_timeout' => null,
            'journal_mode' => null,
            'synchronous' => null,
            'transaction_mode' => 'DEFERRED',
        ],

        'mysql' => [
            'driver' => 'mysql',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => env('DB_CHARSET', 'utf8mb4'),
            'collation' => env('DB_COLLATION', 'utf8mb4_unicode_ci'),
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

        'mariadb' => [
            'driver' => 'mariadb',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'unix_socket' => env('DB_SOCKET', ''),
            'charset' => env('DB_CHARSET', 'utf8mb4'),
            'collation' => env('DB_COLLATION', 'utf8mb4_unicode_ci'),
            'prefix' => '',
            'prefix_indexes' => true,
            'strict' => true,
            'engine' => null,
            'options' => extension_loaded('pdo_mysql') ? array_filter([
                PDO::MYSQL_ATTR_SSL_CA => env('MYSQL_ATTR_SSL_CA'),
            ]) : [],
        ],

        'pgsql' => [
            'driver' => 'pgsql',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '5432'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => env('DB_CHARSET', 'utf8'),
            'prefix' => '',
            'prefix_indexes' => true,
            'search_path' => 'public',
            'sslmode' => 'prefer',
        ],

        'sqlsrv' => [
            'driver' => 'sqlsrv',
            'url' => env('DB_URL'),
            'host' => env('DB_HOST', 'localhost'),
            'port' => env('DB_PORT', '1433'),
            'database' => env('DB_DATABASE', 'laravel'),
            'username' => env('DB_USERNAME', 'root'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => env('DB_CHARSET', 'utf8'),
            'prefix' => '',
            'prefix_indexes' => true,
            // 'encrypt' => env('DB_ENCRYPT', 'yes'),
            // 'trust_server_certificate' => env('DB_TRUST_SERVER_CERTIFICATE', 'false'),
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Migration Repository Table
    |--------------------------------------------------------------------------
    |
    | This table keeps track of all the migrations that have already run for
    | your application. Using this information, we can determine which of
    | the migrations on disk haven't actually been run on the database.
    |
    */

    'migrations' => [
        'table' => 'migrations',
        'update_date_on_publish' => true,
    ],

    /*
    |--------------------------------------------------------------------------
    | Redis Databases
    |--------------------------------------------------------------------------
    |
    | Redis is an open source, fast, and advanced key-value store that also
    | provides a richer body of commands than a typical key-value system
    | such as Memcached. You may define your connection settings here.
    |
    */

    'redis' => [

        'client' => env('REDIS_CLIENT', 'phpredis'),

        'options' => [
            'cluster' => env('REDIS_CLUSTER', 'redis'),
            'prefix' => env('REDIS_PREFIX', Str::slug((string) env('APP_NAME', 'laravel')).'-database-'),
            'persistent' => env('REDIS_PERSISTENT', false),
        ],

        'default' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_DB', '0'),
            'max_retries' => env('REDIS_MAX_RETRIES', 3),
            'backoff_algorithm' => env('REDIS_BACKOFF_ALGORITHM', 'decorrelated_jitter'),
            'backoff_base' => env('REDIS_BACKOFF_BASE', 100),
            'backoff_cap' => env('REDIS_BACKOFF_CAP', 1000),
        ],

        'cache' => [
            'url' => env('REDIS_URL'),
            'host' => env('REDIS_HOST', '127.0.0.1'),
            'username' => env('REDIS_USERNAME'),
            'password' => env('REDIS_PASSWORD'),
            'port' => env('REDIS_PORT', '6379'),
            'database' => env('REDIS_CACHE_DB', '1'),
            'max_retries' => env('REDIS_MAX_RETRIES', 3),
            'backoff_algorithm' => env('REDIS_BACKOFF_ALGORITHM', 'decorrelated_jitter'),
            'backoff_base' => env('REDIS_BACKOFF_BASE', 100),
            'backoff_cap' => env('REDIS_BACKOFF_CAP', 1000),
        ],

    ],

];
</file>

<file path="config/filesystems.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Filesystem Disk
    |--------------------------------------------------------------------------
    |
    | Here you may specify the default filesystem disk that should be used
    | by the framework. The "local" disk, as well as a variety of cloud
    | based disks are available to your application for file storage.
    |
    */

    'default' => env('FILESYSTEM_DISK', 'local'),

    /*
    |--------------------------------------------------------------------------
    | Filesystem Disks
    |--------------------------------------------------------------------------
    |
    | Below you may configure as many filesystem disks as necessary, and you
    | may even configure multiple disks for the same driver. Examples for
    | most supported storage drivers are configured here for reference.
    |
    | Supported drivers: "local", "ftp", "sftp", "s3"
    |
    */

    'disks' => [

        'local' => [
            'driver' => 'local',
            'root' => storage_path('app/private'),
            'serve' => true,
            'throw' => false,
            'report' => false,
        ],

        'public' => [
            'driver' => 'local',
            'root' => storage_path('app/public'),
            'url' => env('APP_URL').'/storage',
            'visibility' => 'public',
            'throw' => false,
            'report' => false,
        ],

        's3' => [
            'driver' => 's3',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'region' => env('AWS_DEFAULT_REGION'),
            'bucket' => env('AWS_BUCKET'),
            'url' => env('AWS_URL'),
            'endpoint' => env('AWS_ENDPOINT'),
            'use_path_style_endpoint' => env('AWS_USE_PATH_STYLE_ENDPOINT', false),
            'throw' => false,
            'report' => false,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Symbolic Links
    |--------------------------------------------------------------------------
    |
    | Here you may configure the symbolic links that will be created when the
    | `storage:link` Artisan command is executed. The array keys should be
    | the locations of the links and the values should be their targets.
    |
    */

    'links' => [
        public_path('storage') => storage_path('app/public'),
    ],

];
</file>

<file path="config/logging.php">
<?php

use Monolog\Handler\NullHandler;
use Monolog\Handler\StreamHandler;
use Monolog\Handler\SyslogUdpHandler;
use Monolog\Processor\PsrLogMessageProcessor;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Log Channel
    |--------------------------------------------------------------------------
    |
    | This option defines the default log channel that is utilized to write
    | messages to your logs. The value provided here should match one of
    | the channels present in the list of "channels" configured below.
    |
    */

    'default' => env('LOG_CHANNEL', 'stack'),

    /*
    |--------------------------------------------------------------------------
    | Deprecations Log Channel
    |--------------------------------------------------------------------------
    |
    | This option controls the log channel that should be used to log warnings
    | regarding deprecated PHP and library features. This allows you to get
    | your application ready for upcoming major versions of dependencies.
    |
    */

    'deprecations' => [
        'channel' => env('LOG_DEPRECATIONS_CHANNEL', 'null'),
        'trace' => env('LOG_DEPRECATIONS_TRACE', false),
    ],

    /*
    |--------------------------------------------------------------------------
    | Log Channels
    |--------------------------------------------------------------------------
    |
    | Here you may configure the log channels for your application. Laravel
    | utilizes the Monolog PHP logging library, which includes a variety
    | of powerful log handlers and formatters that you're free to use.
    |
    | Available drivers: "single", "daily", "slack", "syslog",
    |                    "errorlog", "monolog", "custom", "stack"
    |
    */

    'channels' => [

        'stack' => [
            'driver' => 'stack',
            'channels' => explode(',', (string) env('LOG_STACK', 'single')),
            'ignore_exceptions' => false,
        ],

        'single' => [
            'driver' => 'single',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'daily' => [
            'driver' => 'daily',
            'path' => storage_path('logs/laravel.log'),
            'level' => env('LOG_LEVEL', 'debug'),
            'days' => env('LOG_DAILY_DAYS', 14),
            'replace_placeholders' => true,
        ],

        'slack' => [
            'driver' => 'slack',
            'url' => env('LOG_SLACK_WEBHOOK_URL'),
            'username' => env('LOG_SLACK_USERNAME', 'Laravel Log'),
            'emoji' => env('LOG_SLACK_EMOJI', ':boom:'),
            'level' => env('LOG_LEVEL', 'critical'),
            'replace_placeholders' => true,
        ],

        'papertrail' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => env('LOG_PAPERTRAIL_HANDLER', SyslogUdpHandler::class),
            'handler_with' => [
                'host' => env('PAPERTRAIL_URL'),
                'port' => env('PAPERTRAIL_PORT'),
                'connectionString' => 'tls://'.env('PAPERTRAIL_URL').':'.env('PAPERTRAIL_PORT'),
            ],
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'stderr' => [
            'driver' => 'monolog',
            'level' => env('LOG_LEVEL', 'debug'),
            'handler' => StreamHandler::class,
            'handler_with' => [
                'stream' => 'php://stderr',
            ],
            'formatter' => env('LOG_STDERR_FORMATTER'),
            'processors' => [PsrLogMessageProcessor::class],
        ],

        'syslog' => [
            'driver' => 'syslog',
            'level' => env('LOG_LEVEL', 'debug'),
            'facility' => env('LOG_SYSLOG_FACILITY', LOG_USER),
            'replace_placeholders' => true,
        ],

        'errorlog' => [
            'driver' => 'errorlog',
            'level' => env('LOG_LEVEL', 'debug'),
            'replace_placeholders' => true,
        ],

        'null' => [
            'driver' => 'monolog',
            'handler' => NullHandler::class,
        ],

        'emergency' => [
            'path' => storage_path('logs/laravel.log'),
        ],

    ],

];
</file>

<file path="config/mail.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Mailer
    |--------------------------------------------------------------------------
    |
    | This option controls the default mailer that is used to send all email
    | messages unless another mailer is explicitly specified when sending
    | the message. All additional mailers can be configured within the
    | "mailers" array. Examples of each type of mailer are provided.
    |
    */

    'default' => env('MAIL_MAILER', 'log'),

    /*
    |--------------------------------------------------------------------------
    | Mailer Configurations
    |--------------------------------------------------------------------------
    |
    | Here you may configure all of the mailers used by your application plus
    | their respective settings. Several examples have been configured for
    | you and you are free to add your own as your application requires.
    |
    | Laravel supports a variety of mail "transport" drivers that can be used
    | when delivering an email. You may specify which one you're using for
    | your mailers below. You may also add additional mailers if needed.
    |
    | Supported: "smtp", "sendmail", "mailgun", "ses", "ses-v2",
    |            "postmark", "resend", "log", "array",
    |            "failover", "roundrobin"
    |
    */

    'mailers' => [

        'smtp' => [
            'transport' => 'smtp',
            'scheme' => env('MAIL_SCHEME'),
            'url' => env('MAIL_URL'),
            'host' => env('MAIL_HOST', '127.0.0.1'),
            'port' => env('MAIL_PORT', 2525),
            'username' => env('MAIL_USERNAME'),
            'password' => env('MAIL_PASSWORD'),
            'timeout' => null,
            'local_domain' => env('MAIL_EHLO_DOMAIN', parse_url((string) env('APP_URL', 'http://localhost'), PHP_URL_HOST)),
        ],

        'ses' => [
            'transport' => 'ses',
        ],

        'postmark' => [
            'transport' => 'postmark',
            // 'message_stream_id' => env('POSTMARK_MESSAGE_STREAM_ID'),
            // 'client' => [
            //     'timeout' => 5,
            // ],
        ],

        'resend' => [
            'transport' => 'resend',
        ],

        'sendmail' => [
            'transport' => 'sendmail',
            'path' => env('MAIL_SENDMAIL_PATH', '/usr/sbin/sendmail -bs -i'),
        ],

        'log' => [
            'transport' => 'log',
            'channel' => env('MAIL_LOG_CHANNEL'),
        ],

        'array' => [
            'transport' => 'array',
        ],

        'failover' => [
            'transport' => 'failover',
            'mailers' => [
                'smtp',
                'log',
            ],
            'retry_after' => 60,
        ],

        'roundrobin' => [
            'transport' => 'roundrobin',
            'mailers' => [
                'ses',
                'postmark',
            ],
            'retry_after' => 60,
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Global "From" Address
    |--------------------------------------------------------------------------
    |
    | You may wish for all emails sent by your application to be sent from
    | the same address. Here you may specify a name and address that is
    | used globally for all emails that are sent by your application.
    |
    */

    'from' => [
        'address' => env('MAIL_FROM_ADDRESS', 'hello@example.com'),
        'name' => env('MAIL_FROM_NAME', 'Example'),
    ],

];
</file>

<file path="config/permission.php">
<?php

return [

    'models' => [

        /*
         * When using the "HasPermissions" trait from this package, we need to know which
         * Eloquent model should be used to retrieve your permissions. Of course, it
         * is often just the "Permission" model but you may use whatever you like.
         *
         * The model you want to use as a Permission model needs to implement the
         * `Spatie\Permission\Contracts\Permission` contract.
         */

        'permission' => Spatie\Permission\Models\Permission::class,

        /*
         * When using the "HasRoles" trait from this package, we need to know which
         * Eloquent model should be used to retrieve your roles. Of course, it
         * is often just the "Role" model but you may use whatever you like.
         *
         * The model you want to use as a Role model needs to implement the
         * `Spatie\Permission\Contracts\Role` contract.
         */

        'role' => Spatie\Permission\Models\Role::class,

    ],

    'table_names' => [

        /*
         * When using the "HasRoles" trait from this package, we need to know which
         * table should be used to retrieve your roles. We have chosen a basic
         * default value but you may easily change it to any table you like.
         */

        'roles' => 'roles',

        /*
         * When using the "HasPermissions" trait from this package, we need to know which
         * table should be used to retrieve your permissions. We have chosen a basic
         * default value but you may easily change it to any table you like.
         */

        'permissions' => 'permissions',

        /*
         * When using the "HasPermissions" trait from this package, we need to know which
         * table should be used to retrieve your models permissions. We have chosen a
         * basic default value but you may easily change it to any table you like.
         */

        'model_has_permissions' => 'model_has_permissions',

        /*
         * When using the "HasRoles" trait from this package, we need to know which
         * table should be used to retrieve your models roles. We have chosen a
         * basic default value but you may easily change it to any table you like.
         */

        'model_has_roles' => 'model_has_roles',

        /*
         * When using the "HasRoles" trait from this package, we need to know which
         * table should be used to retrieve your roles permissions. We have chosen a
         * basic default value but you may easily change it to any table you like.
         */

        'role_has_permissions' => 'role_has_permissions',
    ],

    'column_names' => [
        /*
         * Change this if you want to name the related pivots other than defaults
         */
        'role_pivot_key' => null, // default 'role_id',
        'permission_pivot_key' => null, // default 'permission_id',

        /*
         * Change this if you want to name the related model primary key other than
         * `model_id`.
         *
         * For example, this would be nice if your primary keys are all UUIDs. In
         * that case, name this `model_uuid`.
         */

        'model_morph_key' => 'model_id',

        /*
         * Change this if you want to use the teams feature and your related model's
         * foreign key is other than `team_id`.
         */

        'team_foreign_key' => 'team_id',
    ],

    /*
     * When set to true, the method for checking permissions will be registered on the gate.
     * Set this to false if you want to implement custom logic for checking permissions.
     */

    'register_permission_check_method' => true,

    /*
     * When set to true, Laravel\Octane\Events\OperationTerminated event listener will be registered
     * this will refresh permissions on every TickTerminated, TaskTerminated and RequestTerminated
     * NOTE: This should not be needed in most cases, but an Octane/Vapor combination benefited from it.
     */
    'register_octane_reset_listener' => false,

    /*
     * Events will fire when a role or permission is assigned/unassigned:
     * \Spatie\Permission\Events\RoleAttached
     * \Spatie\Permission\Events\RoleDetached
     * \Spatie\Permission\Events\PermissionAttached
     * \Spatie\Permission\Events\PermissionDetached
     *
     * To enable, set to true, and then create listeners to watch these events.
     */
    'events_enabled' => false,

    /*
     * Teams Feature.
     * When set to true the package implements teams using the 'team_foreign_key'.
     * If you want the migrations to register the 'team_foreign_key', you must
     * set this to true before doing the migration.
     * If you already did the migration then you must make a new migration to also
     * add 'team_foreign_key' to 'roles', 'model_has_roles', and 'model_has_permissions'
     * (view the latest version of this package's migration file)
     */

    'teams' => false,

    /*
     * The class to use to resolve the permissions team id
     */
    'team_resolver' => \Spatie\Permission\DefaultTeamResolver::class,

    /*
     * Passport Client Credentials Grant
     * When set to true the package will use Passports Client to check permissions
     */

    'use_passport_client_credentials' => false,

    /*
     * When set to true, the required permission names are added to exception messages.
     * This could be considered an information leak in some contexts, so the default
     * setting is false here for optimum safety.
     */

    'display_permission_in_exception' => false,

    /*
     * When set to true, the required role names are added to exception messages.
     * This could be considered an information leak in some contexts, so the default
     * setting is false here for optimum safety.
     */

    'display_role_in_exception' => false,

    /*
     * By default wildcard permission lookups are disabled.
     * See documentation to understand supported syntax.
     */

    'enable_wildcard_permission' => false,

    /*
     * The class to use for interpreting wildcard permissions.
     * If you need to modify delimiters, override the class and specify its name here.
     */
    // 'wildcard_permission' => Spatie\Permission\WildcardPermission::class,

    /* Cache-specific settings */

    'cache' => [

        /*
         * By default all permissions are cached for 24 hours to speed up performance.
         * When permissions or roles are updated the cache is flushed automatically.
         */

        'expiration_time' => \DateInterval::createFromDateString('24 hours'),

        /*
         * The cache key used to store all permissions.
         */

        'key' => 'spatie.permission.cache',

        /*
         * You may optionally indicate a specific cache driver to use for permission and
         * role caching using any of the `store` drivers listed in the cache.php config
         * file. Using 'default' here means to use the `default` set in cache.php.
         */

        'store' => 'default',
    ],
];
</file>

<file path="config/queue.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Default Queue Connection Name
    |--------------------------------------------------------------------------
    |
    | Laravel's queue supports a variety of backends via a single, unified
    | API, giving you convenient access to each backend using identical
    | syntax for each. The default queue connection is defined below.
    |
    */

    'default' => env('QUEUE_CONNECTION', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Queue Connections
    |--------------------------------------------------------------------------
    |
    | Here you may configure the connection options for every queue backend
    | used by your application. An example configuration is provided for
    | each backend supported by Laravel. You're also free to add more.
    |
    | Drivers: "sync", "database", "beanstalkd", "sqs", "redis",
    |          "deferred", "failover", "null"
    |
    */

    'connections' => [

        'sync' => [
            'driver' => 'sync',
        ],

        'database' => [
            'driver' => 'database',
            'connection' => env('DB_QUEUE_CONNECTION'),
            'table' => env('DB_QUEUE_TABLE', 'jobs'),
            'queue' => env('DB_QUEUE', 'default'),
            'retry_after' => (int) env('DB_QUEUE_RETRY_AFTER', 90),
            'after_commit' => false,
        ],

        'beanstalkd' => [
            'driver' => 'beanstalkd',
            'host' => env('BEANSTALKD_QUEUE_HOST', 'localhost'),
            'queue' => env('BEANSTALKD_QUEUE', 'default'),
            'retry_after' => (int) env('BEANSTALKD_QUEUE_RETRY_AFTER', 90),
            'block_for' => 0,
            'after_commit' => false,
        ],

        'sqs' => [
            'driver' => 'sqs',
            'key' => env('AWS_ACCESS_KEY_ID'),
            'secret' => env('AWS_SECRET_ACCESS_KEY'),
            'prefix' => env('SQS_PREFIX', 'https://sqs.us-east-1.amazonaws.com/your-account-id'),
            'queue' => env('SQS_QUEUE', 'default'),
            'suffix' => env('SQS_SUFFIX'),
            'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
            'after_commit' => false,
        ],

        'redis' => [
            'driver' => 'redis',
            'connection' => env('REDIS_QUEUE_CONNECTION', 'default'),
            'queue' => env('REDIS_QUEUE', 'default'),
            'retry_after' => (int) env('REDIS_QUEUE_RETRY_AFTER', 90),
            'block_for' => null,
            'after_commit' => false,
        ],

        'deferred' => [
            'driver' => 'deferred',
        ],

        'failover' => [
            'driver' => 'failover',
            'connections' => [
                'database',
                'deferred',
            ],
        ],

    ],

    /*
    |--------------------------------------------------------------------------
    | Job Batching
    |--------------------------------------------------------------------------
    |
    | The following options configure the database and table that store job
    | batching information. These options can be updated to any database
    | connection and table which has been defined by your application.
    |
    */

    'batching' => [
        'database' => env('DB_CONNECTION', 'sqlite'),
        'table' => 'job_batches',
    ],

    /*
    |--------------------------------------------------------------------------
    | Failed Queue Jobs
    |--------------------------------------------------------------------------
    |
    | These options configure the behavior of failed queue job logging so you
    | can control how and where failed jobs are stored. Laravel ships with
    | support for storing failed jobs in a simple file or in a database.
    |
    | Supported drivers: "database-uuids", "dynamodb", "file", "null"
    |
    */

    'failed' => [
        'driver' => env('QUEUE_FAILED_DRIVER', 'database-uuids'),
        'database' => env('DB_CONNECTION', 'sqlite'),
        'table' => 'failed_jobs',
    ],

];
</file>

<file path="config/services.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Third Party Services
    |--------------------------------------------------------------------------
    |
    | This file is for storing the credentials for third party services such
    | as Mailgun, Postmark, AWS and more. This file provides the de facto
    | location for this type of information, allowing packages to have
    | a conventional file to locate the various service credentials.
    |
    */

    'postmark' => [
        'token' => env('POSTMARK_TOKEN'),
    ],

    'resend' => [
        'key' => env('RESEND_KEY'),
    ],

    'ses' => [
        'key' => env('AWS_ACCESS_KEY_ID'),
        'secret' => env('AWS_SECRET_ACCESS_KEY'),
        'region' => env('AWS_DEFAULT_REGION', 'us-east-1'),
    ],

    'slack' => [
        'notifications' => [
            'bot_user_oauth_token' => env('SLACK_BOT_USER_OAUTH_TOKEN'),
            'channel' => env('SLACK_BOT_USER_DEFAULT_CHANNEL'),
        ],
    ],

];
</file>

<file path="config/session.php">
<?php

use Illuminate\Support\Str;

return [

    /*
    |--------------------------------------------------------------------------
    | Default Session Driver
    |--------------------------------------------------------------------------
    |
    | This option determines the default session driver that is utilized for
    | incoming requests. Laravel supports a variety of storage options to
    | persist session data. Database storage is a great default choice.
    |
    | Supported: "file", "cookie", "database", "memcached",
    |            "redis", "dynamodb", "array"
    |
    */

    'driver' => env('SESSION_DRIVER', 'database'),

    /*
    |--------------------------------------------------------------------------
    | Session Lifetime
    |--------------------------------------------------------------------------
    |
    | Here you may specify the number of minutes that you wish the session
    | to be allowed to remain idle before it expires. If you want them
    | to expire immediately when the browser is closed then you may
    | indicate that via the expire_on_close configuration option.
    |
    */

    'lifetime' => (int) env('SESSION_LIFETIME', 120),

    'expire_on_close' => env('SESSION_EXPIRE_ON_CLOSE', false),

    /*
    |--------------------------------------------------------------------------
    | Session Encryption
    |--------------------------------------------------------------------------
    |
    | This option allows you to easily specify that all of your session data
    | should be encrypted before it's stored. All encryption is performed
    | automatically by Laravel and you may use the session like normal.
    |
    */

    'encrypt' => env('SESSION_ENCRYPT', false),

    /*
    |--------------------------------------------------------------------------
    | Session File Location
    |--------------------------------------------------------------------------
    |
    | When utilizing the "file" session driver, the session files are placed
    | on disk. The default storage location is defined here; however, you
    | are free to provide another location where they should be stored.
    |
    */

    'files' => storage_path('framework/sessions'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Connection
    |--------------------------------------------------------------------------
    |
    | When using the "database" or "redis" session drivers, you may specify a
    | connection that should be used to manage these sessions. This should
    | correspond to a connection in your database configuration options.
    |
    */

    'connection' => env('SESSION_CONNECTION'),

    /*
    |--------------------------------------------------------------------------
    | Session Database Table
    |--------------------------------------------------------------------------
    |
    | When using the "database" session driver, you may specify the table to
    | be used to store sessions. Of course, a sensible default is defined
    | for you; however, you're welcome to change this to another table.
    |
    */

    'table' => env('SESSION_TABLE', 'sessions'),

    /*
    |--------------------------------------------------------------------------
    | Session Cache Store
    |--------------------------------------------------------------------------
    |
    | When using one of the framework's cache driven session backends, you may
    | define the cache store which should be used to store the session data
    | between requests. This must match one of your defined cache stores.
    |
    | Affects: "dynamodb", "memcached", "redis"
    |
    */

    'store' => env('SESSION_STORE'),

    /*
    |--------------------------------------------------------------------------
    | Session Sweeping Lottery
    |--------------------------------------------------------------------------
    |
    | Some session drivers must manually sweep their storage location to get
    | rid of old sessions from storage. Here are the chances that it will
    | happen on a given request. By default, the odds are 2 out of 100.
    |
    */

    'lottery' => [2, 100],

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Name
    |--------------------------------------------------------------------------
    |
    | Here you may change the name of the session cookie that is created by
    | the framework. Typically, you should not need to change this value
    | since doing so does not grant a meaningful security improvement.
    |
    */

    'cookie' => env(
        'SESSION_COOKIE',
        Str::slug((string) env('APP_NAME', 'laravel')).'-session'
    ),

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Path
    |--------------------------------------------------------------------------
    |
    | The session cookie path determines the path for which the cookie will
    | be regarded as available. Typically, this will be the root path of
    | your application, but you're free to change this when necessary.
    |
    */

    'path' => env('SESSION_PATH', '/'),

    /*
    |--------------------------------------------------------------------------
    | Session Cookie Domain
    |--------------------------------------------------------------------------
    |
    | This value determines the domain and subdomains the session cookie is
    | available to. By default, the cookie will be available to the root
    | domain and all subdomains. Typically, this shouldn't be changed.
    |
    */

    'domain' => env('SESSION_DOMAIN'),

    /*
    |--------------------------------------------------------------------------
    | HTTPS Only Cookies
    |--------------------------------------------------------------------------
    |
    | By setting this option to true, session cookies will only be sent back
    | to the server if the browser has a HTTPS connection. This will keep
    | the cookie from being sent to you when it can't be done securely.
    |
    */

    'secure' => env('SESSION_SECURE_COOKIE'),

    /*
    |--------------------------------------------------------------------------
    | HTTP Access Only
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will prevent JavaScript from accessing the
    | value of the cookie and the cookie will only be accessible through
    | the HTTP protocol. It's unlikely you should disable this option.
    |
    */

    'http_only' => env('SESSION_HTTP_ONLY', true),

    /*
    |--------------------------------------------------------------------------
    | Same-Site Cookies
    |--------------------------------------------------------------------------
    |
    | This option determines how your cookies behave when cross-site requests
    | take place, and can be used to mitigate CSRF attacks. By default, we
    | will set this value to "lax" to permit secure cross-site requests.
    |
    | See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#samesitesamesite-value
    |
    | Supported: "lax", "strict", "none", null
    |
    */

    'same_site' => env('SESSION_SAME_SITE', 'lax'),

    /*
    |--------------------------------------------------------------------------
    | Partitioned Cookies
    |--------------------------------------------------------------------------
    |
    | Setting this value to true will tie the cookie to the top-level site for
    | a cross-site context. Partitioned cookies are accepted by the browser
    | when flagged "secure" and the Same-Site attribute is set to "none".
    |
    */

    'partitioned' => env('SESSION_PARTITIONED_COOKIE', false),

];
</file>

<file path="database/.gitignore">
*.sqlite*
</file>

<file path="database/factories/SupplierFactory.php">
<?php

namespace Database\Factories;

use FlipperBox\Inventory\Models\Supplier;
use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\FlipperBox\Inventory\Models\Supplier>
 */
class SupplierFactory extends Factory
{
    /**
     * The name of the factory's corresponding model.
     *
     * @var string
     */
    protected $model = Supplier::class;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => fake()->company(),
            'contact_person' => fake()->name(),
            'phone' => fake()->e164PhoneNumber(),
            'email' => fake()->unique()->safeEmail(),
            'address' => fake()->address(),
        ];
    }
}
</file>

<file path="database/factories/VehiculoFactory.php">
<?php
namespace Database\Factories;

use FlipperBox\Crm\Models\Vehiculo;
use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;

class VehiculoFactory extends Factory
{
    protected $model = Vehiculo::class;

    public function definition(): array
    {
        return [
            'patente' => strtoupper(Str::random(3) . ' ' . fake()->numerify('###')),
            'marca' => fake()->randomElement(['Toyota', 'Ford', 'Chevrolet', 'Volkswagen', 'Fiat', 'Renault']),
            'modelo' => fake()->randomElement(['Corolla', 'Hilux', 'Ranger', 'Onix', 'Gol', 'Sandero']),
            'anio' => fake()->numberBetween(2010, 2024),
            'kilometraje' => fake()->numberBetween(10000, 150000),
            'vin' => strtoupper(Str::random(17)),
        ];
    }
}
</file>

<file path="database/migrations/0001_01_01_000001_create_cache_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('cache', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->mediumText('value');
            $table->integer('expiration');
        });

        Schema::create('cache_locks', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->string('owner');
            $table->integer('expiration');
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('cache');
        Schema::dropIfExists('cache_locks');
    }
};
</file>

<file path="database/migrations/0001_01_01_000002_create_jobs_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('jobs', function (Blueprint $table) {
            $table->id();
            $table->string('queue')->index();
            $table->longText('payload');
            $table->unsignedTinyInteger('attempts');
            $table->unsignedInteger('reserved_at')->nullable();
            $table->unsignedInteger('available_at');
            $table->unsignedInteger('created_at');
        });

        Schema::create('job_batches', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->string('name');
            $table->integer('total_jobs');
            $table->integer('pending_jobs');
            $table->integer('failed_jobs');
            $table->longText('failed_job_ids');
            $table->mediumText('options')->nullable();
            $table->integer('cancelled_at')->nullable();
            $table->integer('created_at');
            $table->integer('finished_at')->nullable();
        });

        Schema::create('failed_jobs', function (Blueprint $table) {
            $table->id();
            $table->string('uuid')->unique();
            $table->text('connection');
            $table->text('queue');
            $table->longText('payload');
            $table->longText('exception');
            $table->timestamp('failed_at')->useCurrent();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('jobs');
        Schema::dropIfExists('job_batches');
        Schema::dropIfExists('failed_jobs');
    }
};
</file>

<file path="database/migrations/2025_11_03_130548_create_permission_tables.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        $teams = config('permission.teams');
        $tableNames = config('permission.table_names');
        $columnNames = config('permission.column_names');
        $pivotRole = $columnNames['role_pivot_key'] ?? 'role_id';
        $pivotPermission = $columnNames['permission_pivot_key'] ?? 'permission_id';

        throw_if(empty($tableNames), Exception::class, 'Error: config/permission.php not loaded. Run [php artisan config:clear] and try again.');
        throw_if($teams && empty($columnNames['team_foreign_key'] ?? null), Exception::class, 'Error: team_foreign_key on config/permission.php not loaded. Run [php artisan config:clear] and try again.');

        Schema::create($tableNames['permissions'], static function (Blueprint $table) {
            // $table->engine('InnoDB');
            $table->bigIncrements('id'); // permission id
            $table->string('name');       // For MyISAM use string('name', 225); // (or 166 for InnoDB with Redundant/Compact row format)
            $table->string('guard_name'); // For MyISAM use string('guard_name', 25);
            $table->timestamps();

            $table->unique(['name', 'guard_name']);
        });

        Schema::create($tableNames['roles'], static function (Blueprint $table) use ($teams, $columnNames) {
            // $table->engine('InnoDB');
            $table->bigIncrements('id'); // role id
            if ($teams || config('permission.testing')) { // permission.testing is a fix for sqlite testing
                $table->unsignedBigInteger($columnNames['team_foreign_key'])->nullable();
                $table->index($columnNames['team_foreign_key'], 'roles_team_foreign_key_index');
            }
            $table->string('name');       // For MyISAM use string('name', 225); // (or 166 for InnoDB with Redundant/Compact row format)
            $table->string('guard_name'); // For MyISAM use string('guard_name', 25);
            $table->timestamps();
            if ($teams || config('permission.testing')) {
                $table->unique([$columnNames['team_foreign_key'], 'name', 'guard_name']);
            } else {
                $table->unique(['name', 'guard_name']);
            }
        });

        Schema::create($tableNames['model_has_permissions'], static function (Blueprint $table) use ($tableNames, $columnNames, $pivotPermission, $teams) {
            $table->unsignedBigInteger($pivotPermission);

            $table->string('model_type');
            $table->unsignedBigInteger($columnNames['model_morph_key']);
            $table->index([$columnNames['model_morph_key'], 'model_type'], 'model_has_permissions_model_id_model_type_index');

            $table->foreign($pivotPermission)
                ->references('id') // permission id
                ->on($tableNames['permissions'])
                ->onDelete('cascade');
            if ($teams) {
                $table->unsignedBigInteger($columnNames['team_foreign_key']);
                $table->index($columnNames['team_foreign_key'], 'model_has_permissions_team_foreign_key_index');

                $table->primary([$columnNames['team_foreign_key'], $pivotPermission, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_permissions_permission_model_type_primary');
            } else {
                $table->primary([$pivotPermission, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_permissions_permission_model_type_primary');
            }

        });

        Schema::create($tableNames['model_has_roles'], static function (Blueprint $table) use ($tableNames, $columnNames, $pivotRole, $teams) {
            $table->unsignedBigInteger($pivotRole);

            $table->string('model_type');
            $table->unsignedBigInteger($columnNames['model_morph_key']);
            $table->index([$columnNames['model_morph_key'], 'model_type'], 'model_has_roles_model_id_model_type_index');

            $table->foreign($pivotRole)
                ->references('id') // role id
                ->on($tableNames['roles'])
                ->onDelete('cascade');
            if ($teams) {
                $table->unsignedBigInteger($columnNames['team_foreign_key']);
                $table->index($columnNames['team_foreign_key'], 'model_has_roles_team_foreign_key_index');

                $table->primary([$columnNames['team_foreign_key'], $pivotRole, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_roles_role_model_type_primary');
            } else {
                $table->primary([$pivotRole, $columnNames['model_morph_key'], 'model_type'],
                    'model_has_roles_role_model_type_primary');
            }
        });

        Schema::create($tableNames['role_has_permissions'], static function (Blueprint $table) use ($tableNames, $pivotRole, $pivotPermission) {
            $table->unsignedBigInteger($pivotPermission);
            $table->unsignedBigInteger($pivotRole);

            $table->foreign($pivotPermission)
                ->references('id') // permission id
                ->on($tableNames['permissions'])
                ->onDelete('cascade');

            $table->foreign($pivotRole)
                ->references('id') // role id
                ->on($tableNames['roles'])
                ->onDelete('cascade');

            $table->primary([$pivotPermission, $pivotRole], 'role_has_permissions_permission_id_role_id_primary');
        });

        app('cache')
            ->store(config('permission.cache.store') != 'default' ? config('permission.cache.store') : null)
            ->forget(config('permission.cache.key'));
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        $tableNames = config('permission.table_names');

        throw_if(empty($tableNames), Exception::class, 'Error: config/permission.php not found and defaults could not be merged. Please publish the package configuration before proceeding, or drop the tables manually.');

        Schema::drop($tableNames['role_has_permissions']);
        Schema::drop($tableNames['model_has_roles']);
        Schema::drop($tableNames['model_has_permissions']);
        Schema::drop($tableNames['roles']);
        Schema::drop($tableNames['permissions']);
    }
};
</file>

<file path="database/migrations/2025_11_04_193207_create_suppliers_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('suppliers', function (Blueprint $table) {
            $table->id();
            $table->string('name')->unique();
            $table->string('contact_person')->nullable();
            $table->string('phone')->nullable();
            $table->string('email')->nullable();
            $table->text('address')->nullable();
            $table->timestamps();
            $table->softDeletes();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('suppliers');
    }
};
</file>

<file path="database/migrations/2025_11_04_193421_create_product_supplier_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('product_supplier', function (Blueprint $table) {
            $table->id();
            $table->foreignId('product_id')->constrained()->onDelete('cascade');
            $table->foreignId('supplier_id')->constrained()->onDelete('cascade');
            $table->decimal('cost', 10, 2)->comment('Costo del producto para este proveedor');
            $table->timestamps();
            $table->unique(['product_id', 'supplier_id']);
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('product_supplier');
    }
};
</file>

<file path="database/migrations/2025_11_04_193514_create_inventory_movements_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('inventory_movements', function (Blueprint $table) {
            $table->id();
            $table->foreignId('product_id')->constrained()->onDelete('cascade');
            $table->foreignId('user_id')->nullable()->constrained()->onDelete('set null')->comment('Usuario que realizó el movimiento');
            $table->enum('type', ['in', 'out', 'adjustment']);
            $table->integer('quantity');
            $table->string('reason')->nullable()->comment('Ej: Venta, Compra, Devolución, Ajuste manual');
            $table->timestamps();
            $table->index(['product_id', 'created_at']);
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('inventory_movements');
    }
};
</file>

<file path="database/migrations/2025_11_06_010312_create_work_orders_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('work_orders', function (Blueprint $table) {
            $table->id();
            $table->foreignId('vehicle_id')->constrained('vehiculos')->onDelete('cascade');
            $table->foreignId('mechanic_id')->nullable()->constrained('users')->onDelete('set null')->comment('Mecánico asignado');
            $table->enum('status', ['Pendiente', 'En Progreso', 'Completada', 'Cancelada'])->default('Pendiente');
            $table->text('description')->comment('Descripción inicial del problema o servicio solicitado');
            $table->text('notes')->nullable()->comment('Notas internas del mecánico');
            $table->timestamp('entry_date')->useCurrent();
            $table->timestamp('completion_date')->nullable();
            $table->decimal('total', 10, 2)->nullable();
            $table->timestamps();
            $table->softDeletes();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('work_orders');
    }
};
</file>

<file path="database/migrations/2025_11_06_010608_create_work_order_product_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('work_order_product', function (Blueprint $table) {
            $table->id();
            $table->foreignId('work_order_id')->constrained('work_orders')->onDelete('cascade');
            $table->foreignId('product_id')->constrained('products')->onDelete('cascade');
            $table->integer('quantity');
            $table->decimal('unit_price', 10, 2)->comment('Precio del producto al momento de la venta');
            $table->timestamps();
            $table->unique(['work_order_id', 'product_id']);
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('work_order_product');
    }
};
</file>

<file path="database/migrations/2025_11_06_015636_create_services_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('services', function (Blueprint $table) {
            $table->id();
            $table->string('name')->unique();
            $table->text('description')->nullable();
            $table->decimal('price', 10, 2)->comment('Precio de la mano de obra');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('services');
    }
};
</file>

<file path="database/migrations/2025_11_06_015800_create_work_order_service_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('work_order_service', function (Blueprint $table) {
            $table->id();
            $table->foreignId('work_order_id')->constrained('work_orders')->onDelete('cascade');
            $table->foreignId('service_id')->constrained('services')->onDelete('cascade');
            $table->decimal('price', 10, 2)->comment('Precio del servicio al momento de la orden');
            $table->timestamps();
            $table->unique(['work_order_id', 'service_id']);
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('work_order_service');
    }
};
</file>

<file path="database/migrations/2025_11_06_015847_create_external_costs_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('external_costs', function (Blueprint $table) {
            $table->id();
            $table->foreignId('work_order_id')->constrained('work_orders')->onDelete('cascade');
            $table->string('description');
            $table->decimal('cost', 10, 2);
            $table->decimal('price', 10, 2);
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('external_costs');
    }
};
</file>

<file path="database/migrations/2025_11_06_224559_create_daily_capacities_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('daily_capacities', function (Blueprint $table) {
            $table->id();
            $table->date('date')->unique();
            $table->unsignedInteger('total_slots')->comment('Capacidad total para el día');
            $table->unsignedInteger('booked_slots')->default(0)->comment('Cupos ya reservados');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('daily_capacities');
    }
};
</file>

<file path="database/migrations/2025_11_06_224636_create_reservations_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('reservations', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained('users')->onDelete('cascade');
            $table->foreignId('vehicle_id')->constrained('vehiculos')->onDelete('cascade');
            $table->date('reservation_date');
            $table->enum('status', ['Pendiente', 'Confirmada', 'Cancelada'])->default('Pendiente');
            $table->text('notes')->nullable()->comment('Notas del cliente al solicitar');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('reservations');
    }
};
</file>

<file path="jsconfig.json">
{
    "compilerOptions": {
        "baseUrl": ".",
        "paths": {
            "@/*": ["resources/js/*"],
            "ziggy-js": ["./vendor/tightenco/ziggy"]
        }
    },
    "exclude": ["node_modules", "public"]
}
</file>

<file path="lang/es.json">
{
    "(and :count more error)": "(y :count error más)",
    "(and :count more errors)": "(y :count error más)|(y :count errores más)|(y :count errores más)",
    "A decryption key is required.": "Se requiere una clave de descifrado.",
    "A new verification link has been sent to the email address you provided during registration.": "Se ha enviado un nuevo enlace de verificación a la dirección de correo electrónico que proporcionó durante el registro.",
    "A new verification link has been sent to your email address.": "Se ha enviado un nuevo enlace de verificación a su dirección de correo electrónico.",
    "A Timeout Occurred": "Se produjo un tiempo de espera",
    "Accept": "Aceptar",
    "Accepted": "Aceptado",
    "Action": "Acción",
    "Actions": "Acciones",
    "Add": "Añadir",
    "Add :name": "Agregar :name",
    "Admin": "Administrar",
    "Agree": "Aceptar",
    "All rights reserved.": "Todos los derechos reservados.",
    "Already registered?": "¿Ya se registró?",
    "Already Reported": "Ya Reportado",
    "Archive": "Archivar",
    "Are you sure you want to delete your account?": "¿Está seguro que desea eliminar su cuenta?",
    "Assign": "Asignar",
    "Associate": "Asociar",
    "Attach": "Adjuntar",
    "Bad Gateway": "Mala puerta de enlace",
    "Bad Request": "Solicitud incorrecta",
    "Bandwidth Limit Exceeded": "Límite de ancho de banda excedido",
    "Browse": "Navegar",
    "Cancel": "Cancelar",
    "Choose": "Elija",
    "Choose :name": "Elegir :name",
    "Choose File": "Elija archivo",
    "Choose Image": "Elegir Imagen",
    "Click here to re-send the verification email.": "Haga clic aquí para reenviar el correo de verificación.",
    "Click to copy": "Haga clic para copiar",
    "Client Closed Request": "Solicitud cerrada del cliente",
    "Close": "Cerrar",
    "Collapse": "Colapsar",
    "Collapse All": "Colapsar todo",
    "Comment": "Comentar",
    "Confirm": "Confirmar",
    "Confirm Password": "Confirmar contraseña",
    "Conflict": "Conflicto",
    "Connect": "Conectar",
    "Connection Closed Without Response": "Conexión cerrada sin respuesta",
    "Connection Timed Out": "Tiempo de conexión agotado",
    "Continue": "Continuar",
    "Create": "Crear",
    "Create :name": "Crear :name",
    "Created": "Creado",
    "Current Password": "Contraseña actual",
    "Dashboard": "Panel",
    "Delete": "Eliminar",
    "Delete :name": "Eliminar :name",
    "Delete Account": "Borrar cuenta",
    "Detach": "Desvincular",
    "Details": "Detalles",
    "Disable": "Deshabilitar",
    "Discard": "Descartar",
    "Done": "Hecho",
    "Down": "Abajo",
    "Duplicate": "Duplicar",
    "Duplicate :name": "Duplicar :name",
    "Edit": "Editar",
    "Edit :name": "Editar :name",
    "Email": "Correo electrónico",
    "email": "El campo :attribute no es un correo válido.",
    "Email Password Reset Link": "Enviar enlace para restablecer contraseña",
    "Enable": "Habilitar",
    "Encrypted environment file already exists.": "El archivo de entorno cifrado ya existe.",
    "Encrypted environment file not found.": "No se encontró el archivo de entorno cifrado.",
    "Ensure your account is using a long, random password to stay secure.": "Asegúrese que su cuenta esté usando una contraseña larga y aleatoria para mantenerse seguro.",
    "Environment file already exists.": "El archivo de entorno ya existe.",
    "Environment file not found.": "Archivo de entorno no encontrado.",
    "errors": "errores",
    "Expand": "Expandir",
    "Expand All": "Expandir todo",
    "Expectation Failed": "Expectativa fallida",
    "Explanation": "Explicación",
    "Export": "Exportar",
    "Export :name": "Exportar :name",
    "Failed Dependency": "Dependencia fallida",
    "File": "Archivo",
    "Files": "Archivos",
    "Forbidden": "Prohibido",
    "Forgot your password?": "¿Olvidó su contraseña?",
    "Forgot your password? No problem. Just let us know your email address and we will email you a password reset link that will allow you to choose a new one.": "¿Olvidó su contraseña? No hay problema. Simplemente déjenos saber su dirección de correo electrónico y le enviaremos un enlace para restablecer la contraseña que le permitirá elegir una nueva.",
    "Found": "Encontrado",
    "Gateway Timeout": "Tiempo de espera de puerta de enlace",
    "Go Home": "Ir a inicio",
    "Go to page :page": "Ir a la página :page",
    "Gone": "Recurso no disponible",
    "Hello!": "¡Hola!",
    "Hide": "Ocultar",
    "Hide :name": "Ocultar :name",
    "Home": "Inicio",
    "HTTP Version Not Supported": "Versión HTTP no compatible",
    "I'm a teapot": "Soy una tetera",
    "If you did not create an account, no further action is required.": "Si no ha creado una cuenta, no se requiere ninguna acción adicional.",
    "If you did not request a password reset, no further action is required.": "Si no ha solicitado el restablecimiento de contraseña, omita este mensaje de correo electrónico.",
    "If you're having trouble clicking the \":actionText\" button, copy and paste the URL below\ninto your web browser:": "Si está teniendo problemas al hacer clic en el botón \":actionText\", copie y pegue la URL de abajo\nen su navegador web:",
    "IM Used": "IM usado",
    "Image": "Imagen",
    "Impersonate": "Personificar",
    "Impersonation": "Personificación",
    "Import": "Importar",
    "Import :name": "Importar :name",
    "Insufficient Storage": "Espacio insuficiente",
    "Internal Server Error": "Error interno del servidor",
    "Introduction": "Introducción",
    "Invalid filename.": "Nombre de archivo no válido.",
    "Invalid JSON was returned from the route.": "Se devolvió un JSON no válido desde la ruta.",
    "Invalid SSL Certificate": "Certificado SSL no válido",
    "Length Required": "Longitud requerida",
    "Like": "Me gusta",
    "Load": "Cargar",
    "Localize": "Localizar",
    "Location": "Ubicación",
    "Locked": "Bloqueado",
    "Log In": "Iniciar sesión",
    "Log in": "Iniciar sesión",
    "Log Out": "Finalizar sesión",
    "Login": "Iniciar sesión",
    "Logout": "Finalizar sesión",
    "Loop Detected": "Bucle detectado",
    "Maintenance Mode": "Modo de mantenimiento",
    "Method Not Allowed": "Método no permitido",
    "Misdirected Request": "Solicitud mal dirigida",
    "Moved Permanently": "Movido permanentemente",
    "Multi-Status": "Multiestado",
    "Multiple Choices": "Múltiples opciones",
    "Name": "Nombre",
    "name": "nombre",
    "Network Authentication Required": "Se requiere autenticación de red",
    "Network Connect Timeout Error": "Error de tiempo de espera de conexión de red",
    "Network Read Timeout Error": "Error de tiempo de espera de lectura de red",
    "New": "Nuevo",
    "New :name": "Nuevo :name",
    "New Password": "Nueva Contraseña",
    "No": "No",
    "No Content": "Sin contenido",
    "Non-Authoritative Information": "Información no autorizada",
    "Not Acceptable": "Inaceptable",
    "Not Extended": "no extendido",
    "Not Found": "No encontrado",
    "Not Implemented": "No se ha implementado",
    "Not Modified": "No modificado",
    "of": "de",
    "OK": "Correcto",
    "Once your account is deleted, all of its resources and data will be permanently deleted. Before deleting your account, please download any data or information that you wish to retain.": "Una vez que se elimine su cuenta, todos sus recursos y datos se eliminarán de forma permanente. Antes de borrar su cuenta, por favor descargue cualquier dato o información que desee conservar.",
    "Once your account is deleted, all of its resources and data will be permanently deleted. Please enter your password to confirm you would like to permanently delete your account.": "Una vez que se elimine su cuenta, todos sus recursos y datos se eliminarán de forma permanente. Ingrese su contraseña para confirmar que desea eliminar su cuenta de forma permanente.",
    "Open": "Abrir",
    "Open in a current window": "Abrir en una ventana actual",
    "Open in a new window": "Abrir en una ventana nueva",
    "Open in a parent frame": "Abrir en un marco principal",
    "Open in the topmost frame": "Abrir en el marco superior",
    "Open on the website": "Abrir en el sitio web",
    "Origin Is Unreachable": "El origen es inalcanzable",
    "Page Expired": "Página expirada",
    "Pagination Navigation": "Navegación por los enlaces de paginación",
    "Partial Content": "Contenido parcial",
    "Password": "Contraseña",
    "password": "La contraseña es incorrecta.",
    "Payload Too Large": "Solicitud demasiado grande",
    "Payment Required": "Pago requerido",
    "Permanent Redirect": "Redirección permanente",
    "Please click the button below to verify your email address.": "Por favor, haga clic en el botón de abajo para verificar su dirección de correo electrónico.",
    "Precondition Failed": "Error de condición previa",
    "Precondition Required": "Precondición requerida",
    "Preview": "Previsualizar",
    "Price": "Precio",
    "Processing": "Procesando",
    "Profile": "Perfil",
    "Profile Information": "Información de perfil",
    "Proxy Authentication Required": "Se requiere autenticación proxy",
    "Railgun Error": "Error de cañón de riel",
    "Range Not Satisfiable": "Rango no satisfactorio",
    "Record": "Registro",
    "Regards,": "Saludos,",
    "Register": "Registrarse",
    "Remember me": "Mantener sesión activa",
    "Request Header Fields Too Large": "Campos de encabezado de solicitud demasiado grandes",
    "Request Timeout": "Solicitud de tiempo de espera",
    "Resend Verification Email": "Reenviar correo de verificación",
    "Reset Content": "Restablecer contenido",
    "Reset Password": "Restablecer contraseña",
    "Reset Password Notification": "Notificación de restablecimiento de contraseña",
    "Restore": "Restaurar",
    "Restore :name": "Restaurar :name",
    "results": "resultados",
    "Retry With": "Reintentar con",
    "Save": "Guardar",
    "Save & Close": "Guardar y cerrar",
    "Save & Return": "Guardar y volver",
    "Save :name": "Guardar :name",
    "Saved.": "Guardado.",
    "Search": "Buscar",
    "Search :name": "Buscar :name",
    "See Other": "Ver otros",
    "Select": "Seleccione",
    "Select All": "Seleccionar todo",
    "Send": "Enviar",
    "Server Error": "Error del servidor",
    "Service Unavailable": "Servicio no disponible",
    "Session Has Expired": "La sesión ha expirado",
    "Settings": "Ajustes",
    "Show": "Mostrar",
    "Show :name": "Mostrar :name",
    "Show All": "Mostrar todo",
    "Showing": "Mostrando",
    "Sign In": "Iniciar sesión",
    "Solve": "Resolver",
    "SSL Handshake Failed": "Protocolo de enlace SSL fallido",
    "Start": "Comenzar",
    "Stop": "Detener",
    "Submit": "Enviar",
    "Subscribe": "Suscriba",
    "Switch": "Cambiar",
    "Switch To Role": "Cambiar de rol",
    "Switching Protocols": "Protocolos de conmutación",
    "Tag": "Etiqueta",
    "Tags": "Etiquetas",
    "Temporary Redirect": "Redirección temporal",
    "Thanks for signing up! Before getting started, could you verify your email address by clicking on the link we just emailed to you? If you didn't receive the email, we will gladly send you another.": "¡Gracias por registrarse! Antes de comenzar, ¿podría verificar su dirección de correo electrónico haciendo clic en el enlace que le acabamos de enviar? Si no recibió el correo electrónico, con gusto le enviaremos otro.",
    "The given data was invalid.": "Los datos proporcionados no son válidos.",
    "The response is not a streamed response.": "La respuesta no es una respuesta transmitida.",
    "The response is not a view.": "La respuesta no es una vista.",
    "This action is unauthorized.": "Esta acción no está autorizada.",
    "This is a secure area of the application. Please confirm your password before continuing.": "Esta es un área segura de la aplicación. Confirme su contraseña antes de continuar.",
    "This password reset link will expire in :count minutes.": "Este enlace de restablecimiento de contraseña expirará en :count minutos.",
    "to": "al",
    "Toggle navigation": "Alternar navegación",
    "Too Early": "Demasiado temprano",
    "Too Many Requests": "Demasiadas peticiones",
    "Translate": "Traducir",
    "Translate It": "Traducirlo",
    "Unauthorized": "No autorizado",
    "Unavailable For Legal Reasons": "No disponible por razones legales",
    "Unknown Error": "Error desconocido",
    "Unpack": "Desglosar",
    "Unprocessable Entity": "Entidad no procesable",
    "Unsubscribe": "Darse de baja",
    "Unsupported Media Type": "Tipo de medio no admitido",
    "Up": "Arriba",
    "Update": "Actualizar",
    "Update :name": "Actualizar :name",
    "Update Password": "Actualizar contraseña",
    "Update your account's profile information and email address.": "Actualice la información de su cuenta y la dirección de correo electrónico.",
    "Upgrade Required": "Se requiere actualización",
    "URI Too Long": "URI demasiado largo",
    "Use Proxy": "Usa proxy",
    "User": "Usuario",
    "Variant Also Negotiates": "Variante También Negocia",
    "Verify Email Address": "Confirme su correo electrónico",
    "View": "Ver",
    "View :name": "Ver :name",
    "Web Server is Down": "El servidor web está caído",
    "Whoops!": "¡Ups!",
    "Yes": "Sí",
    "You are receiving this email because we received a password reset request for your account.": "Ha recibido este mensaje porque se solicitó un restablecimiento de contraseña para su cuenta.",
    "You're logged in!": "¡Usted está conectado!",
    "Your email address is unverified.": "Su dirección de correo electrónico no está verificada."
}
</file>

<file path="lang/es/actions.php">
<?php

declare(strict_types=1);

return [
    'accept'          => 'Aceptar',
    'action'          => 'Acción',
    'actions'         => 'Acciones',
    'add'             => 'Agregar',
    'admin'           => 'Administrar',
    'agree'           => 'Aceptar',
    'archive'         => 'Archivar',
    'assign'          => 'Asignar',
    'associate'       => 'Asociar',
    'attach'          => 'Adjuntar',
    'browse'          => 'Navegar',
    'cancel'          => 'Cancelar',
    'choose'          => 'Elegir',
    'choose_file'     => 'Elegir archivo',
    'choose_image'    => 'Elegir Imagen',
    'click_to_copy'   => 'Haga clic para copiar',
    'close'           => 'Cerrar',
    'collapse'        => 'Colapsar',
    'collapse_all'    => 'Colapsar todo',
    'comment'         => 'Comentar',
    'confirm'         => 'Confirmar',
    'connect'         => 'Conectar',
    'create'          => 'Crear',
    'delete'          => 'Borrar',
    'detach'          => 'Desasociar',
    'details'         => 'Detalles',
    'disable'         => 'Desactivar',
    'discard'         => 'Descartar',
    'done'            => 'Hecho',
    'down'            => 'Abajo',
    'duplicate'       => 'Duplicar',
    'edit'            => 'Editar',
    'enable'          => 'Permitir',
    'expand'          => 'Expandir',
    'expand_all'      => 'Expandir todo',
    'explanation'     => 'Explicación',
    'export'          => 'Exportar',
    'file'            => 'Archivo',
    'files'           => 'Archivos',
    'go_home'         => 'Ir a Inicio',
    'hide'            => 'Ocultar',
    'home'            => 'Inicio',
    'image'           => 'Imagen',
    'impersonate'     => 'Personificar',
    'impersonation'   => 'Personificación',
    'import'          => 'Importar',
    'introduction'    => 'Introducción',
    'like'            => 'Me gusta',
    'load'            => 'Cargar',
    'localize'        => 'Localizar',
    'log_in'          => 'Acceder',
    'log_out'         => 'Cerrar sesión',
    'named'           => [
        'add'       => 'Agregar :name',
        'choose'    => 'Elegir :name',
        'create'    => 'Crear :name',
        'delete'    => 'Eliminar :name',
        'duplicate' => 'Duplicar :name',
        'edit'      => 'Editar :name',
        'export'    => 'Exportar :name',
        'hide'      => 'Ocultar :name',
        'import'    => 'Importar :name',
        'new'       => 'Nuevo :name',
        'restore'   => 'Restaurar :name',
        'save'      => 'Guardar :name',
        'search'    => 'Buscar :name',
        'show'      => 'Mostrar :name',
        'update'    => 'Actualizar :name',
        'view'      => 'Ver :name',
    ],
    'new'             => 'Nuevo',
    'no'              => 'No',
    'open'            => 'Abrir',
    'open_website'    => 'Abrir en el sitio web',
    'preview'         => 'Previsualizar',
    'price'           => 'Precio',
    'record'          => 'Registro',
    'restore'         => 'Restaurar',
    'save'            => 'Guardar',
    'save_and_close'  => 'Guardar y cerrar',
    'save_and_return' => 'Guardar y volver',
    'search'          => 'Buscar',
    'select'          => 'Seleccionar',
    'select_all'      => 'Seleccionar todo',
    'send'            => 'Enviar',
    'settings'        => 'Ajustes',
    'show'            => 'Mostrar',
    'show_all'        => 'Mostrar todo',
    'sign_in'         => 'Iniciar sesión',
    'solve'           => 'Resolver',
    'start'           => 'Comenzar',
    'stop'            => 'Detener',
    'submit'          => 'Enviar',
    'subscribe'       => 'Suscribir',
    'switch'          => 'Cambiar',
    'switch_to_role'  => 'Cambiar de rol',
    'tag'             => 'Etiqueta',
    'tags'            => 'Etiquetas',
    'target_link'     => [
        'blank'  => 'Abrir en una ventana nueva',
        'parent' => 'Abrir en el marco principal',
        'self'   => 'Abrir en la ventana actual',
        'top'    => 'Abrir en el marco superior',
    ],
    'translate'       => 'Traducir',
    'translate_it'    => 'Traducirlo',
    'unpack'          => 'Desglosar',
    'unsubscribe'     => 'Darse de baja',
    'up'              => 'Arriba',
    'update'          => 'Actualizar',
    'user'            => 'Usuario',
    'view'            => 'Ver',
    'yes'             => 'Sí',
];
</file>

<file path="lang/es/auth.php">
<?php

declare(strict_types=1);

return [
    'failed'   => 'Estas credenciales no coinciden con nuestros registros.',
    'password' => 'La contraseña es incorrecta.',
    'throttle' => 'Demasiados intentos de acceso. Por favor intente nuevamente en :seconds segundos.',
];
</file>

<file path="lang/es/http-statuses.php">
<?php

declare(strict_types=1);

return [
    '0'            => 'Error desconocido',
    '100'          => 'Continuar',
    '101'          => 'Protocolos de conmutación',
    '102'          => 'Procesando',
    '200'          => 'DE ACUERDO',
    '201'          => 'Creado',
    '202'          => 'Aceptado',
    '203'          => 'Información no autorizada',
    '204'          => 'Sin contenido',
    '205'          => 'Restablecer contenido',
    '206'          => 'Contenido parcial',
    '207'          => 'Multiestado',
    '208'          => 'Ya Reportado',
    '226'          => 'IM usado',
    '300'          => 'Múltiples opciones',
    '301'          => 'Movido permanentemente',
    '302'          => 'Encontrado',
    '303'          => 'Ver otros',
    '304'          => 'No modificado',
    '305'          => 'Usa proxy',
    '307'          => 'Redirección temporal',
    '308'          => 'Redirección permanente',
    '400'          => 'Solicitud incorrecta',
    '401'          => 'No autorizado',
    '402'          => 'Pago requerido',
    '403'          => 'Prohibido',
    '404'          => 'No encontrado',
    '405'          => 'Método no permitido',
    '406'          => 'Inaceptable',
    '407'          => 'Se requiere autenticación proxy',
    '408'          => 'Solicitud de tiempo de espera',
    '409'          => 'Conflicto',
    '410'          => 'Recurso no disponible',
    '411'          => 'Longitud requerida',
    '412'          => 'Error de condición previa',
    '413'          => 'Solicitud demasiado grande',
    '414'          => 'URI demasiado largo',
    '415'          => 'Tipo de medio no admitido',
    '416'          => 'Rango no satisfactorio',
    '417'          => 'Expectativa fallida',
    '418'          => 'Soy una tetera',
    '419'          => 'La sesión ha expirado',
    '421'          => 'Solicitud mal dirigida',
    '422'          => 'Entidad no procesable',
    '423'          => 'Bloqueado',
    '424'          => 'Dependencia fallida',
    '425'          => 'Demasiado temprano',
    '426'          => 'Se requiere actualización',
    '428'          => 'Precondición requerida',
    '429'          => 'Demasiadas solicitudes',
    '431'          => 'Campos de encabezado de solicitud demasiado grandes',
    '444'          => 'Conexión cerrada sin respuesta',
    '449'          => 'Reintentar con',
    '451'          => 'No disponible por razones legales',
    '499'          => 'Solicitud cerrada del cliente',
    '500'          => 'Error interno del servidor',
    '501'          => 'No se ha implementado',
    '502'          => 'Mala puerta de enlace',
    '503'          => 'Modo de mantenimiento',
    '504'          => 'Tiempo de espera de puerta de enlace',
    '505'          => 'Versión HTTP no compatible',
    '506'          => 'Variante También Negocia',
    '507'          => 'Espacio insuficiente',
    '508'          => 'Bucle detectado',
    '509'          => 'Límite de ancho de banda excedido',
    '510'          => 'no extendido',
    '511'          => 'Se requiere autenticación de red',
    '520'          => 'Error desconocido',
    '521'          => 'El servidor web está caído',
    '522'          => 'Tiempo de conexión agotado',
    '523'          => 'El origen es inalcanzable',
    '524'          => 'Se produjo un tiempo de espera',
    '525'          => 'Protocolo de enlace SSL fallido',
    '526'          => 'Certificado SSL no válido',
    '527'          => 'Error de cañón de riel',
    '598'          => 'Error de tiempo de espera de lectura de red',
    '599'          => 'Error de tiempo de espera de conexión de red',
    'unknownError' => 'Error desconocido',
];
</file>

<file path="lang/es/pagination.php">
<?php

declare(strict_types=1);

return [
    'next'     => 'Siguiente &raquo;',
    'previous' => '&laquo; Anterior',
];
</file>

<file path="lang/es/passwords.php">
<?php

declare(strict_types=1);

return [
    'reset'     => 'Su contraseña ha sido restablecida.',
    'sent'      => 'Le hemos enviado por correo electrónico el enlace para restablecer su contraseña.',
    'throttled' => 'Por favor espere antes de intentar de nuevo.',
    'token'     => 'El token de restablecimiento de contraseña es inválido.',
    'user'      => 'No encontramos ningún usuario con ese correo electrónico.',
];
</file>

<file path="lang/es/validation.php">
<?php

declare(strict_types=1);

return [
    'accepted'               => 'El campo :attribute debe ser aceptado.',
    'accepted_if'            => 'El campo :attribute debe ser aceptado cuando :other sea :value.',
    'active_url'             => 'El campo :attribute debe ser una URL válida.',
    'after'                  => 'El campo :attribute debe ser una fecha posterior a :date.',
    'after_or_equal'         => 'El campo :attribute debe ser una fecha posterior o igual a :date.',
    'alpha'                  => 'El campo :attribute sólo debe contener letras.',
    'alpha_dash'             => 'El campo :attribute sólo debe contener letras, números, guiones y guiones bajos.',
    'alpha_num'              => 'El campo :attribute sólo debe contener letras y números.',
    'any_of'                 => 'El campo :attribute no es válido.',
    'array'                  => 'El campo :attribute debe ser un conjunto.',
    'ascii'                  => 'El campo :attribute solo debe contener caracteres alfanuméricos y símbolos de un solo byte.',
    'before'                 => 'El campo :attribute debe ser una fecha anterior a :date.',
    'before_or_equal'        => 'El campo :attribute debe ser una fecha anterior o igual a :date.',
    'between'                => [
        'array'   => 'El campo :attribute tiene que tener entre :min - :max elementos.',
        'file'    => 'El campo :attribute debe pesar entre :min - :max kilobytes.',
        'numeric' => 'El campo :attribute tiene que estar entre :min - :max.',
        'string'  => 'El campo :attribute tiene que tener entre :min - :max caracteres.',
    ],
    'boolean'                => 'El campo :attribute debe tener un valor verdadero o falso.',
    'can'                    => 'El campo :attribute contiene un valor no autorizado.',
    'confirmed'              => 'La confirmación de :attribute no coincide.',
    'contains'               => 'Al campo :attribute le falta un valor obligatorio.',
    'current_password'       => 'La contraseña es incorrecta.',
    'date'                   => 'El campo :attribute debe ser una fecha válida.',
    'date_equals'            => 'El campo :attribute debe ser una fecha igual a :date.',
    'date_format'            => 'El campo :attribute debe coincidir con el formato :format.',
    'decimal'                => 'El campo :attribute debe tener :decimal cifras decimales.',
    'declined'               => 'El campo :attribute debe ser rechazado.',
    'declined_if'            => 'El campo :attribute debe ser rechazado cuando :other sea :value.',
    'different'              => 'El campo :attribute y :other deben ser diferentes.',
    'digits'                 => 'El campo :attribute debe tener :digits dígitos.',
    'digits_between'         => 'El campo :attribute debe tener entre :min y :max dígitos.',
    'dimensions'             => 'El campo :attribute tiene dimensiones de imagen no válidas.',
    'distinct'               => 'El campo :attribute contiene un valor duplicado.',
    'doesnt_contain'         => 'El campo :attribute no debe contener ninguno de los siguientes valores: :values.',
    'doesnt_end_with'        => 'El campo :attribute no debe finalizar con uno de los siguientes: :values.',
    'doesnt_start_with'      => 'El campo :attribute no debe comenzar con uno de los siguientes: :values.',
    'email'                  => 'El campo :attribute no es un correo válido.',
    'ends_with'              => 'El campo :attribute debe finalizar con uno de los siguientes valores: :values',
    'enum'                   => 'El campo :attribute no está en la lista de valores permitidos.',
    'exists'                 => 'El campo :attribute no existe.',
    'extensions'             => 'El campo :attribute debe tener una de las siguientes extensiones: :values.',
    'file'                   => 'El campo :attribute debe ser un archivo.',
    'filled'                 => 'El campo :attribute es obligatorio.',
    'gt'                     => [
        'array'   => 'El campo :attribute debe tener más de :value elementos.',
        'file'    => 'El campo :attribute debe tener más de :value kilobytes.',
        'numeric' => 'El campo :attribute debe ser mayor que :value.',
        'string'  => 'El campo :attribute debe tener más de :value caracteres.',
    ],
    'gte'                    => [
        'array'   => 'El campo :attribute debe tener como mínimo :value elementos.',
        'file'    => 'El campo :attribute debe tener como mínimo :value kilobytes.',
        'numeric' => 'El campo :attribute debe ser como mínimo :value.',
        'string'  => 'El campo :attribute debe tener como mínimo :value caracteres.',
    ],
    'hex_color'              => 'El campo :attribute debe tener un color hexadecimal válido.',
    'image'                  => 'El campo :attribute debe ser una imagen.',
    'in'                     => 'El campo :attribute no está en la lista de valores permitidos.',
    'in_array'               => 'El campo :attribute debe existir en :other.',
    'in_array_keys'          => 'El campo :attribute debe contener al menos una de las siguientes claves: :values.',
    'integer'                => 'El campo :attribute debe ser un número entero.',
    'ip'                     => 'El campo :attribute debe ser una dirección IP válida.',
    'ipv4'                   => 'El campo :attribute debe ser una dirección IPv4 válida.',
    'ipv6'                   => 'El campo :attribute debe ser una dirección IPv6 válida.',
    'json'                   => 'El campo :attribute debe ser una cadena JSON válida.',
    'list'                   => 'El campo :attribute debe ser una lista.',
    'lowercase'              => 'El campo :attribute debe estar en minúscula.',
    'lt'                     => [
        'array'   => 'El campo :attribute debe tener menos de :value elementos.',
        'file'    => 'El campo :attribute debe tener menos de :value kilobytes.',
        'numeric' => 'El campo :attribute debe ser menor que :value.',
        'string'  => 'El campo :attribute debe tener menos de :value caracteres.',
    ],
    'lte'                    => [
        'array'   => 'El campo :attribute debe tener como máximo :value elementos.',
        'file'    => 'El campo :attribute debe tener como máximo :value kilobytes.',
        'numeric' => 'El campo :attribute debe ser como máximo :value.',
        'string'  => 'El campo :attribute debe tener como máximo :value caracteres.',
    ],
    'mac_address'            => 'El campo :attribute debe ser una dirección MAC válida.',
    'max'                    => [
        'array'   => 'El campo :attribute no debe tener más de :max elementos.',
        'file'    => 'El campo :attribute no debe ser mayor que :max kilobytes.',
        'numeric' => 'El campo :attribute no debe ser mayor que :max.',
        'string'  => 'El campo :attribute no debe ser mayor que :max caracteres.',
    ],
    'max_digits'             => 'El campo :attribute no debe tener más de :max dígitos.',
    'mimes'                  => 'El campo :attribute debe ser un archivo con formato: :values.',
    'mimetypes'              => 'El campo :attribute debe ser un archivo con formato: :values.',
    'min'                    => [
        'array'   => 'El campo :attribute debe tener al menos :min elementos.',
        'file'    => 'El tamaño de :attribute debe ser de al menos :min kilobytes.',
        'numeric' => 'El tamaño de :attribute debe ser de al menos :min.',
        'string'  => 'El campo :attribute debe contener al menos :min caracteres.',
    ],
    'min_digits'             => 'El campo :attribute debe tener al menos :min dígitos.',
    'missing'                => 'El campo :attribute no debe estar presente.',
    'missing_if'             => 'El campo :attribute no debe estar presente cuando :other sea :value.',
    'missing_unless'         => 'El campo :attribute no debe estar presente a menos que :other sea :value.',
    'missing_with'           => 'El campo :attribute no debe estar presente si alguno de los campos :values está presente.',
    'missing_with_all'       => 'El campo :attribute no debe estar presente cuando los campos :values estén presentes.',
    'multiple_of'            => 'El campo :attribute debe ser múltiplo de :value',
    'not_in'                 => 'El campo :attribute no debe estar en la lista.',
    'not_regex'              => 'El formato del campo :attribute no es válido.',
    'numeric'                => 'El campo :attribute debe ser numérico.',
    'password'               => [
        'letters'       => 'La :attribute debe contener al menos una letra.',
        'mixed'         => 'La :attribute debe contener al menos una letra mayúscula y una minúscula.',
        'numbers'       => 'La :attribute debe contener al menos un número.',
        'symbols'       => 'La :attribute debe contener al menos un símbolo.',
        'uncompromised' => 'La :attribute proporcionada se ha visto comprometida en una filtración de datos (data leak). Elija una :attribute diferente.',
    ],
    'present'                => 'El campo :attribute debe estar presente.',
    'present_if'             => 'El campo :attribute debe estar presente cuando :other es :value.',
    'present_unless'         => 'El campo :attribute debe estar presente a menos que :other sea :value.',
    'present_with'           => 'El campo :attribute debe estar presente cuando :values esté presente.',
    'present_with_all'       => 'El campo :attribute debe estar presente cuando :values estén presentes.',
    'prohibited'             => 'El campo :attribute está prohibido.',
    'prohibited_if'          => 'El campo :attribute está prohibido cuando :other es :value.',
    'prohibited_if_accepted' => 'El campo :attribute está prohibido cuando se acepta :other.',
    'prohibited_if_declined' => 'El campo :attribute está prohibido cuando se rechaza :other.',
    'prohibited_unless'      => 'El campo :attribute está prohibido a menos que :other sea :values.',
    'prohibits'              => 'El campo :attribute prohibe que :other esté presente.',
    'regex'                  => 'El formato del campo :attribute no es válido.',
    'required'               => 'El campo :attribute es obligatorio.',
    'required_array_keys'    => 'El campo :attribute debe contener entradas para: :values.',
    'required_if'            => 'El campo :attribute es obligatorio cuando :other es :value.',
    'required_if_accepted'   => 'El campo :attribute es obligatorio si :other es aceptado.',
    'required_if_declined'   => 'El campo :attribute es obligatorio si :other es rechazado.',
    'required_unless'        => 'El campo :attribute es obligatorio a menos que :other esté en :values.',
    'required_with'          => 'El campo :attribute es obligatorio cuando :values está presente.',
    'required_with_all'      => 'El campo :attribute es obligatorio cuando :values están presentes.',
    'required_without'       => 'El campo :attribute es obligatorio cuando :values no está presente.',
    'required_without_all'   => 'El campo :attribute es obligatorio cuando ninguno de :values está presente.',
    'same'                   => 'Los campos :attribute y :other deben coincidir.',
    'size'                   => [
        'array'   => 'El campo :attribute debe contener :size elementos.',
        'file'    => 'El tamaño de :attribute debe ser :size kilobytes.',
        'numeric' => 'El tamaño de :attribute debe ser :size.',
        'string'  => 'El campo :attribute debe contener :size caracteres.',
    ],
    'starts_with'            => 'El campo :attribute debe comenzar con uno de los siguientes valores: :values',
    'string'                 => 'El campo :attribute debe ser una cadena de caracteres.',
    'timezone'               => 'El campo :attribute debe ser una zona horaria válida.',
    'ulid'                   => 'El campo :attribute debe ser un ULID válido.',
    'unique'                 => 'El campo :attribute ya ha sido registrado.',
    'uploaded'               => 'Subir :attribute ha fallado.',
    'uppercase'              => 'El campo :attribute debe estar en mayúscula.',
    'url'                    => 'El campo :attribute debe ser una URL válida.',
    'uuid'                   => 'El campo :attribute debe ser un UUID válido.',
    'attributes'             => [
        'address'                  => 'dirección',
        'affiliate_url'            => 'URL de afiliado',
        'age'                      => 'edad',
        'amount'                   => 'cantidad',
        'announcement'             => 'anuncio',
        'area'                     => 'área',
        'audience_prize'           => 'premio del público',
        'audience_winner'          => 'ganador del público',
        'available'                => 'disponible',
        'birthday'                 => 'cumpleaños',
        'body'                     => 'contenido',
        'city'                     => 'ciudad',
        'company'                  => 'compañía',
        'compilation'              => 'compilación',
        'concept'                  => 'concepto',
        'conditions'               => 'condiciones',
        'content'                  => 'contenido',
        'contest'                  => 'concurso',
        'country'                  => 'país',
        'cover'                    => 'portada',
        'created_at'               => 'creado el',
        'creator'                  => 'creador',
        'currency'                 => 'moneda',
        'current_password'         => 'contraseña actual',
        'customer'                 => 'cliente',
        'date'                     => 'fecha',
        'date_of_birth'            => 'fecha de nacimiento',
        'dates'                    => 'fechas',
        'day'                      => 'día',
        'deleted_at'               => 'eliminado el',
        'description'              => 'descripción',
        'display_type'             => 'tipo de visualización',
        'district'                 => 'distrito',
        'duration'                 => 'duración',
        'email'                    => 'correo electrónico',
        'excerpt'                  => 'extracto',
        'filter'                   => 'filtro',
        'finished_at'              => 'terminado el',
        'first_name'               => 'nombre',
        'gender'                   => 'género',
        'grand_prize'              => 'gran Premio',
        'group'                    => 'grupo',
        'hour'                     => 'hora',
        'image'                    => 'imagen',
        'image_desktop'            => 'imagen de escritorio',
        'image_main'               => 'imagen principal',
        'image_mobile'             => 'imagen móvil',
        'images'                   => 'imágenes',
        'is_audience_winner'       => 'es ganador de audiencia',
        'is_hidden'                => 'está oculto',
        'is_subscribed'            => 'está suscrito',
        'is_visible'               => 'es visible',
        'is_winner'                => 'es ganador',
        'items'                    => 'elementos',
        'key'                      => 'clave',
        'last_name'                => 'apellidos',
        'lesson'                   => 'lección',
        'line_address_1'           => 'línea de dirección 1',
        'line_address_2'           => 'línea de dirección 2',
        'login'                    => 'acceso',
        'message'                  => 'mensaje',
        'middle_name'              => 'segundo nombre',
        'minute'                   => 'minuto',
        'mobile'                   => 'móvil',
        'month'                    => 'mes',
        'name'                     => 'nombre',
        'national_code'            => 'código nacional',
        'number'                   => 'número',
        'password'                 => 'contraseña',
        'password_confirmation'    => 'confirmación de la contraseña',
        'phone'                    => 'teléfono',
        'photo'                    => 'foto',
        'portfolio'                => 'portafolio',
        'postal_code'              => 'código postal',
        'preview'                  => 'vista preliminar',
        'price'                    => 'precio',
        'product_id'               => 'ID del producto',
        'product_uid'              => 'UID del producto',
        'product_uuid'             => 'UUID del producto',
        'promo_code'               => 'código promocional',
        'province'                 => 'provincia',
        'quantity'                 => 'cantidad',
        'reason'                   => 'razón',
        'recaptcha_response_field' => 'respuesta del recaptcha',
        'referee'                  => 'árbitro',
        'referees'                 => 'árbitros',
        'reject_reason'            => 'motivo de rechazo',
        'remember'                 => 'recordar',
        'restored_at'              => 'restaurado el',
        'result_text_under_image'  => 'texto bajo la imagen',
        'role'                     => 'rol',
        'rule'                     => 'regla',
        'rules'                    => 'reglas',
        'second'                   => 'segundo',
        'sex'                      => 'sexo',
        'shipment'                 => 'envío',
        'short_text'               => 'texto corto',
        'size'                     => 'tamaño',
        'skills'                   => 'habilidades',
        'slug'                     => 'slug',
        'specialization'           => 'especialización',
        'started_at'               => 'comenzado el',
        'state'                    => 'estado',
        'status'                   => 'estado',
        'street'                   => 'calle',
        'student'                  => 'estudiante',
        'subject'                  => 'asunto',
        'tag'                      => 'etiqueta',
        'tags'                     => 'etiquetas',
        'teacher'                  => 'profesor',
        'terms'                    => 'términos',
        'test_description'         => 'descripción de prueba',
        'test_locale'              => 'idioma de prueba',
        'test_name'                => 'nombre de prueba',
        'text'                     => 'texto',
        'time'                     => 'hora',
        'title'                    => 'título',
        'type'                     => 'tipo',
        'updated_at'               => 'actualizado el',
        'user'                     => 'usuario',
        'username'                 => 'usuario',
        'value'                    => 'valor',
        'winner'                   => 'ganador',
        'work'                     => 'trabajo',
        'year'                     => 'año',
    ],
];
</file>

<file path="package.json">
{
    "$schema": "https://json.schemastore.org/package.json",
    "private": true,
    "type": "module",
    "scripts": {
        "build": "vite build",
        "dev": "vite"
    },
    "devDependencies": {
        "@inertiajs/vue3": "^2.0.0",
        "@tailwindcss/forms": "^0.5.3",
        "@tailwindcss/vite": "^4.0.0",
        "@vitejs/plugin-vue": "^6.0.1",
        "autoprefixer": "^10.4.12",
        "axios": "^1.11.0",
        "concurrently": "^9.0.1",
        "laravel-vite-plugin": "^2.0.0",
        "postcss": "^8.4.31",
        "tailwindcss": "^3.2.1",
        "vite": "^7.0.7",
        "vue": "^3.4.0"
    }
}
</file>

<file path="phpunit.xml">
<?xml version="1.0" encoding="UTF-8"?>
<phpunit xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:noNamespaceSchemaLocation="vendor/phpunit/phpunit/phpunit.xsd"
         bootstrap="vendor/autoload.php"
         colors="true"
>
    <testsuites>
        <testsuite name="Unit">
            <directory>tests/Unit</directory>
        </testsuite>
        <testsuite name="Feature">
            <directory>tests/Feature</directory>
        </testsuite>
    </testsuites>
    <source>
        <include>
            <directory>app</directory>
        </include>
    </source>
    <php>
        <env name="APP_ENV" value="testing"/>
        <env name="APP_MAINTENANCE_DRIVER" value="file"/>
        <env name="BCRYPT_ROUNDS" value="4"/>
        <env name="BROADCAST_CONNECTION" value="null"/>
        <env name="CACHE_STORE" value="array"/>
        <env name="DB_CONNECTION" value="sqlite"/>
        <env name="DB_DATABASE" value=":memory:"/>
        <env name="MAIL_MAILER" value="array"/>
        <env name="QUEUE_CONNECTION" value="sync"/>
        <env name="SESSION_DRIVER" value="array"/>
        <env name="PULSE_ENABLED" value="false"/>
        <env name="TELESCOPE_ENABLED" value="false"/>
        <env name="NIGHTWATCH_ENABLED" value="false"/>
    </php>
</phpunit>
</file>

<file path="postcss.config.js">
export default {
    plugins: {
        tailwindcss: {},
        autoprefixer: {},
    },
};
</file>

<file path="public/.htaccess">
<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        Options -MultiViews -Indexes
    </IfModule>

    RewriteEngine On

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Handle X-XSRF-Token Header
    RewriteCond %{HTTP:x-xsrf-token} .
    RewriteRule .* - [E=HTTP_X_XSRF_TOKEN:%{HTTP:X-XSRF-Token}]

    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Send Requests To Front Controller...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
</IfModule>
</file>

<file path="public/index.php">
<?php

use Illuminate\Foundation\Application;
use Illuminate\Http\Request;

define('LARAVEL_START', microtime(true));

// Determine if the application is in maintenance mode...
if (file_exists($maintenance = __DIR__.'/../storage/framework/maintenance.php')) {
    require $maintenance;
}

// Register the Composer autoloader...
require __DIR__.'/../vendor/autoload.php';

// Bootstrap Laravel and handle the request...
/** @var Application $app */
$app = require_once __DIR__.'/../bootstrap/app.php';

$app->handleRequest(Request::capture());
</file>

<file path="public/robots.txt">
User-agent: *
Disallow:
</file>

<file path="README.md">
<p align="center"><a href="https://laravel.com" target="_blank"><img src="https://raw.githubusercontent.com/laravel/art/master/logo-lockup/5%20SVG/2%20CMYK/1%20Full%20Color/laravel-logolockup-cmyk-red.svg" width="400" alt="Laravel Logo"></a></p>

<p align="center">
<a href="https://github.com/laravel/framework/actions"><img src="https://github.com/laravel/framework/workflows/tests/badge.svg" alt="Build Status"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://img.shields.io/packagist/dt/laravel/framework" alt="Total Downloads"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://img.shields.io/packagist/v/laravel/framework" alt="Latest Stable Version"></a>
<a href="https://packagist.org/packages/laravel/framework"><img src="https://img.shields.io/packagist/l/laravel/framework" alt="License"></a>
</p>

## About Laravel

Laravel is a web application framework with expressive, elegant syntax. We believe development must be an enjoyable and creative experience to be truly fulfilling. Laravel takes the pain out of development by easing common tasks used in many web projects, such as:

- [Simple, fast routing engine](https://laravel.com/docs/routing).
- [Powerful dependency injection container](https://laravel.com/docs/container).
- Multiple back-ends for [session](https://laravel.com/docs/session) and [cache](https://laravel.com/docs/cache) storage.
- Expressive, intuitive [database ORM](https://laravel.com/docs/eloquent).
- Database agnostic [schema migrations](https://laravel.com/docs/migrations).
- [Robust background job processing](https://laravel.com/docs/queues).
- [Real-time event broadcasting](https://laravel.com/docs/broadcasting).

Laravel is accessible, powerful, and provides tools required for large, robust applications.

## Learning Laravel

Laravel has the most extensive and thorough [documentation](https://laravel.com/docs) and video tutorial library of all modern web application frameworks, making it a breeze to get started with the framework. You can also check out [Laravel Learn](https://laravel.com/learn), where you will be guided through building a modern Laravel application.

If you don't feel like reading, [Laracasts](https://laracasts.com) can help. Laracasts contains thousands of video tutorials on a range of topics including Laravel, modern PHP, unit testing, and JavaScript. Boost your skills by digging into our comprehensive video library.

## Laravel Sponsors

We would like to extend our thanks to the following sponsors for funding Laravel development. If you are interested in becoming a sponsor, please visit the [Laravel Partners program](https://partners.laravel.com).

### Premium Partners

- **[Vehikl](https://vehikl.com)**
- **[Tighten Co.](https://tighten.co)**
- **[Kirschbaum Development Group](https://kirschbaumdevelopment.com)**
- **[64 Robots](https://64robots.com)**
- **[Curotec](https://www.curotec.com/services/technologies/laravel)**
- **[DevSquad](https://devsquad.com/hire-laravel-developers)**
- **[Redberry](https://redberry.international/laravel-development)**
- **[Active Logic](https://activelogic.com)**

## Contributing

Thank you for considering contributing to the Laravel framework! The contribution guide can be found in the [Laravel documentation](https://laravel.com/docs/contributions).

## Code of Conduct

In order to ensure that the Laravel community is welcoming to all, please review and abide by the [Code of Conduct](https://laravel.com/docs/contributions#code-of-conduct).

## Security Vulnerabilities

If you discover a security vulnerability within Laravel, please send an e-mail to Taylor Otwell via [taylor@laravel.com](mailto:taylor@laravel.com). All security vulnerabilities will be promptly addressed.

## License

The Laravel framework is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).
</file>

<file path="resources/css/app.css">
@tailwind base;
@tailwind components;
@tailwind utilities;
</file>

<file path="resources/js/app.js">
import '../css/app.css';
import './bootstrap';

import { createInertiaApp } from '@inertiajs/vue3';
import { resolvePageComponent } from 'laravel-vite-plugin/inertia-helpers';
import { createApp, h } from 'vue';
import { ZiggyVue } from '../../vendor/tightenco/ziggy';

const appName = import.meta.env.VITE_APP_NAME || 'Laravel';

createInertiaApp({
    title: (title) => `${title} - ${appName}`,
    resolve: (name) =>
        resolvePageComponent(
            `./Pages/${name}.vue`,
            import.meta.glob('./Pages/**/*.vue'),
        ),
    setup({ el, App, props, plugin }) {
        return createApp({ render: () => h(App, props) })
            .use(plugin)
            .use(ZiggyVue)
            .mount(el);
    },
    progress: {
        color: '#4B5563',
    },
});
</file>

<file path="resources/js/bootstrap.js">
import axios from 'axios';
window.axios = axios;

window.axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
</file>

<file path="resources/js/Components/Checkbox.vue">
<script setup>
import { computed } from 'vue';

const emit = defineEmits(['update:checked']);

const props = defineProps({
    checked: {
        type: [Array, Boolean],
        required: true,
    },
    value: {
        default: null,
    },
});

const proxyChecked = computed({
    get() {
        return props.checked;
    },

    set(val) {
        emit('update:checked', val);
    },
});
</script>

<template>
    <input
        type="checkbox"
        :value="value"
        v-model="proxyChecked"
        class="rounded border-gray-300 text-indigo-600 shadow-sm focus:ring-indigo-500"
    />
</template>
</file>

<file path="resources/js/Components/DangerButton.vue">
<template>
    <button
        class="inline-flex items-center rounded-md border border-transparent bg-red-600 px-4 py-2 text-xs font-semibold uppercase tracking-widest text-white transition duration-150 ease-in-out hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 active:bg-red-700"
    >
        <slot />
    </button>
</template>
</file>

<file path="resources/js/Components/Dropdown.vue">
<script setup>
import { computed, onMounted, onUnmounted, ref } from 'vue';

const props = defineProps({
    align: {
        type: String,
        default: 'right',
    },
    width: {
        type: String,
        default: '48',
    },
    contentClasses: {
        type: String,
        default: 'py-1 bg-white',
    },
});

const closeOnEscape = (e) => {
    if (open.value && e.key === 'Escape') {
        open.value = false;
    }
};

onMounted(() => document.addEventListener('keydown', closeOnEscape));
onUnmounted(() => document.removeEventListener('keydown', closeOnEscape));

const widthClass = computed(() => {
    return {
        48: 'w-48',
    }[props.width.toString()];
});

const alignmentClasses = computed(() => {
    if (props.align === 'left') {
        return 'ltr:origin-top-left rtl:origin-top-right start-0';
    } else if (props.align === 'right') {
        return 'ltr:origin-top-right rtl:origin-top-left end-0';
    } else {
        return 'origin-top';
    }
});

const open = ref(false);
</script>

<template>
    <div class="relative">
        <div @click="open = !open">
            <slot name="trigger" />
        </div>

        <!-- Full Screen Dropdown Overlay -->
        <div
            v-show="open"
            class="fixed inset-0 z-40"
            @click="open = false"
        ></div>

        <Transition
            enter-active-class="transition ease-out duration-200"
            enter-from-class="opacity-0 scale-95"
            enter-to-class="opacity-100 scale-100"
            leave-active-class="transition ease-in duration-75"
            leave-from-class="opacity-100 scale-100"
            leave-to-class="opacity-0 scale-95"
        >
            <div
                v-show="open"
                class="absolute z-50 mt-2 rounded-md shadow-lg"
                :class="[widthClass, alignmentClasses]"
                style="display: none"
                @click="open = false"
            >
                <div
                    class="rounded-md ring-1 ring-black ring-opacity-5"
                    :class="contentClasses"
                >
                    <slot name="content" />
                </div>
            </div>
        </Transition>
    </div>
</template>
</file>

<file path="resources/js/Components/DropdownLink.vue">
<script setup>
import { Link } from '@inertiajs/vue3';

defineProps({
    href: {
        type: String,
        required: true,
    },
});
</script>

<template>
    <Link
        :href="href"
        class="block w-full px-4 py-2 text-start text-sm leading-5 text-gray-700 transition duration-150 ease-in-out hover:bg-gray-100 focus:bg-gray-100 focus:outline-none"
    >
        <slot />
    </Link>
</template>
</file>

<file path="resources/js/Components/InputError.vue">
<script setup>
defineProps({
    message: {
        type: String,
    },
});
</script>

<template>
    <div v-show="message">
        <p class="text-sm text-red-600">
            {{ message }}
        </p>
    </div>
</template>
</file>

<file path="resources/js/Components/InputLabel.vue">
<script setup>
defineProps({
    value: {
        type: String,
    },
});
</script>

<template>
    <label class="block text-sm font-medium text-gray-700">
        <span v-if="value">{{ value }}</span>
        <span v-else><slot /></span>
    </label>
</template>
</file>

<file path="resources/js/Components/Modal.vue">
<script setup>
import { computed, onMounted, onUnmounted, ref, watch } from 'vue';

const props = defineProps({
    show: {
        type: Boolean,
        default: false,
    },
    maxWidth: {
        type: String,
        default: '2xl',
    },
    closeable: {
        type: Boolean,
        default: true,
    },
});

const emit = defineEmits(['close']);
const dialog = ref();
const showSlot = ref(props.show);

watch(
    () => props.show,
    () => {
        if (props.show) {
            document.body.style.overflow = 'hidden';
            showSlot.value = true;

            dialog.value?.showModal();
        } else {
            document.body.style.overflow = '';

            setTimeout(() => {
                dialog.value?.close();
                showSlot.value = false;
            }, 200);
        }
    },
);

const close = () => {
    if (props.closeable) {
        emit('close');
    }
};

const closeOnEscape = (e) => {
    if (e.key === 'Escape') {
        e.preventDefault();

        if (props.show) {
            close();
        }
    }
};

onMounted(() => document.addEventListener('keydown', closeOnEscape));

onUnmounted(() => {
    document.removeEventListener('keydown', closeOnEscape);

    document.body.style.overflow = '';
});

const maxWidthClass = computed(() => {
    return {
        sm: 'sm:max-w-sm',
        md: 'sm:max-w-md',
        lg: 'sm:max-w-lg',
        xl: 'sm:max-w-xl',
        '2xl': 'sm:max-w-2xl',
    }[props.maxWidth];
});
</script>

<template>
    <dialog
        class="z-50 m-0 min-h-full min-w-full overflow-y-auto bg-transparent backdrop:bg-transparent"
        ref="dialog"
    >
        <div
            class="fixed inset-0 z-50 overflow-y-auto px-4 py-6 sm:px-0"
            scroll-region
        >
            <Transition
                enter-active-class="ease-out duration-300"
                enter-from-class="opacity-0"
                enter-to-class="opacity-100"
                leave-active-class="ease-in duration-200"
                leave-from-class="opacity-100"
                leave-to-class="opacity-0"
            >
                <div
                    v-show="show"
                    class="fixed inset-0 transform transition-all"
                    @click="close"
                >
                    <div
                        class="absolute inset-0 bg-gray-500 opacity-75"
                    />
                </div>
            </Transition>

            <Transition
                enter-active-class="ease-out duration-300"
                enter-from-class="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                enter-to-class="opacity-100 translate-y-0 sm:scale-100"
                leave-active-class="ease-in duration-200"
                leave-from-class="opacity-100 translate-y-0 sm:scale-100"
                leave-to-class="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
            >
                <div
                    v-show="show"
                    class="mb-6 transform overflow-hidden rounded-lg bg-white shadow-xl transition-all sm:mx-auto sm:w-full"
                    :class="maxWidthClass"
                >
                    <slot v-if="showSlot" />
                </div>
            </Transition>
        </div>
    </dialog>
</template>
</file>

<file path="resources/js/Components/NavLink.vue">
<script setup>
import { computed } from 'vue';
import { Link } from '@inertiajs/vue3';

const props = defineProps({
    href: {
        type: String,
        required: true,
    },
    active: {
        type: Boolean,
    },
});

const classes = computed(() =>
    props.active
        ? 'inline-flex items-center px-1 pt-1 border-b-2 border-indigo-400 text-sm font-medium leading-5 text-gray-900 focus:outline-none focus:border-indigo-700 transition duration-150 ease-in-out'
        : 'inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium leading-5 text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out',
);
</script>

<template>
    <Link :href="href" :class="classes">
        <slot />
    </Link>
</template>
</file>

<file path="resources/js/Components/Pagination.vue">
<script setup>
import { Link } from '@inertiajs/vue3';

defineProps({
    links: {
        type: Array,
        required: true,
    },
});
</script>

<template>
    <div v-if="links.length > 3">
        <nav class="flex items-center justify-center">
            <template v-for="(link, key) in links" :key="key">
                <!-- Si el enlace no tiene URL (ej. '...'), lo mostramos deshabilitado -->
                <div v-if="link.url === null"
                     class="px-3 py-2 mx-1 text-sm leading-4 text-gray-400 border rounded-md"
                     v-html="link.label" />
                
                <!-- Si es un enlace normal, lo renderizamos con <Link> -->
                <Link v-else
                      class="px-3 py-2 mx-1 text-sm leading-4 border rounded-md focus:outline-none focus:border-indigo-500 hover:bg-gray-100"
                      :class="{ 'bg-gray-800 text-white': link.active }"
                      :href="link.url"
                      v-html="link.label" />
            </template>
        </nav>
    </div>
</template>
</file>

<file path="resources/js/Components/PrimaryButton.vue">
<template>
    <button
        class="inline-flex items-center rounded-md border border-transparent bg-gray-800 px-4 py-2 text-xs font-semibold uppercase tracking-widest text-white transition duration-150 ease-in-out hover:bg-gray-700 focus:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 active:bg-gray-900"
    >
        <slot />
    </button>
</template>
</file>

<file path="resources/js/Components/ResponsiveNavLink.vue">
<script setup>
import { computed } from 'vue';
import { Link } from '@inertiajs/vue3';

const props = defineProps({
    href: {
        type: String,
        required: true,
    },
    active: {
        type: Boolean,
    },
});

const classes = computed(() =>
    props.active
        ? 'block w-full ps-3 pe-4 py-2 border-l-4 border-indigo-400 text-start text-base font-medium text-indigo-700 bg-indigo-50 focus:outline-none focus:text-indigo-800 focus:bg-indigo-100 focus:border-indigo-700 transition duration-150 ease-in-out'
        : 'block w-full ps-3 pe-4 py-2 border-l-4 border-transparent text-start text-base font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300 transition duration-150 ease-in-out',
);
</script>

<template>
    <Link :href="href" :class="classes">
        <slot />
    </Link>
</template>
</file>

<file path="resources/js/Components/SecondaryButton.vue">
<script setup>
defineProps({
    type: {
        type: String,
        default: 'button',
    },
});
</script>

<template>
    <button
        :type="type"
        class="inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-xs font-semibold uppercase tracking-widest text-gray-700 shadow-sm transition duration-150 ease-in-out hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25"
    >
        <slot />
    </button>
</template>
</file>

<file path="resources/js/Components/TextInput.vue">
<script setup>
import { onMounted, ref } from 'vue';

const model = defineModel({
    type: String,
    required: true,
});

const input = ref(null);

onMounted(() => {
    if (input.value.hasAttribute('autofocus')) {
        input.value.focus();
    }
});

defineExpose({ focus: () => input.value.focus() });
</script>

<template>
    <input
        class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
        v-model="model"
        ref="input"
    />
</template>
</file>

<file path="resources/js/Layouts/GuestLayout.vue">
<script setup>
import ApplicationLogo from '@/Components/ApplicationLogo.vue';
import { Link } from '@inertiajs/vue3';
</script>

<template>
    <div
        class="flex min-h-screen flex-col items-center bg-gray-100 pt-6 sm:justify-center sm:pt-0"
    >
        <div>
            <Link href="/">
                <ApplicationLogo class="h-20 w-20 fill-current text-gray-500" />
            </Link>
        </div>

        <div
            class="mt-6 w-full overflow-hidden bg-white px-6 py-4 shadow-md sm:max-w-md sm:rounded-lg"
        >
            <slot />
        </div>
    </div>
</template>
</file>

<file path="resources/js/Pages/Auth/ConfirmPassword.vue">
<script setup>
import GuestLayout from '@/Layouts/GuestLayout.vue';
import InputError from '@/Components/InputError.vue';
import InputLabel from '@/Components/InputLabel.vue';
import PrimaryButton from '@/Components/PrimaryButton.vue';
import TextInput from '@/Components/TextInput.vue';
import { Head, useForm } from '@inertiajs/vue3';

const form = useForm({
    password: '',
});

const submit = () => {
    form.post(route('password.confirm'), {
        onFinish: () => form.reset(),
    });
};
</script>

<template>
    <GuestLayout>
        <Head title="Confirm Password" />

        <div class="mb-4 text-sm text-gray-600">
            This is a secure area of the application. Please confirm your
            password before continuing.
        </div>

        <form @submit.prevent="submit">
            <div>
                <InputLabel for="password" value="Password" />
                <TextInput
                    id="password"
                    type="password"
                    class="mt-1 block w-full"
                    v-model="form.password"
                    required
                    autocomplete="current-password"
                    autofocus
                />
                <InputError class="mt-2" :message="form.errors.password" />
            </div>

            <div class="mt-4 flex justify-end">
                <PrimaryButton
                    class="ms-4"
                    :class="{ 'opacity-25': form.processing }"
                    :disabled="form.processing"
                >
                    Confirm
                </PrimaryButton>
            </div>
        </form>
    </GuestLayout>
</template>
</file>

<file path="resources/js/Pages/Auth/ForgotPassword.vue">
<script setup>
import GuestLayout from '@/Layouts/GuestLayout.vue';
import InputError from '@/Components/InputError.vue';
import InputLabel from '@/Components/InputLabel.vue';
import PrimaryButton from '@/Components/PrimaryButton.vue';
import TextInput from '@/Components/TextInput.vue';
import { Head, useForm } from '@inertiajs/vue3';

defineProps({
    status: {
        type: String,
    },
});

const form = useForm({
    email: '',
});

const submit = () => {
    form.post(route('password.email'));
};
</script>

<template>
    <GuestLayout>
        <Head title="Forgot Password" />

        <div class="mb-4 text-sm text-gray-600">
            Forgot your password? No problem. Just let us know your email
            address and we will email you a password reset link that will allow
            you to choose a new one.
        </div>

        <div
            v-if="status"
            class="mb-4 text-sm font-medium text-green-600"
        >
            {{ status }}
        </div>

        <form @submit.prevent="submit">
            <div>
                <InputLabel for="email" value="Email" />

                <TextInput
                    id="email"
                    type="email"
                    class="mt-1 block w-full"
                    v-model="form.email"
                    required
                    autofocus
                    autocomplete="username"
                />

                <InputError class="mt-2" :message="form.errors.email" />
            </div>

            <div class="mt-4 flex items-center justify-end">
                <PrimaryButton
                    :class="{ 'opacity-25': form.processing }"
                    :disabled="form.processing"
                >
                    Email Password Reset Link
                </PrimaryButton>
            </div>
        </form>
    </GuestLayout>
</template>
</file>

<file path="resources/js/Pages/Auth/Login.vue">
<script setup>
import Checkbox from '@/Components/Checkbox.vue';
import GuestLayout from '@/Layouts/GuestLayout.vue';
import InputError from '@/Components/InputError.vue';
import InputLabel from '@/Components/InputLabel.vue';
import PrimaryButton from '@/Components/PrimaryButton.vue';
import TextInput from '@/Components/TextInput.vue';
import { Head, Link, useForm } from '@inertiajs/vue3';

defineProps({
    canResetPassword: {
        type: Boolean,
    },
    status: {
        type: String,
    },
});

const form = useForm({
    email: '',
    password: '',
    remember: false,
});

const submit = () => {
    form.post(route('login'), {
        onFinish: () => form.reset('password'),
    });
};
</script>

<template>
    <GuestLayout>
        <Head title="Log in" />

        <div v-if="status" class="mb-4 text-sm font-medium text-green-600">
            {{ status }}
        </div>

        <form @submit.prevent="submit">
            <div>
                <InputLabel for="email" value="Email" />

                <TextInput
                    id="email"
                    type="email"
                    class="mt-1 block w-full"
                    v-model="form.email"
                    required
                    autofocus
                    autocomplete="username"
                />

                <InputError class="mt-2" :message="form.errors.email" />
            </div>

            <div class="mt-4">
                <InputLabel for="password" value="Password" />

                <TextInput
                    id="password"
                    type="password"
                    class="mt-1 block w-full"
                    v-model="form.password"
                    required
                    autocomplete="current-password"
                />

                <InputError class="mt-2" :message="form.errors.password" />
            </div>

            <div class="mt-4 block">
                <label class="flex items-center">
                    <Checkbox name="remember" v-model:checked="form.remember" />
                    <span class="ms-2 text-sm text-gray-600"
                        >Remember me</span
                    >
                </label>
            </div>

            <div class="mt-4 flex items-center justify-end">
                <Link
                    v-if="canResetPassword"
                    :href="route('password.request')"
                    class="rounded-md text-sm text-gray-600 underline hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                >
                    Forgot your password?
                </Link>

                <PrimaryButton
                    class="ms-4"
                    :class="{ 'opacity-25': form.processing }"
                    :disabled="form.processing"
                >
                    Log in
                </PrimaryButton>
            </div>
        </form>
    </GuestLayout>
</template>
</file>

<file path="resources/js/Pages/Auth/Register.vue">
<script setup>
import GuestLayout from '@/Layouts/GuestLayout.vue';
import InputError from '@/Components/InputError.vue';
import InputLabel from '@/Components/InputLabel.vue';
import PrimaryButton from '@/Components/PrimaryButton.vue';
import TextInput from '@/Components/TextInput.vue';
import { Head, Link, useForm } from '@inertiajs/vue3';

const form = useForm({
    name: '',
    email: '',
    password: '',
    password_confirmation: '',
});

const submit = () => {
    form.post(route('register'), {
        onFinish: () => form.reset('password', 'password_confirmation'),
    });
};
</script>

<template>
    <GuestLayout>
        <Head title="Register" />

        <form @submit.prevent="submit">
            <div>
                <InputLabel for="name" value="Name" />

                <TextInput
                    id="name"
                    type="text"
                    class="mt-1 block w-full"
                    v-model="form.name"
                    required
                    autofocus
                    autocomplete="name"
                />

                <InputError class="mt-2" :message="form.errors.name" />
            </div>

            <div class="mt-4">
                <InputLabel for="email" value="Email" />

                <TextInput
                    id="email"
                    type="email"
                    class="mt-1 block w-full"
                    v-model="form.email"
                    required
                    autocomplete="username"
                />

                <InputError class="mt-2" :message="form.errors.email" />
            </div>

            <div class="mt-4">
                <InputLabel for="password" value="Password" />

                <TextInput
                    id="password"
                    type="password"
                    class="mt-1 block w-full"
                    v-model="form.password"
                    required
                    autocomplete="new-password"
                />

                <InputError class="mt-2" :message="form.errors.password" />
            </div>

            <div class="mt-4">
                <InputLabel
                    for="password_confirmation"
                    value="Confirm Password"
                />

                <TextInput
                    id="password_confirmation"
                    type="password"
                    class="mt-1 block w-full"
                    v-model="form.password_confirmation"
                    required
                    autocomplete="new-password"
                />

                <InputError
                    class="mt-2"
                    :message="form.errors.password_confirmation"
                />
            </div>

            <div class="mt-4 flex items-center justify-end">
                <Link
                    :href="route('login')"
                    class="rounded-md text-sm text-gray-600 underline hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                >
                    Already registered?
                </Link>

                <PrimaryButton
                    class="ms-4"
                    :class="{ 'opacity-25': form.processing }"
                    :disabled="form.processing"
                >
                    Register
                </PrimaryButton>
            </div>
        </form>
    </GuestLayout>
</template>
</file>

<file path="resources/js/Pages/Auth/ResetPassword.vue">
<script setup>
import GuestLayout from '@/Layouts/GuestLayout.vue';
import InputError from '@/Components/InputError.vue';
import InputLabel from '@/Components/InputLabel.vue';
import PrimaryButton from '@/Components/PrimaryButton.vue';
import TextInput from '@/Components/TextInput.vue';
import { Head, useForm } from '@inertiajs/vue3';

const props = defineProps({
    email: {
        type: String,
        required: true,
    },
    token: {
        type: String,
        required: true,
    },
});

const form = useForm({
    token: props.token,
    email: props.email,
    password: '',
    password_confirmation: '',
});

const submit = () => {
    form.post(route('password.store'), {
        onFinish: () => form.reset('password', 'password_confirmation'),
    });
};
</script>

<template>
    <GuestLayout>
        <Head title="Reset Password" />

        <form @submit.prevent="submit">
            <div>
                <InputLabel for="email" value="Email" />

                <TextInput
                    id="email"
                    type="email"
                    class="mt-1 block w-full"
                    v-model="form.email"
                    required
                    autofocus
                    autocomplete="username"
                />

                <InputError class="mt-2" :message="form.errors.email" />
            </div>

            <div class="mt-4">
                <InputLabel for="password" value="Password" />

                <TextInput
                    id="password"
                    type="password"
                    class="mt-1 block w-full"
                    v-model="form.password"
                    required
                    autocomplete="new-password"
                />

                <InputError class="mt-2" :message="form.errors.password" />
            </div>

            <div class="mt-4">
                <InputLabel
                    for="password_confirmation"
                    value="Confirm Password"
                />

                <TextInput
                    id="password_confirmation"
                    type="password"
                    class="mt-1 block w-full"
                    v-model="form.password_confirmation"
                    required
                    autocomplete="new-password"
                />

                <InputError
                    class="mt-2"
                    :message="form.errors.password_confirmation"
                />
            </div>

            <div class="mt-4 flex items-center justify-end">
                <PrimaryButton
                    :class="{ 'opacity-25': form.processing }"
                    :disabled="form.processing"
                >
                    Reset Password
                </PrimaryButton>
            </div>
        </form>
    </GuestLayout>
</template>
</file>

<file path="resources/js/Pages/Auth/VerifyEmail.vue">
<script setup>
import { computed } from 'vue';
import GuestLayout from '@/Layouts/GuestLayout.vue';
import PrimaryButton from '@/Components/PrimaryButton.vue';
import { Head, Link, useForm } from '@inertiajs/vue3';

const props = defineProps({
    status: {
        type: String,
    },
});

const form = useForm({});

const submit = () => {
    form.post(route('verification.send'));
};

const verificationLinkSent = computed(
    () => props.status === 'verification-link-sent',
);
</script>

<template>
    <GuestLayout>
        <Head title="Email Verification" />

        <div class="mb-4 text-sm text-gray-600">
            Thanks for signing up! Before getting started, could you verify your
            email address by clicking on the link we just emailed to you? If you
            didn't receive the email, we will gladly send you another.
        </div>

        <div
            class="mb-4 text-sm font-medium text-green-600"
            v-if="verificationLinkSent"
        >
            A new verification link has been sent to the email address you
            provided during registration.
        </div>

        <form @submit.prevent="submit">
            <div class="mt-4 flex items-center justify-between">
                <PrimaryButton
                    :class="{ 'opacity-25': form.processing }"
                    :disabled="form.processing"
                >
                    Resend Verification Email
                </PrimaryButton>

                <Link
                    :href="route('logout')"
                    method="post"
                    as="button"
                    class="rounded-md text-sm text-gray-600 underline hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                    >Log Out</Link
                >
            </div>
        </form>
    </GuestLayout>
</template>
</file>

<file path="resources/js/Pages/ClientPortal/Dashboard.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head } from '@inertiajs/vue3';
</script>

<template>
    <Head title="Mi Portal" />

    <AuthenticatedLayout>
        <template #header>
            <h2 class="font-semibold text-xl text-gray-800 leading-tight">Portal del Cliente</h2>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 text-gray-900">
                        ¡Bienvenido a tu portal, {{ $page.props.auth.user.name }}! Aquí podrás ver tus vehículos y el historial de servicios.
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/ClientPortal/Vehicles/Create.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';

const form = useForm({ patente: '', marca: '', modelo: '', anio: new Date().getFullYear(), kilometraje: '' });
const submit = () => form.post(route('cliente.vehiculos.store'));
</script>
<template>
    <Head title="Agregar Vehículo" />
    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Agregar Nuevo Vehículo</h2>
                <Link :href="route('cliente.vehiculos.index')" class="text-sm text-gray-700 underline">&larr; Volver a Mis Vehículos</Link>
            </div>
        </template>
        <div class="py-12">
            <div class="max-w-4xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <form @submit.prevent="submit">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="patente" class="block font-medium text-sm text-gray-700">Patente</label>
                                    <input id="patente" type="text" v-model="form.patente" class="mt-1 block w-full" required autofocus />
                                    <div v-if="form.errors.patente" class="text-sm text-red-600 mt-1">{{ form.errors.patente }}</div>
                                </div>
                                <div>
                                    <label for="marca" class="block font-medium text-sm text-gray-700">Marca</label>
                                    <input id="marca" type="text" v-model="form.marca" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.marca" class="text-sm text-red-600 mt-1">{{ form.errors.marca }}</div>
                                </div>
                                <div>
                                    <label for="modelo" class="block font-medium text-sm text-gray-700">Modelo</label>
                                    <input id="modelo" type="text" v-model="form.modelo" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.modelo" class="text-sm text-red-600 mt-1">{{ form.errors.modelo }}</div>
                                </div>
                                <div>
                                    <label for="anio" class="block font-medium text-sm text-gray-700">Año</label>
                                    <input id="anio" type="number" v-model="form.anio" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.anio" class="text-sm text-red-600 mt-1">{{ form.errors.anio }}</div>
                                </div>
                                <div class="md:col-span-2">
                                    <label for="kilometraje" class="block font-medium text-sm text-gray-700">Kilometraje (Opcional)</label>
                                    <input id="kilometraje" type="number" v-model="form.kilometraje" class="mt-1 block w-full" />
                                    <div v-if="form.errors.kilometraje" class="text-sm text-red-600 mt-1">{{ form.errors.kilometraje }}</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-end mt-6">
                                <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md" :disabled="form.processing">Guardar Vehículo</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/ClientPortal/Vehicles/Edit.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';

const props = defineProps({ vehiculo: Object });

const form = useForm({
    patente: props.vehiculo.patente,
    marca: props.vehiculo.marca,
    modelo: props.vehiculo.modelo,
    anio: props.vehiculo.anio,
    kilometraje: props.vehiculo.kilometraje,
});

const submit = () => form.patch(route('cliente.vehiculos.update', props.vehiculo.id));
</script>
<template>
    <Head :title="`Editar Vehículo: ${vehiculo.patente}`" />
    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Editar Vehículo</h2>
                <Link :href="route('cliente.vehiculos.index')" class="text-sm text-gray-700 underline">&larr; Volver a Mis Vehículos</Link>
            </div>
        </template>
        <div class="py-12">
            <div class="max-w-4xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <form @submit.prevent="submit">
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="patente" class="block font-medium text-sm text-gray-700">Patente</label>
                                    <input id="patente" type="text" v-model="form.patente" class="mt-1 block w-full" required autofocus />
                                    <div v-if="form.errors.patente" class="text-sm text-red-600 mt-1">{{ form.errors.patente }}</div>
                                </div>
                                <div>
                                    <label for="marca" class="block font-medium text-sm text-gray-700">Marca</label>
                                    <input id="marca" type="text" v-model="form.marca" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.marca" class="text-sm text-red-600 mt-1">{{ form.errors.marca }}</div>
                                </div>
                                <div>
                                    <label for="modelo" class="block font-medium text-sm text-gray-700">Modelo</label>
                                    <input id="modelo" type="text" v-model="form.modelo" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.modelo" class="text-sm text-red-600 mt-1">{{ form.errors.modelo }}</div>
                                </div>
                                <div>
                                    <label for="anio" class="block font-medium text-sm text-gray-700">Año</label>
                                    <input id="anio" type="number" v-model="form.anio" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.anio" class="text-sm text-red-600 mt-1">{{ form.errors.anio }}</div>
                                </div>
                                <div class="md:col-span-2">
                                    <label for="kilometraje" class="block font-medium text-sm text-gray-700">Kilometraje (Opcional)</label>
                                    <input id="kilometraje" type="number" v-model="form.kilometraje" class="mt-1 block w-full" />
                                    <div v-if="form.errors.kilometraje" class="text-sm text-red-600 mt-1">{{ form.errors.kilometraje }}</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-end mt-6">
                                <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md" :disabled="form.processing">Actualizar Vehículo</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/ClientPortal/Vehicles/Index.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, Link, router } from '@inertiajs/vue3';
import Pagination from '@/Components/Pagination.vue';
import ConfirmationModal from '@/Components/ConfirmationModal.vue';
import { ref } from 'vue';

defineProps({ vehiculos: Object });

const confirmingVehicleDeletion = ref(false);
const vehicleToDelete = ref(null);

const confirmVehicleDeletion = (vehiculo) => {
    vehicleToDelete.value = vehiculo;
    confirmingVehicleDeletion.value = true;
};

const deleteVehicle = () => {
    router.delete(route('cliente.vehiculos.destroy', vehicleToDelete.value.id), {
        onSuccess: () => closeModal(),
        preserveScroll: true,
    });
};

const closeModal = () => confirmingVehicleDeletion.value = false;
</script>
<template>
    <Head title="Mis Vehículos" />
    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Mis Vehículos</h2>
                <Link :href="route('cliente.vehiculos.create')" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition">
                    Agregar Nuevo Vehículo
                </Link>
            </div>
        </template>
        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Patente</th>
                                        <th scope="col" class="px-6 py-3">Marca</th>
                                        <th scope="col" class="px-6 py-3">Modelo</th>
                                        <th scope="col" class="px-6 py-3">Año</th>
                                        <th scope="col" class="px-6 py-3 text-right">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="vehiculo in vehiculos.data" :key="vehiculo.id" class="bg-white border-b hover:bg-gray-50">
                                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ vehiculo.patente }}</th>
                                        <td class="px-6 py-4">{{ vehiculo.marca }}</td>
                                        <td class="px-6 py-4">{{ vehiculo.modelo }}</td>
                                        <td class="px-6 py-4">{{ vehiculo.anio }}</td>
                                        <td class="px-6 py-4 text-right">
                                            <Link :href="route('cliente.vehiculos.edit', vehiculo.id)" class="font-medium text-blue-600 hover:underline mr-4">Editar</Link>
                                            <button @click="confirmVehicleDeletion(vehiculo)" class="font-medium text-red-600 hover:underline">Eliminar</button>
                                        </td>
                                    </tr>
                                    <tr v-if="vehiculos.data.length === 0">
                                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">No tienes vehículos registrados. ¡Agrega tu primero!</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div v-if="vehiculos.links.length > 3" class="p-6 border-t">
                        <Pagination :links="vehiculos.links" />
                    </div>
                </div>
            </div>
        </div>
        <ConfirmationModal 
            :show="confirmingVehicleDeletion" 
            @close="closeModal"
            @confirm="deleteVehicle"
            title="Eliminar Vehículo"
            :message="`¿Estás seguro de que deseas eliminar tu vehículo con patente ${vehicleToDelete?.patente}?`"
        />
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Dashboard.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head } from '@inertiajs/vue3';
</script>

<template>
    <Head title="Dashboard" />

    <AuthenticatedLayout>
        <template #header>
            <h2
                class="text-xl font-semibold leading-tight text-gray-800"
            >
                Dashboard
            </h2>
        </template>

        <div class="py-12">
            <div class="mx-auto max-w-7xl sm:px-6 lg:px-8">
                <div
                    class="overflow-hidden bg-white shadow-sm sm:rounded-lg"
                >
                    <div class="p-6 text-gray-900">
                        You're logged in!
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Inventory/Products/Edit.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';
import { computed } from 'vue';

const props = defineProps({
    product: {
        type: Object,
        required: true,
    },
    suppliers: {
        type: Array,
        required: true,
    },
});

const form = useForm({
    name: props.product.name,
    sku: props.product.sku,
    description: props.product.description,
    cost: props.product.cost,
    iva_percentage: props.product.iva_percentage,
    profit_margin: props.product.profit_margin,
    current_stock: props.product.current_stock,
    min_threshold: props.product.min_threshold,
    // Asume que un producto tiene al menos un proveedor y lo preselecciona
    supplier_id: props.product.suppliers.length > 0 ? props.product.suppliers[0].id : null,
});

const calculatedPrice = computed(() => {
    const cost = parseFloat(form.cost) || 0;
    const ivaPercentage = parseFloat(form.iva_percentage) || 0;
    const profitMargin = parseFloat(form.profit_margin) || 0;
    const costWithIva = cost * (1 + (ivaPercentage / 100));
    const finalPrice = costWithIva * (1 + (profitMargin / 100));
    return finalPrice.toFixed(2);
});

const submit = () => {
    form.patch(route('inventario.products.update', props.product.id), {
        preserveScroll: true,
    });
};
</script>

<template>
    <Head :title="`Editar Producto: ${product.name}`" />

    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Editar Producto</h2>
                <Link :href="route('inventario.products.index')" class="text-sm text-gray-700 underline">
                    &larr; Volver al listado
                </Link>
            </div>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <form @submit.prevent="submit">
                            <!-- SECCIÓN 1: DATOS DEL PRODUCTO -->
                            <h3 class="text-lg font-medium text-gray-900 mb-4 border-b pb-2">Datos del Producto</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="md:col-span-2">
                                    <label for="name" class="block font-medium text-sm text-gray-700">Nombre del Producto</label>
                                    <input id="name" type="text" v-model="form.name" class="mt-1 block w-full" required autofocus />
                                    <div v-if="form.errors.name" class="text-sm text-red-600 mt-1">{{ form.errors.name }}</div>
                                </div>
                                <div>
                                    <label for="sku" class="block font-medium text-sm text-gray-700">SKU (Código Único)</label>
                                    <input id="sku" type="text" v-model="form.sku" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.sku" class="text-sm text-red-600 mt-1">{{ form.errors.sku }}</div>
                                </div>
                                <div>
                                    <label for="supplier_id" class="block font-medium text-sm text-gray-700">Proveedor Principal</label>
                                    <select id="supplier_id" v-model="form.supplier_id" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required>
                                        <option v-for="supplier in suppliers" :key="supplier.id" :value="supplier.id">{{ supplier.name }}</option>
                                    </select>
                                    <div v-if="form.errors.supplier_id" class="text-sm text-red-600 mt-1">{{ form.errors.supplier_id }}</div>
                                </div>
                            </div>
                            <div class="mt-6">
                                <label for="description" class="block font-medium text-sm text-gray-700">Descripción (Opcional)</label>
                                <textarea id="description" v-model="form.description" rows="3" class="mt-1 block w-full"></textarea>
                            </div>

                            <!-- SECCIÓN 2: PRECIOS Y STOCK -->
                            <h3 class="text-lg font-medium text-gray-900 mt-8 mb-4 border-b pb-2">Precios y Stock</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div>
                                    <label for="cost" class="block font-medium text-sm text-gray-700">Precio de Costo ($)</label>
                                    <input id="cost" type="number" step="0.01" v-model="form.cost" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.cost" class="text-sm text-red-600 mt-1">{{ form.errors.cost }}</div>
                                </div>
                                <div>
                                    <label for="iva_percentage" class="block font-medium text-sm text-gray-700">IVA (%)</label>
                                    <input id="iva_percentage" type="number" v-model="form.iva_percentage" class="mt-1 block w-full" required />
                                </div>
                                <div>
                                    <label for="profit_margin" class="block font-medium text-sm text-gray-700">Margen de Ganancia (%)</label>
                                    <input id="profit_margin" type="number" v-model="form.profit_margin" class="mt-1 block w-full" required />
                                </div>
                                <div class="bg-gray-100 p-4 rounded-md flex items-center justify-center">
                                    <div>
                                        <label class="block font-medium text-sm text-gray-700">Precio de Venta Calculado</label>
                                        <p class="text-2xl font-bold text-gray-900 mt-1">${{ calculatedPrice }}</p>
                                    </div>
                                </div>
                                <div>
                                    <label for="current_stock" class="block font-medium text-sm text-gray-700">Stock Actual</label>
                                    <input id="current_stock" type="number" v-model="form.current_stock" class="mt-1 block w-full" required />
                                </div>
                                <div>
                                    <label for="min_threshold" class="block font-medium text-sm text-gray-700">Umbral de Stock Bajo</label>
                                    <input id="min_threshold" type="number" v-model="form.min_threshold" class="mt-1 block w-full" required />
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-end mt-8">
                                <button type="submit" class="px-6 py-3 bg-gray-800 text-white rounded-md hover:bg-gray-700 font-semibold" :disabled="form.processing">
                                    Actualizar Producto
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Inventory/Suppliers/Create.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';

const form = useForm({
    name: '',
    contact_person: '',
    phone: '',
    email: '',
    address: '',
});

const submit = () => {
    form.post(route('inventario.suppliers.store'));
};
</script>

<template>
    <Head title="Crear Proveedor" />
    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Crear Nuevo Proveedor</h2>
                <Link :href="route('inventario.suppliers.index')" class="text-sm text-gray-700 underline">
                    &larr; Volver al listado
                </Link>
            </div>
        </template>
        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <form @submit.prevent="submit">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="name" class="block font-medium text-sm text-gray-700">Nombre del Proveedor</label>
                                    <input id="name" type="text" v-model="form.name" class="mt-1 block w-full" required autofocus />
                                    <div v-if="form.errors.name" class="text-sm text-red-600 mt-1">{{ form.errors.name }}</div>
                                </div>
                                <div>
                                    <label for="contact_person" class="block font-medium text-sm text-gray-700">Persona de Contacto (Opcional)</label>
                                    <input id="contact_person" type="text" v-model="form.contact_person" class="mt-1 block w-full" />
                                    <div v-if="form.errors.contact_person" class="text-sm text-red-600 mt-1">{{ form.errors.contact_person }}</div>
                                </div>
                                <div>
                                    <label for="phone" class="block font-medium text-sm text-gray-700">Teléfono (Opcional)</label>
                                    <input id="phone" type="text" v-model="form.phone" class="mt-1 block w-full" />
                                    <div v-if="form.errors.phone" class="text-sm text-red-600 mt-1">{{ form.errors.phone }}</div>
                                </div>
                                <div>
                                    <label for="email" class="block font-medium text-sm text-gray-700">Email (Opcional)</label>
                                    <input id="email" type="email" v-model="form.email" class="mt-1 block w-full" />
                                    <div v-if="form.errors.email" class="text-sm text-red-600 mt-1">{{ form.errors.email }}</div>
                                </div>
                                <div class="md:col-span-2">
                                    <label for="address" class="block font-medium text-sm text-gray-700">Dirección (Opcional)</label>
                                    <textarea id="address" v-model="form.address" rows="3" class="mt-1 block w-full"></textarea>
                                    <div v-if="form.errors.address" class="text-sm text-red-600 mt-1">{{ form.errors.address }}</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-end mt-6">
                                <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700" :disabled="form.processing">
                                    Guardar Proveedor
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Inventory/Suppliers/Edit.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';

const props = defineProps({
    supplier: {
        type: Object,
        required: true,
    },
});

const form = useForm({
    name: props.supplier.name,
    contact_person: props.supplier.contact_person,
    phone: props.supplier.phone,
    email: props.supplier.email,
    address: props.supplier.address,
});

const submit = () => {
    form.patch(route('inventario.suppliers.update', props.supplier.id));
};
</script>
<template>
    <Head :title="`Editar Proveedor: ${supplier.name}`" />
    <AuthenticatedLayout>
        <template #header>
             <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Editar Proveedor</h2>
                <Link :href="route('inventario.suppliers.index')" class="text-sm text-gray-700 underline">
                    &larr; Volver al listado
                </Link>
            </div>
        </template>
        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                         <form @submit.prevent="submit">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="name" class="block font-medium text-sm text-gray-700">Nombre del Proveedor</label>
                                    <input id="name" type="text" v-model="form.name" class="mt-1 block w-full" required autofocus />
                                    <div v-if="form.errors.name" class="text-sm text-red-600 mt-1">{{ form.errors.name }}</div>
                                </div>
                                <div>
                                    <label for="contact_person" class="block font-medium text-sm text-gray-700">Persona de Contacto (Opcional)</label>
                                    <input id="contact_person" type="text" v-model="form.contact_person" class="mt-1 block w-full" />
                                    <div v-if="form.errors.contact_person" class="text-sm text-red-600 mt-1">{{ form.errors.contact_person }}</div>
                                </div>
                                <div>
                                    <label for="phone" class="block font-medium text-sm text-gray-700">Teléfono (Opcional)</label>
                                    <input id="phone" type="text" v-model="form.phone" class="mt-1 block w-full" />
                                    <div v-if="form.errors.phone" class="text-sm text-red-600 mt-1">{{ form.errors.phone }}</div>
                                </div>
                                <div>
                                    <label for="email" class="block font-medium text-sm text-gray-700">Email (Opcional)</label>
                                    <input id="email" type="email" v-model="form.email" class="mt-1 block w-full" />
                                    <div v-if="form.errors.email" class="text-sm text-red-600 mt-1">{{ form.errors.email }}</div>
                                </div>
                                <div class="md:col-span-2">
                                    <label for="address" class="block font-medium text-sm text-gray-700">Dirección (Opcional)</label>
                                    <textarea id="address" v-model="form.address" rows="3" class="mt-1 block w-full"></textarea>
                                    <div v-if="form.errors.address" class="text-sm text-red-600 mt-1">{{ form.errors.address }}</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-end mt-6">
                                <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700" :disabled="form.processing">
                                    Actualizar Proveedor
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/MechanicPanel/Dashboard.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head } from '@inertiajs/vue3';
</script>

<template>
    <Head title="Panel de Mecánico" />

    <AuthenticatedLayout>
        <template #header>
            <h2 class="font-semibold text-xl text-gray-800 leading-tight">Panel de Mecánico</h2>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 text-gray-900">¡Bienvenido! Aquí verás tus tareas asignadas.</div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Profile/Edit.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import DeleteUserForm from './Partials/DeleteUserForm.vue';
import UpdatePasswordForm from './Partials/UpdatePasswordForm.vue';
import UpdateProfileInformationForm from './Partials/UpdateProfileInformationForm.vue';
import { Head } from '@inertiajs/vue3';

defineProps({
    mustVerifyEmail: {
        type: Boolean,
    },
    status: {
        type: String,
    },
});
</script>

<template>
    <Head title="Profile" />

    <AuthenticatedLayout>
        <template #header>
            <h2
                class="text-xl font-semibold leading-tight text-gray-800"
            >
                Profile
            </h2>
        </template>

        <div class="py-12">
            <div class="mx-auto max-w-7xl space-y-6 sm:px-6 lg:px-8">
                <div
                    class="bg-white p-4 shadow sm:rounded-lg sm:p-8"
                >
                    <UpdateProfileInformationForm
                        :must-verify-email="mustVerifyEmail"
                        :status="status"
                        class="max-w-xl"
                    />
                </div>

                <div
                    class="bg-white p-4 shadow sm:rounded-lg sm:p-8"
                >
                    <UpdatePasswordForm class="max-w-xl" />
                </div>

                <div
                    class="bg-white p-4 shadow sm:rounded-lg sm:p-8"
                >
                    <DeleteUserForm class="max-w-xl" />
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Profile/Partials/DeleteUserForm.vue">
<script setup>
import DangerButton from '@/Components/DangerButton.vue';
import InputError from '@/Components/InputError.vue';
import InputLabel from '@/Components/InputLabel.vue';
import Modal from '@/Components/Modal.vue';
import SecondaryButton from '@/Components/SecondaryButton.vue';
import TextInput from '@/Components/TextInput.vue';
import { useForm } from '@inertiajs/vue3';
import { nextTick, ref } from 'vue';

const confirmingUserDeletion = ref(false);
const passwordInput = ref(null);

const form = useForm({
    password: '',
});

const confirmUserDeletion = () => {
    confirmingUserDeletion.value = true;

    nextTick(() => passwordInput.value.focus());
};

const deleteUser = () => {
    form.delete(route('profile.destroy'), {
        preserveScroll: true,
        onSuccess: () => closeModal(),
        onError: () => passwordInput.value.focus(),
        onFinish: () => form.reset(),
    });
};

const closeModal = () => {
    confirmingUserDeletion.value = false;

    form.clearErrors();
    form.reset();
};
</script>

<template>
    <section class="space-y-6">
        <header>
            <h2 class="text-lg font-medium text-gray-900">
                Delete Account
            </h2>

            <p class="mt-1 text-sm text-gray-600">
                Once your account is deleted, all of its resources and data will
                be permanently deleted. Before deleting your account, please
                download any data or information that you wish to retain.
            </p>
        </header>

        <DangerButton @click="confirmUserDeletion">Delete Account</DangerButton>

        <Modal :show="confirmingUserDeletion" @close="closeModal">
            <div class="p-6">
                <h2
                    class="text-lg font-medium text-gray-900"
                >
                    Are you sure you want to delete your account?
                </h2>

                <p class="mt-1 text-sm text-gray-600">
                    Once your account is deleted, all of its resources and data
                    will be permanently deleted. Please enter your password to
                    confirm you would like to permanently delete your account.
                </p>

                <div class="mt-6">
                    <InputLabel
                        for="password"
                        value="Password"
                        class="sr-only"
                    />

                    <TextInput
                        id="password"
                        ref="passwordInput"
                        v-model="form.password"
                        type="password"
                        class="mt-1 block w-3/4"
                        placeholder="Password"
                        @keyup.enter="deleteUser"
                    />

                    <InputError :message="form.errors.password" class="mt-2" />
                </div>

                <div class="mt-6 flex justify-end">
                    <SecondaryButton @click="closeModal">
                        Cancel
                    </SecondaryButton>

                    <DangerButton
                        class="ms-3"
                        :class="{ 'opacity-25': form.processing }"
                        :disabled="form.processing"
                        @click="deleteUser"
                    >
                        Delete Account
                    </DangerButton>
                </div>
            </div>
        </Modal>
    </section>
</template>
</file>

<file path="resources/js/Pages/Profile/Partials/UpdatePasswordForm.vue">
<script setup>
import InputError from '@/Components/InputError.vue';
import InputLabel from '@/Components/InputLabel.vue';
import PrimaryButton from '@/Components/PrimaryButton.vue';
import TextInput from '@/Components/TextInput.vue';
import { useForm } from '@inertiajs/vue3';
import { ref } from 'vue';

const passwordInput = ref(null);
const currentPasswordInput = ref(null);

const form = useForm({
    current_password: '',
    password: '',
    password_confirmation: '',
});

const updatePassword = () => {
    form.put(route('password.update'), {
        preserveScroll: true,
        onSuccess: () => form.reset(),
        onError: () => {
            if (form.errors.password) {
                form.reset('password', 'password_confirmation');
                passwordInput.value.focus();
            }
            if (form.errors.current_password) {
                form.reset('current_password');
                currentPasswordInput.value.focus();
            }
        },
    });
};
</script>

<template>
    <section>
        <header>
            <h2 class="text-lg font-medium text-gray-900">
                Update Password
            </h2>

            <p class="mt-1 text-sm text-gray-600">
                Ensure your account is using a long, random password to stay
                secure.
            </p>
        </header>

        <form @submit.prevent="updatePassword" class="mt-6 space-y-6">
            <div>
                <InputLabel for="current_password" value="Current Password" />

                <TextInput
                    id="current_password"
                    ref="currentPasswordInput"
                    v-model="form.current_password"
                    type="password"
                    class="mt-1 block w-full"
                    autocomplete="current-password"
                />

                <InputError
                    :message="form.errors.current_password"
                    class="mt-2"
                />
            </div>

            <div>
                <InputLabel for="password" value="New Password" />

                <TextInput
                    id="password"
                    ref="passwordInput"
                    v-model="form.password"
                    type="password"
                    class="mt-1 block w-full"
                    autocomplete="new-password"
                />

                <InputError :message="form.errors.password" class="mt-2" />
            </div>

            <div>
                <InputLabel
                    for="password_confirmation"
                    value="Confirm Password"
                />

                <TextInput
                    id="password_confirmation"
                    v-model="form.password_confirmation"
                    type="password"
                    class="mt-1 block w-full"
                    autocomplete="new-password"
                />

                <InputError
                    :message="form.errors.password_confirmation"
                    class="mt-2"
                />
            </div>

            <div class="flex items-center gap-4">
                <PrimaryButton :disabled="form.processing">Save</PrimaryButton>

                <Transition
                    enter-active-class="transition ease-in-out"
                    enter-from-class="opacity-0"
                    leave-active-class="transition ease-in-out"
                    leave-to-class="opacity-0"
                >
                    <p
                        v-if="form.recentlySuccessful"
                        class="text-sm text-gray-600"
                    >
                        Saved.
                    </p>
                </Transition>
            </div>
        </form>
    </section>
</template>
</file>

<file path="resources/js/Pages/Profile/Partials/UpdateProfileInformationForm.vue">
<script setup>
import InputError from '@/Components/InputError.vue';
import InputLabel from '@/Components/InputLabel.vue';
import PrimaryButton from '@/Components/PrimaryButton.vue';
import TextInput from '@/Components/TextInput.vue';
import { Link, useForm, usePage } from '@inertiajs/vue3';

defineProps({
    mustVerifyEmail: {
        type: Boolean,
    },
    status: {
        type: String,
    },
});

const user = usePage().props.auth.user;

const form = useForm({
    name: user.name,
    email: user.email,
});
</script>

<template>
    <section>
        <header>
            <h2 class="text-lg font-medium text-gray-900">
                Profile Information
            </h2>

            <p class="mt-1 text-sm text-gray-600">
                Update your account's profile information and email address.
            </p>
        </header>

        <form
            @submit.prevent="form.patch(route('profile.update'))"
            class="mt-6 space-y-6"
        >
            <div>
                <InputLabel for="name" value="Name" />

                <TextInput
                    id="name"
                    type="text"
                    class="mt-1 block w-full"
                    v-model="form.name"
                    required
                    autofocus
                    autocomplete="name"
                />

                <InputError class="mt-2" :message="form.errors.name" />
            </div>

            <div>
                <InputLabel for="email" value="Email" />

                <TextInput
                    id="email"
                    type="email"
                    class="mt-1 block w-full"
                    v-model="form.email"
                    required
                    autocomplete="username"
                />

                <InputError class="mt-2" :message="form.errors.email" />
            </div>

            <div v-if="mustVerifyEmail && user.email_verified_at === null">
                <p class="mt-2 text-sm text-gray-800">
                    Your email address is unverified.
                    <Link
                        :href="route('verification.send')"
                        method="post"
                        as="button"
                        class="rounded-md text-sm text-gray-600 underline hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                    >
                        Click here to re-send the verification email.
                    </Link>
                </p>

                <div
                    v-show="status === 'verification-link-sent'"
                    class="mt-2 text-sm font-medium text-green-600"
                >
                    A new verification link has been sent to your email address.
                </div>
            </div>

            <div class="flex items-center gap-4">
                <PrimaryButton :disabled="form.processing">Save</PrimaryButton>

                <Transition
                    enter-active-class="transition ease-in-out"
                    enter-from-class="opacity-0"
                    leave-active-class="transition ease-in-out"
                    leave-to-class="opacity-0"
                >
                    <p
                        v-if="form.recentlySuccessful"
                        class="text-sm text-gray-600"
                    >
                        Saved.
                    </p>
                </Transition>
            </div>
        </form>
    </section>
</template>
</file>

<file path="resources/js/Pages/Scheduling/Admin/CapacityIndex.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, router } from '@inertiajs/vue3';
import { ref, computed } from 'vue';

const props = defineProps({
    capacities: Array,
    currentYear: Number,
    currentMonth: Number,
});

const selectedDate = ref(null);
const selectedCapacity = ref(null);

const form = useForm({
    date: '',
    total_slots: 10,
});

const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];

// Computed properties
const displayMonth = computed(() => monthNames[props.currentMonth - 1]);
const displayYear = computed(() => props.currentYear);

const daysInMonth = computed(() => {
    return new Date(props.currentYear, props.currentMonth, 0).getDate();
});

const firstDayOfMonth = computed(() => {
    const date = new Date(props.currentYear, props.currentMonth - 1, 1);
    let day = date.getDay();
    return day === 0 ? 6 : day - 1;
});

// Función para obtener capacidad por fecha
const getCapacityForDate = (day) => {
    const dateStr = `${props.currentYear}-${String(props.currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    
    // Buscar la capacidad para esta fecha
    const capacity = props.capacities.find(c => {
        // Extraer solo la parte de la fecha (YYYY-MM-DD) del string ISO
        const capacityDate = c.date.split('T')[0];
        return capacityDate === dateStr;
    });
    
    return capacity;
};

const openModal = (day) => {
    const date = new Date(props.currentYear, props.currentMonth - 1, day);
    selectedDate.value = date.toLocaleDateString('es-ES', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    form.date = `${props.currentYear}-${String(props.currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    
    const capacity = getCapacityForDate(day);
    form.total_slots = capacity ? capacity.total_slots : 10;
    selectedCapacity.value = capacity;
};

const closeModal = () => {
    selectedDate.value = null;
    form.reset();
    form.clearErrors();
};

const submit = () => {
    form.post(route('admin.scheduling.capacities.store'), {
        onSuccess: () => {
            closeModal();
        },
        onError: (errors) => {
            // Los errores se mostrarán automáticamente en los campos
        },
        preserveState: false,
    });
};

const changeMonth = (offset) => {
    const newDate = new Date(props.currentYear, props.currentMonth - 1);
    newDate.setMonth(newDate.getMonth() + offset);
    
    router.get(route('admin.scheduling.capacities.index'), {
        year: newDate.getFullYear(),
        month: newDate.getMonth() + 1,
    }, { 
        preserveState: true,
        preserveScroll: true,
    });
};
</script>

<template>
    <Head title="Gestión de Cupos" />
    <AuthenticatedLayout>
        <template #header>
            <h2 class="font-semibold text-xl text-gray-800 leading-tight">Gestión de Cupos Diarios</h2>
        </template>
        
        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6">
                        <!-- Controles del Calendario -->
                        <div class="flex justify-between items-center mb-4">
                            <button @click="changeMonth(-1)" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition">&lt;</button>
                            <h3 class="text-lg font-semibold">{{ displayMonth }} {{ displayYear }}</h3>
                            <button @click="changeMonth(1)" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 transition">&gt;</button>
                        </div>
                        
                        <!-- Calendario -->
                        <div class="grid grid-cols-7 gap-2 text-center">
                            <div v-for="day in ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom']" :key="day" class="font-bold text-sm text-gray-600 py-2">{{ day }}</div>
                            <div v-for="blank in firstDayOfMonth" :key="`blank-${blank}`"></div>
                            <div v-for="day in daysInMonth" 
                                 :key="day" 
                                 @click="openModal(day)" 
                                 class="p-2 border rounded cursor-pointer hover:bg-gray-50 min-h-[6rem] flex flex-col justify-between transition">
                                <div class="font-bold text-right">{{ day }}</div>
                                <div v-if="getCapacityForDate(day)" class="text-xs text-left">
                                    <p>Reservados: <span class="font-bold text-green-600">{{ getCapacityForDate(day).booked_slots }}</span></p>
                                    <p>Total: <span class="font-bold text-blue-600">{{ getCapacityForDate(day).total_slots }}</span></p>
                                </div>
                                <div v-else class="text-xs text-left text-gray-400">Sin definir</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal para editar capacidad -->
        <div v-if="selectedDate" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="closeModal">
            <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
                <h3 class="text-lg font-bold mb-4">Establecer Capacidad para el {{ selectedDate }}</h3>
                
                <!-- Mostrar errores generales del formulario -->
                <div v-if="form.hasErrors" class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded">
                    <p>Por favor, corrige los siguientes errores:</p>
                    <ul class="list-disc list-inside mt-1">
                        <li v-for="error in Object.values(form.errors)" :key="error">{{ error }}</li>
                    </ul>
                </div>
                
                <form @submit.prevent="submit">
                    <div>
                        <label for="total_slots" class="block font-medium text-sm text-gray-700">Número Total de Cupos</label>
                        <input 
                            id="total_slots" 
                            type="number" 
                            v-model="form.total_slots" 
                            :class="{'border-red-500': form.errors.total_slots}"
                            class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50" 
                            min="1"
                            required 
                        />
                        <div v-if="form.errors.total_slots" class="text-sm text-red-600 mt-1">{{ form.errors.total_slots }}</div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button 
                            type="button" 
                            @click="closeModal" 
                            class="px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition"
                            :disabled="form.processing"
                        >
                            Cancelar
                        </button>
                        <button 
                            type="submit" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition disabled:opacity-50" 
                            :disabled="form.processing"
                        >
                            <span v-if="form.processing">Guardando...</span>
                            <span v-else>Guardar</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Welcome.vue">
<script setup>
import { Head, Link } from '@inertiajs/vue3';

defineProps({
    canLogin: {
        type: Boolean,
    },
    canRegister: {
        type: Boolean,
    },
    laravelVersion: {
        type: String,
        required: true,
    },
    phpVersion: {
        type: String,
        required: true,
    },
});

function handleImageError() {
    document.getElementById('screenshot-container')?.classList.add('!hidden');
    document.getElementById('docs-card')?.classList.add('!row-span-1');
    document.getElementById('docs-card-content')?.classList.add('!flex-row');
    document.getElementById('background')?.classList.add('!hidden');
}
</script>

<template>
    <Head title="Welcome" />
    <div class="bg-gray-50 text-black/50 dark:bg-black dark:text-white/50">
        <img
            id="background"
            class="absolute -left-20 top-0 max-w-[877px]"
            src="https://laravel.com/assets/img/welcome/background.svg"
        />
        <div
            class="relative flex min-h-screen flex-col items-center justify-center selection:bg-[#FF2D20] selection:text-white"
        >
            <div class="relative w-full max-w-2xl px-6 lg:max-w-7xl">
                <header
                    class="grid grid-cols-2 items-center gap-2 py-10 lg:grid-cols-3"
                >
                    <div class="flex lg:col-start-2 lg:justify-center">
                        <svg
                            class="h-12 w-auto text-white lg:h-16 lg:text-[#FF2D20]"
                            viewBox="0 0 62 65"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M61.8548 14.6253C61.8778 14.7102 61.8895 14.7978 61.8897 14.8858V28.5615C61.8898 28.737 61.8434 28.9095 61.7554 29.0614C61.6675 29.2132 61.5409 29.3392 61.3887 29.4265L49.9104 36.0351V49.1337C49.9104 49.4902 49.7209 49.8192 49.4118 49.9987L25.4519 63.7916C25.3971 63.8227 25.3372 63.8427 25.2774 63.8639C25.255 63.8714 25.2338 63.8851 25.2101 63.8913C25.0426 63.9354 24.8666 63.9354 24.6991 63.8913C24.6716 63.8838 24.6467 63.8689 24.6205 63.8589C24.5657 63.8389 24.5084 63.8215 24.456 63.7916L0.501061 49.9987C0.348882 49.9113 0.222437 49.7853 0.134469 49.6334C0.0465019 49.4816 0.000120578 49.3092 0 49.1337L0 8.10652C0 8.01678 0.0124642 7.92953 0.0348998 7.84477C0.0423783 7.8161 0.0598282 7.78993 0.0697995 7.76126C0.0884958 7.70891 0.105946 7.65531 0.133367 7.6067C0.152063 7.5743 0.179485 7.54812 0.20192 7.51821C0.230588 7.47832 0.256763 7.43719 0.290416 7.40229C0.319084 7.37362 0.356476 7.35243 0.388883 7.32751C0.425029 7.29759 0.457436 7.26518 0.498568 7.2415L12.4779 0.345059C12.6296 0.257786 12.8015 0.211853 12.9765 0.211853C13.1515 0.211853 13.3234 0.257786 13.475 0.345059L25.4531 7.2415H25.4556C25.4955 7.26643 25.5292 7.29759 25.5653 7.32626C25.5977 7.35119 25.6339 7.37362 25.6625 7.40104C25.6974 7.43719 25.7224 7.47832 25.7523 7.51821C25.7735 7.54812 25.8021 7.5743 25.8196 7.6067C25.8483 7.65656 25.8645 7.70891 25.8844 7.76126C25.8944 7.78993 25.9118 7.8161 25.9193 7.84602C25.9423 7.93096 25.954 8.01853 25.9542 8.10652V33.7317L35.9355 27.9844V14.8846C35.9355 14.7973 35.948 14.7088 35.9704 14.6253C35.9792 14.5954 35.9954 14.5692 36.0053 14.5405C36.0253 14.4882 36.0427 14.4346 36.0702 14.386C36.0888 14.3536 36.1163 14.3274 36.1375 14.2975C36.1674 14.2576 36.1923 14.2165 36.2272 14.1816C36.2559 14.1529 36.292 14.1317 36.3244 14.1068C36.3618 14.0769 36.3942 14.0445 36.4341 14.0208L48.4147 7.12434C48.5663 7.03694 48.7383 6.99094 48.9133 6.99094C49.0883 6.99094 49.2602 7.03694 49.4118 7.12434L61.3899 14.0208C61.4323 14.0457 61.4647 14.0769 61.5021 14.1055C61.5333 14.1305 61.5694 14.1529 61.5981 14.1803C61.633 14.2165 61.6579 14.2576 61.6878 14.2975C61.7103 14.3274 61.7377 14.3536 61.7551 14.386C61.7838 14.4346 61.8 14.4882 61.8199 14.5405C61.8312 14.5692 61.8474 14.5954 61.8548 14.6253ZM59.893 27.9844V16.6121L55.7013 19.0252L49.9104 22.3593V33.7317L59.8942 27.9844H59.893ZM47.9149 48.5566V37.1768L42.2187 40.4299L25.953 49.7133V61.2003L47.9149 48.5566ZM1.99677 9.83281V48.5566L23.9562 61.199V49.7145L12.4841 43.2219L12.4804 43.2194L12.4754 43.2169C12.4368 43.1945 12.4044 43.1621 12.3682 43.1347C12.3371 43.1097 12.3009 43.0898 12.2735 43.0624L12.271 43.0586C12.2386 43.0275 12.2162 42.9888 12.1887 42.9539C12.1638 42.9203 12.1339 42.8916 12.114 42.8567L12.1127 42.853C12.0903 42.8156 12.0766 42.7707 12.0604 42.7283C12.0442 42.6909 12.023 42.656 12.013 42.6161C12.0005 42.5688 11.998 42.5177 11.9931 42.4691C11.9881 42.4317 11.9781 42.3943 11.9781 42.3569V15.5801L6.18848 12.2446L1.99677 9.83281ZM12.9777 2.36177L2.99764 8.10652L12.9752 13.8513L22.9541 8.10527L12.9752 2.36177H12.9777ZM18.1678 38.2138L23.9574 34.8809V9.83281L19.7657 12.2459L13.9749 15.5801V40.6281L18.1678 38.2138ZM48.9133 9.14105L38.9344 14.8858L48.9133 20.6305L58.8909 14.8846L48.9133 9.14105ZM47.9149 22.3593L42.124 19.0252L37.9323 16.6121V27.9844L43.7219 31.3174L47.9149 33.7317V22.3593ZM24.9533 47.987L39.59 39.631L46.9065 35.4555L36.9352 29.7145L25.4544 36.3242L14.9907 42.3482L24.9533 47.987Z"
                                fill="currentColor"
                            />
                        </svg>
                    </div>
                    <nav v-if="canLogin" class="-mx-3 flex flex-1 justify-end">
                        <Link
                            v-if="$page.props.auth.user"
                            :href="route('dashboard')"
                            class="rounded-md px-3 py-2 text-black ring-1 ring-transparent transition hover:text-black/70 focus:outline-none focus-visible:ring-[#FF2D20] dark:text-white dark:hover:text-white/80 dark:focus-visible:ring-white"
                        >
                            Dashboard
                        </Link>

                        <template v-else>
                            <Link
                                :href="route('login')"
                                class="rounded-md px-3 py-2 text-black ring-1 ring-transparent transition hover:text-black/70 focus:outline-none focus-visible:ring-[#FF2D20] dark:text-white dark:hover:text-white/80 dark:focus-visible:ring-white"
                            >
                                Log in
                            </Link>

                            <Link
                                v-if="canRegister"
                                :href="route('register')"
                                class="rounded-md px-3 py-2 text-black ring-1 ring-transparent transition hover:text-black/70 focus:outline-none focus-visible:ring-[#FF2D20] dark:text-white dark:hover:text-white/80 dark:focus-visible:ring-white"
                            >
                                Register
                            </Link>
                        </template>
                    </nav>
                </header>

                <main class="mt-6">
                    <div class="grid gap-6 lg:grid-cols-2 lg:gap-8">
                        <a
                            href="https://laravel.com/docs"
                            id="docs-card"
                            class="flex flex-col items-start gap-6 overflow-hidden rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] transition duration-300 hover:text-black/70 hover:ring-black/20 focus:outline-none focus-visible:ring-[#FF2D20] md:row-span-3 lg:p-10 lg:pb-10 dark:bg-zinc-900 dark:ring-zinc-800 dark:hover:text-white/70 dark:hover:ring-zinc-700 dark:focus-visible:ring-[#FF2D20]"
                        >
                            <div
                                id="screenshot-container"
                                class="relative flex w-full flex-1 items-stretch"
                            >
                                <img
                                    src="https://laravel.com/assets/img/welcome/docs-light.svg"
                                    alt="Laravel documentation screenshot"
                                    class="aspect-video h-full w-full flex-1 rounded-[10px] object-cover object-top drop-shadow-[0px_4px_34px_rgba(0,0,0,0.06)] dark:hidden"
                                    @error="handleImageError"
                                />
                                <img
                                    src="https://laravel.com/assets/img/welcome/docs-dark.svg"
                                    alt="Laravel documentation screenshot"
                                    class="hidden aspect-video h-full w-full flex-1 rounded-[10px] object-cover object-top drop-shadow-[0px_4px_34px_rgba(0,0,0,0.25)] dark:block"
                                />
                                <div
                                    class="absolute -bottom-16 -left-16 h-40 w-[calc(100%+8rem)] bg-gradient-to-b from-transparent via-white to-white dark:via-zinc-900 dark:to-zinc-900"
                                ></div>
                            </div>

                            <div
                                class="relative flex items-center gap-6 lg:items-end"
                            >
                                <div
                                    id="docs-card-content"
                                    class="flex items-start gap-6 lg:flex-col"
                                >
                                    <div
                                        class="flex size-12 shrink-0 items-center justify-center rounded-full bg-[#FF2D20]/10 sm:size-16"
                                    >
                                        <svg
                                            class="size-5 sm:size-6"
                                            xmlns="http://www.w3.org/2000/svg"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                fill="#FF2D20"
                                                d="M23 4a1 1 0 0 0-1.447-.894L12.224 7.77a.5.5 0 0 1-.448 0L2.447 3.106A1 1 0 0 0 1 4v13.382a1.99 1.99 0 0 0 1.105 1.79l9.448 4.728c.14.065.293.1.447.1.154-.005.306-.04.447-.105l9.453-4.724a1.99 1.99 0 0 0 1.1-1.789V4ZM3 6.023a.25.25 0 0 1 .362-.223l7.5 3.75a.251.251 0 0 1 .138.223v11.2a.25.25 0 0 1-.362.224l-7.5-3.75a.25.25 0 0 1-.138-.22V6.023Zm18 11.2a.25.25 0 0 1-.138.224l-7.5 3.75a.249.249 0 0 1-.329-.099.249.249 0 0 1-.033-.12V9.772a.251.251 0 0 1 .138-.224l7.5-3.75a.25.25 0 0 1 .362.224v11.2Z"
                                            />
                                            <path
                                                fill="#FF2D20"
                                                d="m3.55 1.893 8 4.048a1.008 1.008 0 0 0 .9 0l8-4.048a1 1 0 0 0-.9-1.785l-7.322 3.706a.506.506 0 0 1-.452 0L4.454.108a1 1 0 0 0-.9 1.785H3.55Z"
                                            />
                                        </svg>
                                    </div>

                                    <div class="pt-3 sm:pt-5 lg:pt-0">
                                        <h2
                                            class="text-xl font-semibold text-black dark:text-white"
                                        >
                                            Documentation
                                        </h2>

                                        <p class="mt-4 text-sm/relaxed">
                                            Laravel has wonderful documentation
                                            covering every aspect of the
                                            framework. Whether you are a
                                            newcomer or have prior experience
                                            with Laravel, we recommend reading
                                            our documentation from beginning to
                                            end.
                                        </p>
                                    </div>
                                </div>

                                <svg
                                    class="size-6 shrink-0 stroke-[#FF2D20]"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke-width="1.5"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        d="M4.5 12h15m0 0l-6.75-6.75M19.5 12l-6.75 6.75"
                                    />
                                </svg>
                            </div>
                        </a>

                        <a
                            href="https://laracasts.com"
                            class="flex items-start gap-4 rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] transition duration-300 hover:text-black/70 hover:ring-black/20 focus:outline-none focus-visible:ring-[#FF2D20] lg:pb-10 dark:bg-zinc-900 dark:ring-zinc-800 dark:hover:text-white/70 dark:hover:ring-zinc-700 dark:focus-visible:ring-[#FF2D20]"
                        >
                            <div
                                class="flex size-12 shrink-0 items-center justify-center rounded-full bg-[#FF2D20]/10 sm:size-16"
                            >
                                <svg
                                    class="size-5 sm:size-6"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                >
                                    <g fill="#FF2D20">
                                        <path
                                            d="M24 8.25a.5.5 0 0 0-.5-.5H.5a.5.5 0 0 0-.5.5v12a2.5 2.5 0 0 0 2.5 2.5h19a2.5 2.5 0 0 0 2.5-2.5v-12Zm-7.765 5.868a1.221 1.221 0 0 1 0 2.264l-6.626 2.776A1.153 1.153 0 0 1 8 18.123v-5.746a1.151 1.151 0 0 1 1.609-1.035l6.626 2.776ZM19.564 1.677a.25.25 0 0 0-.177-.427H15.6a.106.106 0 0 0-.072.03l-4.54 4.543a.25.25 0 0 0 .177.427h3.783c.027 0 .054-.01.073-.03l4.543-4.543ZM22.071 1.318a.047.047 0 0 0-.045.013l-4.492 4.492a.249.249 0 0 0 .038.385.25.25 0 0 0 .14.042h5.784a.5.5 0 0 0 .5-.5v-2a2.5 2.5 0 0 0-1.925-2.432ZM13.014 1.677a.25.25 0 0 0-.178-.427H9.101a.106.106 0 0 0-.073.03l-4.54 4.543a.25.25 0 0 0 .177.427H8.4a.106.106 0 0 0 .073-.03l4.54-4.543ZM6.513 1.677a.25.25 0 0 0-.177-.427H2.5A2.5 2.5 0 0 0 0 3.75v2a.5.5 0 0 0 .5.5h1.4a.106.106 0 0 0 .073-.03l4.54-4.543Z"
                                        />
                                    </g>
                                </svg>
                            </div>

                            <div class="pt-3 sm:pt-5">
                                <h2
                                    class="text-xl font-semibold text-black dark:text-white"
                                >
                                    Laracasts
                                </h2>

                                <p class="mt-4 text-sm/relaxed">
                                    Laracasts offers thousands of video
                                    tutorials on Laravel, PHP, and JavaScript
                                    development. Check them out, see for
                                    yourself, and massively level up your
                                    development skills in the process.
                                </p>
                            </div>

                            <svg
                                class="size-6 shrink-0 self-center stroke-[#FF2D20]"
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke-width="1.5"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    d="M4.5 12h15m0 0l-6.75-6.75M19.5 12l-6.75 6.75"
                                />
                            </svg>
                        </a>

                        <a
                            href="https://laravel-news.com"
                            class="flex items-start gap-4 rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] transition duration-300 hover:text-black/70 hover:ring-black/20 focus:outline-none focus-visible:ring-[#FF2D20] lg:pb-10 dark:bg-zinc-900 dark:ring-zinc-800 dark:hover:text-white/70 dark:hover:ring-zinc-700 dark:focus-visible:ring-[#FF2D20]"
                        >
                            <div
                                class="flex size-12 shrink-0 items-center justify-center rounded-full bg-[#FF2D20]/10 sm:size-16"
                            >
                                <svg
                                    class="size-5 sm:size-6"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                >
                                    <g fill="#FF2D20">
                                        <path
                                            d="M8.75 4.5H5.5c-.69 0-1.25.56-1.25 1.25v4.75c0 .69.56 1.25 1.25 1.25h3.25c.69 0 1.25-.56 1.25-1.25V5.75c0-.69-.56-1.25-1.25-1.25Z"
                                        />
                                        <path
                                            d="M24 10a3 3 0 0 0-3-3h-2V2.5a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2V20a3.5 3.5 0 0 0 3.5 3.5h17A3.5 3.5 0 0 0 24 20V10ZM3.5 21.5A1.5 1.5 0 0 1 2 20V3a.5.5 0 0 1 .5-.5h14a.5.5 0 0 1 .5.5v17c0 .295.037.588.11.874a.5.5 0 0 1-.484.625L3.5 21.5ZM22 20a1.5 1.5 0 1 1-3 0V9.5a.5.5 0 0 1 .5-.5H21a1 1 0 0 1 1 1v10Z"
                                        />
                                        <path
                                            d="M12.751 6.047h2a.75.75 0 0 1 .75.75v.5a.75.75 0 0 1-.75.75h-2A.75.75 0 0 1 12 7.3v-.5a.75.75 0 0 1 .751-.753ZM12.751 10.047h2a.75.75 0 0 1 .75.75v.5a.75.75 0 0 1-.75.75h-2A.75.75 0 0 1 12 11.3v-.5a.75.75 0 0 1 .751-.753ZM4.751 14.047h10a.75.75 0 0 1 .75.75v.5a.75.75 0 0 1-.75.75h-10A.75.75 0 0 1 4 15.3v-.5a.75.75 0 0 1 .751-.753ZM4.75 18.047h7.5a.75.75 0 0 1 .75.75v.5a.75.75 0 0 1-.75.75h-7.5A.75.75 0 0 1 4 19.3v-.5a.75.75 0 0 1 .75-.753Z"
                                        />
                                    </g>
                                </svg>
                            </div>

                            <div class="pt-3 sm:pt-5">
                                <h2
                                    class="text-xl font-semibold text-black dark:text-white"
                                >
                                    Laravel News
                                </h2>

                                <p class="mt-4 text-sm/relaxed">
                                    Laravel News is a community driven portal
                                    and newsletter aggregating all of the latest
                                    and most important news in the Laravel
                                    ecosystem, including new package releases
                                    and tutorials.
                                </p>
                            </div>

                            <svg
                                class="size-6 shrink-0 self-center stroke-[#FF2D20]"
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke-width="1.5"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    d="M4.5 12h15m0 0l-6.75-6.75M19.5 12l-6.75 6.75"
                                />
                            </svg>
                        </a>

                        <div
                            class="flex items-start gap-4 rounded-lg bg-white p-6 shadow-[0px_14px_34px_0px_rgba(0,0,0,0.08)] ring-1 ring-white/[0.05] lg:pb-10 dark:bg-zinc-900 dark:ring-zinc-800"
                        >
                            <div
                                class="flex size-12 shrink-0 items-center justify-center rounded-full bg-[#FF2D20]/10 sm:size-16"
                            >
                                <svg
                                    class="size-5 sm:size-6"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                >
                                    <g fill="#FF2D20">
                                        <path
                                            d="M16.597 12.635a.247.247 0 0 0-.08-.237 2.234 2.234 0 0 1-.769-1.68c.001-.195.03-.39.084-.578a.25.25 0 0 0-.09-.267 8.8 8.8 0 0 0-4.826-1.66.25.25 0 0 0-.268.181 2.5 2.5 0 0 1-2.4 1.824.045.045 0 0 0-.045.037 12.255 12.255 0 0 0-.093 3.86.251.251 0 0 0 .208.214c2.22.366 4.367 1.08 6.362 2.118a.252.252 0 0 0 .32-.079 10.09 10.09 0 0 0 1.597-3.733ZM13.616 17.968a.25.25 0 0 0-.063-.407A19.697 19.697 0 0 0 8.91 15.98a.25.25 0 0 0-.287.325c.151.455.334.898.548 1.328.437.827.981 1.594 1.619 2.28a.249.249 0 0 0 .32.044 29.13 29.13 0 0 0 2.506-1.99ZM6.303 14.105a.25.25 0 0 0 .265-.274 13.048 13.048 0 0 1 .205-4.045.062.062 0 0 0-.022-.07 2.5 2.5 0 0 1-.777-.982.25.25 0 0 0-.271-.149 11 11 0 0 0-5.6 2.815.255.255 0 0 0-.075.163c-.008.135-.02.27-.02.406.002.8.084 1.598.246 2.381a.25.25 0 0 0 .303.193 19.924 19.924 0 0 1 5.746-.438ZM9.228 20.914a.25.25 0 0 0 .1-.393 11.53 11.53 0 0 1-1.5-2.22 12.238 12.238 0 0 1-.91-2.465.248.248 0 0 0-.22-.187 18.876 18.876 0 0 0-5.69.33.249.249 0 0 0-.179.336c.838 2.142 2.272 4 4.132 5.353a.254.254 0 0 0 .15.048c1.41-.01 2.807-.282 4.117-.802ZM18.93 12.957l-.005-.008a.25.25 0 0 0-.268-.082 2.21 2.21 0 0 1-.41.081.25.25 0 0 0-.217.2c-.582 2.66-2.127 5.35-5.75 7.843a.248.248 0 0 0-.09.299.25.25 0 0 0 .065.091 28.703 28.703 0 0 0 2.662 2.12.246.246 0 0 0 .209.037c2.579-.701 4.85-2.242 6.456-4.378a.25.25 0 0 0 .048-.189 13.51 13.51 0 0 0-2.7-6.014ZM5.702 7.058a.254.254 0 0 0 .2-.165A2.488 2.488 0 0 1 7.98 5.245a.093.093 0 0 0 .078-.062 19.734 19.734 0 0 1 3.055-4.74.25.25 0 0 0-.21-.41 12.009 12.009 0 0 0-10.4 8.558.25.25 0 0 0 .373.281 12.912 12.912 0 0 1 4.826-1.814ZM10.773 22.052a.25.25 0 0 0-.28-.046c-.758.356-1.55.635-2.365.833a.25.25 0 0 0-.022.48c1.252.43 2.568.65 3.893.65.1 0 .2 0 .3-.008a.25.25 0 0 0 .147-.444c-.526-.424-1.1-.917-1.673-1.465ZM18.744 8.436a.249.249 0 0 0 .15.228 2.246 2.246 0 0 1 1.352 2.054c0 .337-.08.67-.23.972a.25.25 0 0 0 .042.28l.007.009a15.016 15.016 0 0 1 2.52 4.6.25.25 0 0 0 .37.132.25.25 0 0 0 .096-.114c.623-1.464.944-3.039.945-4.63a12.005 12.005 0 0 0-5.78-10.258.25.25 0 0 0-.373.274c.547 2.109.85 4.274.901 6.453ZM9.61 5.38a.25.25 0 0 0 .08.31c.34.24.616.561.8.935a.25.25 0 0 0 .3.127.631.631 0 0 1 .206-.034c2.054.078 4.036.772 5.69 1.991a.251.251 0 0 0 .267.024c.046-.024.093-.047.141-.067a.25.25 0 0 0 .151-.23A29.98 29.98 0 0 0 15.957.764a.25.25 0 0 0-.16-.164 11.924 11.924 0 0 0-2.21-.518.252.252 0 0 0-.215.076A22.456 22.456 0 0 0 9.61 5.38Z"
                                        />
                                    </g>
                                </svg>
                            </div>

                            <div class="pt-3 sm:pt-5">
                                <h2
                                    class="text-xl font-semibold text-black dark:text-white"
                                >
                                    Vibrant Ecosystem
                                </h2>

                                <p class="mt-4 text-sm/relaxed">
                                    Laravel's robust library of first-party
                                    tools and libraries, such as
                                    <a
                                        href="https://forge.laravel.com"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white dark:focus-visible:ring-[#FF2D20]"
                                        >Forge</a
                                    >,
                                    <a
                                        href="https://vapor.laravel.com"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Vapor</a
                                    >,
                                    <a
                                        href="https://nova.laravel.com"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Nova</a
                                    >,
                                    <a
                                        href="https://envoyer.io"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Envoyer</a
                                    >, and
                                    <a
                                        href="https://herd.laravel.com"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Herd</a
                                    >
                                    help you take your projects to the next
                                    level. Pair them with powerful open source
                                    libraries like
                                    <a
                                        href="https://laravel.com/docs/billing"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Cashier</a
                                    >,
                                    <a
                                        href="https://laravel.com/docs/dusk"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Dusk</a
                                    >,
                                    <a
                                        href="https://laravel.com/docs/broadcasting"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Echo</a
                                    >,
                                    <a
                                        href="https://laravel.com/docs/horizon"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Horizon</a
                                    >,
                                    <a
                                        href="https://laravel.com/docs/sanctum"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Sanctum</a
                                    >,
                                    <a
                                        href="https://laravel.com/docs/telescope"
                                        class="rounded-sm underline hover:text-black focus:outline-none focus-visible:ring-1 focus-visible:ring-[#FF2D20] dark:hover:text-white"
                                        >Telescope</a
                                    >, and more.
                                </p>
                            </div>
                        </div>
                    </div>
                </main>

                <footer
                    class="py-16 text-center text-sm text-black dark:text-white/70"
                >
                    Laravel v{{ laravelVersion }} (PHP v{{ phpVersion }})
                </footer>
            </div>
        </div>
    </div>
</template>
</file>

<file path="resources/js/ziggy.js">
const Ziggy = {"url":"http:\/\/localhost","port":null,"defaults":{},"routes":{"sanctum.csrf-cookie":{"uri":"sanctum\/csrf-cookie","methods":["GET","HEAD"]},"admin.scheduling.capacities.index":{"uri":"admin\/scheduling\/capacidades","methods":["GET","HEAD"]},"admin.scheduling.capacities.store":{"uri":"admin\/scheduling\/capacidades","methods":["POST"]},"cliente.dashboard":{"uri":"cliente\/dashboard","methods":["GET","HEAD"]},"dashboard":{"uri":"dashboard","methods":["GET","HEAD"]},"profile.edit":{"uri":"profile","methods":["GET","HEAD"]},"profile.update":{"uri":"profile","methods":["PATCH"]},"profile.destroy":{"uri":"profile","methods":["DELETE"]},"register":{"uri":"register","methods":["GET","HEAD"]},"login":{"uri":"login","methods":["GET","HEAD"]},"password.request":{"uri":"forgot-password","methods":["GET","HEAD"]},"password.email":{"uri":"forgot-password","methods":["POST"]},"password.reset":{"uri":"reset-password\/{token}","methods":["GET","HEAD"],"parameters":["token"]},"password.store":{"uri":"reset-password","methods":["POST"]},"verification.notice":{"uri":"verify-email","methods":["GET","HEAD"]},"verification.verify":{"uri":"verify-email\/{id}\/{hash}","methods":["GET","HEAD"],"parameters":["id","hash"]},"verification.send":{"uri":"email\/verification-notification","methods":["POST"]},"password.confirm":{"uri":"confirm-password","methods":["GET","HEAD"]},"password.update":{"uri":"password","methods":["PUT"]},"logout":{"uri":"logout","methods":["POST"]},"clientes.index":{"uri":"clientes","methods":["GET","HEAD"]},"clientes.create":{"uri":"clientes\/crear","methods":["GET","HEAD"]},"clientes.store":{"uri":"clientes","methods":["POST"]},"clientes.show":{"uri":"clientes\/{cliente}","methods":["GET","HEAD"],"parameters":["cliente"],"bindings":{"cliente":"id"}},"clientes.edit":{"uri":"clientes\/{cliente}\/editar","methods":["GET","HEAD"],"parameters":["cliente"],"bindings":{"cliente":"id"}},"clientes.update":{"uri":"clientes\/{cliente}","methods":["PATCH"],"parameters":["cliente"],"bindings":{"cliente":"id"}},"clientes.destroy":{"uri":"clientes\/{cliente}","methods":["DELETE"],"parameters":["cliente"],"bindings":{"cliente":"id"}},"clientes.vehiculos.create":{"uri":"clientes\/{cliente}\/vehiculos\/crear","methods":["GET","HEAD"],"parameters":["cliente"],"bindings":{"cliente":"id"}},"clientes.vehiculos.store":{"uri":"clientes\/{cliente}\/vehiculos","methods":["POST"],"parameters":["cliente"],"bindings":{"cliente":"id"}},"clientes.vehiculos.edit":{"uri":"clientes\/{cliente}\/vehiculos\/{vehiculo}\/editar","methods":["GET","HEAD"],"parameters":["cliente","vehiculo"],"bindings":{"cliente":"id","vehiculo":"id"}},"clientes.vehiculos.update":{"uri":"clientes\/{cliente}\/vehiculos\/{vehiculo}","methods":["PATCH"],"parameters":["cliente","vehiculo"],"bindings":{"cliente":"id","vehiculo":"id"}},"clientes.vehiculos.destroy":{"uri":"clientes\/{cliente}\/vehiculos\/{vehiculo}","methods":["DELETE"],"parameters":["cliente","vehiculo"],"bindings":{"cliente":"id","vehiculo":"id"}},"inventario.products.index":{"uri":"inventario\/productos","methods":["GET","HEAD"]},"inventario.products.create":{"uri":"inventario\/productos\/crear","methods":["GET","HEAD"]},"inventario.products.store":{"uri":"inventario\/productos","methods":["POST"]},"inventario.products.edit":{"uri":"inventario\/productos\/{product}\/editar","methods":["GET","HEAD"],"parameters":["product"],"bindings":{"product":"id"}},"inventario.products.update":{"uri":"inventario\/productos\/{product}","methods":["PATCH"],"parameters":["product"],"bindings":{"product":"id"}},"inventario.products.destroy":{"uri":"inventario\/productos\/{product}","methods":["DELETE"],"parameters":["product"],"bindings":{"product":"id"}},"inventario.suppliers.index":{"uri":"inventario\/proveedores","methods":["GET","HEAD"]},"inventario.suppliers.create":{"uri":"inventario\/proveedores\/crear","methods":["GET","HEAD"]},"inventario.suppliers.store":{"uri":"inventario\/proveedores","methods":["POST"]},"inventario.suppliers.edit":{"uri":"inventario\/proveedores\/{supplier}\/editar","methods":["GET","HEAD"],"parameters":["supplier"],"bindings":{"supplier":"id"}},"inventario.suppliers.update":{"uri":"inventario\/proveedores\/{supplier}","methods":["PATCH"],"parameters":["supplier"],"bindings":{"supplier":"id"}},"inventario.suppliers.destroy":{"uri":"inventario\/proveedores\/{supplier}","methods":["DELETE"],"parameters":["supplier"],"bindings":{"supplier":"id"}},"mecanico.dashboard":{"uri":"mecanico\/dashboard","methods":["GET","HEAD"]},"work-orders.index":{"uri":"ordenes-trabajo","methods":["GET","HEAD"]},"work-orders.create":{"uri":"ordenes-trabajo\/crear\/vehiculo\/{vehiculo}","methods":["GET","HEAD"],"parameters":["vehiculo"],"bindings":{"vehiculo":"id"}},"work-orders.store":{"uri":"ordenes-trabajo","methods":["POST"]},"work-orders.show":{"uri":"ordenes-trabajo\/{workOrder}","methods":["GET","HEAD"],"parameters":["workOrder"],"bindings":{"workOrder":"id"}},"work-orders.update":{"uri":"ordenes-trabajo\/{workOrder}","methods":["PATCH"],"parameters":["workOrder"],"bindings":{"workOrder":"id"}},"work-orders.destroy":{"uri":"ordenes-trabajo\/{workOrder}","methods":["DELETE"],"parameters":["workOrder"],"bindings":{"workOrder":"id"}},"work-orders.products.add":{"uri":"ordenes-trabajo\/{workOrder}\/products","methods":["POST"],"parameters":["workOrder"],"bindings":{"workOrder":"id"}},"work-orders.products.remove":{"uri":"ordenes-trabajo\/{workOrder}\/products\/{product}","methods":["DELETE"],"parameters":["workOrder","product"],"bindings":{"workOrder":"id","product":"id"}},"work-orders.services.add":{"uri":"ordenes-trabajo\/{workOrder}\/services","methods":["POST"],"parameters":["workOrder"],"bindings":{"workOrder":"id"}},"work-orders.services.remove":{"uri":"ordenes-trabajo\/{workOrder}\/services\/{service}","methods":["DELETE"],"parameters":["workOrder","service"],"bindings":{"workOrder":"id","service":"id"}},"work-orders.external-costs.add":{"uri":"ordenes-trabajo\/{workOrder}\/external-costs","methods":["POST"],"parameters":["workOrder"],"bindings":{"workOrder":"id"}},"work-orders.external-costs.remove":{"uri":"ordenes-trabajo\/external-costs\/{externalCost}","methods":["DELETE"],"parameters":["externalCost"],"bindings":{"externalCost":"id"}},"work-orders.assign-mechanic":{"uri":"ordenes-trabajo\/{workOrder}\/assign-mechanic","methods":["PATCH"],"parameters":["workOrder"],"bindings":{"workOrder":"id"}},"storage.local":{"uri":"storage\/{path}","methods":["GET","HEAD"],"wheres":{"path":".*"},"parameters":["path"]}}};
if (typeof window !== 'undefined' && typeof window.Ziggy !== 'undefined') {
  Object.assign(Ziggy.routes, window.Ziggy.routes);
}
export { Ziggy };
</file>

<file path="resources/views/app.blade.php">
<!DOCTYPE html>
<html lang="{{ str_replace('_', '-', app()->getLocale()) }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title inertia>{{ config('app.name', 'Laravel') }}</title>

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=figtree:400,500,600&display=swap" rel="stylesheet" />

        <!-- Scripts -->
        @routes
        @vite(['resources/js/app.js', "resources/js/Pages/{$page['component']}.vue"])
        @inertiaHead
    </head>
    <body class="font-sans antialiased">
        @inertia
    </body>
</html>
</file>

<file path="routes/auth.php">
<?php

use App\Http\Controllers\Auth\AuthenticatedSessionController;
use App\Http\Controllers\Auth\ConfirmablePasswordController;
use App\Http\Controllers\Auth\EmailVerificationNotificationController;
use App\Http\Controllers\Auth\EmailVerificationPromptController;
use App\Http\Controllers\Auth\NewPasswordController;
use App\Http\Controllers\Auth\PasswordController;
use App\Http\Controllers\Auth\PasswordResetLinkController;
use App\Http\Controllers\Auth\RegisteredUserController;
use App\Http\Controllers\Auth\VerifyEmailController;
use Illuminate\Support\Facades\Route;

Route::middleware('guest')->group(function () {
    Route::get('register', [RegisteredUserController::class, 'create'])
        ->name('register');

    Route::post('register', [RegisteredUserController::class, 'store']);

    Route::get('login', [AuthenticatedSessionController::class, 'create'])
        ->name('login');

    Route::post('login', [AuthenticatedSessionController::class, 'store']);

    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])
        ->name('password.request');

    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])
        ->name('password.email');

    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])
        ->name('password.reset');

    Route::post('reset-password', [NewPasswordController::class, 'store'])
        ->name('password.store');
});

Route::middleware('auth')->group(function () {
    Route::get('verify-email', EmailVerificationPromptController::class)
        ->name('verification.notice');

    Route::get('verify-email/{id}/{hash}', VerifyEmailController::class)
        ->middleware(['signed', 'throttle:6,1'])
        ->name('verification.verify');

    Route::post('email/verification-notification', [EmailVerificationNotificationController::class, 'store'])
        ->middleware('throttle:6,1')
        ->name('verification.send');

    Route::get('confirm-password', [ConfirmablePasswordController::class, 'show'])
        ->name('password.confirm');

    Route::post('confirm-password', [ConfirmablePasswordController::class, 'store']);

    Route::put('password', [PasswordController::class, 'update'])->name('password.update');

    Route::post('logout', [AuthenticatedSessionController::class, 'destroy'])
        ->name('logout');
});
</file>

<file path="routes/console.php">
<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;

Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');
</file>

<file path="src/ClientPortal/Http/Controllers/DashboardController.php">
<?php
namespace FlipperBox\ClientPortal\Http\Controllers;

use App\Http\Controllers\Controller;
use Inertia\Inertia;
use Inertia\Response;

class DashboardController extends Controller
{
    public function index(): Response
    {
        return Inertia::render('ClientPortal/Dashboard');
    }
}
</file>

<file path="src/ClientPortal/Providers/ClientPortalServiceProvider.php">
<?php
namespace FlipperBox\ClientPortal\Providers;

use Illuminate\Support\Facades\Route;
use Illuminate\Support\ServiceProvider;

class ClientPortalServiceProvider extends ServiceProvider
{
    public function boot(): void
    {
        Route::middleware(['web', 'auth'])
            ->prefix('cliente')
            ->name('cliente.')
            ->group(function () {
                $this->loadRoutesFrom(__DIR__.'/../routes/web.php');
            });
    }
}
</file>

<file path="src/ClientScheduling/Http/Controllers/BookingController.php">
<?php

namespace FlipperBox\ClientScheduling\Http\Controllers;

use App\Http\Controllers\Controller;
use FlipperBox\Crm\Models\Vehiculo;
use FlipperBox\Scheduling\Models\DailyCapacity;
use FlipperBox\Scheduling\Models\Reservation;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Carbon;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;
use Illuminate\Validation\ValidationException;
use Inertia\Inertia;
use Inertia\Response;
use App\Models\User;

class BookingController extends Controller
{
    public function index(Request $request): Response
    {
        /** @var \App\Models\User $user */
        $user = Auth::user();
        $user->load('vehicles');

        if ($user->vehicles->isEmpty()) {
            return Inertia::render('ClientScheduling/BookingIndex', [
                'vehicles' => [],
                'capacities' => [],
            ]);
        }

        $year = $request->input('year', now()->year);
        $month = $request->input('month', now()->month);

        $capacities = DailyCapacity::whereYear('date', $year)
            ->whereMonth('date', $month)
            ->where('date', '>=', today())
            ->orderBy('date')
            ->get()
            ->map(fn ($capacity) => [
                'date' => $capacity->date->format('Y-m-d'),
                'available_slots' => $capacity->total_slots - $capacity->booked_slots,
            ]);

        return Inertia::render('ClientScheduling/BookingIndex', [
            'vehicles' => $user->vehicles,
            'capacities' => $capacities,
            'currentYear' => (int)$year,
            'currentMonth' => (int)$month,
        ]);
    }

    public function store(Request $request): RedirectResponse
    {
        $validated = $request->validate([
            'vehicle_id' => ['required', 'exists:vehiculos,id'],
            'reservation_date' => ['required', 'date', 'after_or_equal:today'],
            'notes' => ['nullable', 'string', 'max:1000'],
        ]);

        /** @var \App\Models\User $user */
        $user = Auth::user();

        if (! $user->vehicles()->where('id', $validated['vehicle_id'])->exists()) {
            return back()->with('error', 'El vehículo seleccionado no es válido.');
        }

        DB::transaction(function () use ($validated, $user) {
            $capacity = DailyCapacity::where('date', $validated['reservation_date'])->lockForUpdate()->first();

            if (!$capacity || $capacity->booked_slots >= $capacity->total_slots) {
                throw ValidationException::withMessages([
                    'reservation_date' => 'No hay cupos disponibles para la fecha seleccionada.',
                ]);
            }

            Reservation::create([
                'user_id' => $user->id,
                'vehicle_id' => $validated['vehicle_id'],
                'reservation_date' => $validated['reservation_date'],
                'notes' => $validated['notes'],
                'status' => 'Pendiente',
            ]);

            $capacity->increment('booked_slots');
        });

        return to_route('cliente.dashboard')->with('success', 'Tu solicitud de reserva ha sido enviada. Recibirás una notificación cuando sea confirmada.');
    }
}
</file>

<file path="src/ClientScheduling/Providers/ClientSchedulingServiceProvider.php">
<?php

namespace FlipperBox\ClientScheduling\Providers;

use Illuminate\Support\Facades\Route;
use Illuminate\Support\ServiceProvider;

class ClientSchedulingServiceProvider extends ServiceProvider
{
    public function boot(): void
    {
        Route::middleware(['web', 'auth'])
            ->prefix('cliente/reservas')
            ->name('cliente.reservations.')
            ->group(function () {
                $this->loadRoutesFrom(__DIR__.'/../routes/web.php');
            });
    }
}
</file>

<file path="src/ClientScheduling/routes/web.php">
<?php

use FlipperBox\ClientScheduling\Http\Controllers\BookingController;
use Illuminate\Support\Facades\Route;

Route::get('/', [BookingController::class, 'index'])->name('index');
Route::post('/', [BookingController::class, 'store'])->name('store');
</file>

<file path="src/Core/Providers/CoreServiceProvider.php">
<?php

namespace FlipperBox\Core\Providers;

use Illuminate\Support\Facades\Route;
use Illuminate\Support\ServiceProvider;

class CoreServiceProvider extends ServiceProvider
{
    /**
     * Register services.
     */
    public function register(): void
    {
        //
    }

    /**
     * Bootstrap services.
     */
    public function boot(): void
    {
        Route::middleware('web')
            ->group(function () {
                $this->loadRoutesFrom(__DIR__.'/../routes/web.php');
            });
    }
}
</file>

<file path="src/Crm/Actions/CreateUserAsClientAction.php">
<?php
namespace FlipperBox\Crm\Actions;

use App\Models\User;
use Illuminate\Support\Facades\Hash;
use Spatie\Permission\Models\Role;

class CreateUserAsClientAction
{
    public function execute(array $data): User
    {
        // Añadimos la contraseña por defecto
        $data['password'] = Hash::make('password');

        $user = User::create($data);

        // Asignamos el rol 'Cliente'
        $clienteRole = Role::findByName('Cliente');
        $user->assignRole($clienteRole);

        return $user;
    }
}
</file>

<file path="src/Crm/Http/Requests/StoreUserAsClientRequest.php">
<?php

namespace FlipperBox\Crm\Http\Requests;

use App\Models\User;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\Rules;

class StoreUserAsClientRequest extends FormRequest
{
    public function authorize(): bool
    {
        return Auth::user()->can('crear clientes');
    }

    public function rules(): array
    {
        return [
            'name' => ['required', 'string', 'max:255'],
            'apellido' => ['nullable', 'string', 'max:255'],
            'email' => ['required', 'string', 'lowercase', 'email', 'max:255', 'unique:'.User::class],
            'telefono' => ['nullable', 'string', 'max:20', 'unique:'.User::class],
            'documento_tipo' => ['nullable', 'string', 'max:50'],
            'documento_valor' => ['nullable', 'string', 'max:50', 'unique:'.User::class],
        ];
    }
}
</file>

<file path="src/Crm/Http/Requests/UpdateUserAsClientRequest.php">
<?php

namespace FlipperBox\Crm\Http\Requests;

use App\Models\User;
use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\Rule;

class UpdateUserAsClientRequest extends FormRequest
{
    public function authorize(): bool
    {
        return Auth::user()->can('editar clientes');
    }

    public function rules(): array
    {
        $userId = $this->route('user')->id;

        return [
            'name' => ['required', 'string', 'max:255'],
            'apellido' => ['nullable', 'string', 'max:255'],
            'email' => ['required', 'string', 'lowercase', 'email', 'max:255', Rule::unique(User::class)->ignore($userId)],
            'telefono' => ['nullable', 'string', 'max:20', Rule::unique(User::class)->ignore($userId)],
            'documento_tipo' => ['nullable', 'string', 'max:50'],
            'documento_valor' => ['nullable', 'string', 'max:50', Rule::unique(User::class)->ignore($userId)],
        ];
    }
}
</file>

<file path="src/Crm/Http/Requests/UpdateVehiculoRequest.php">
<?php

namespace FlipperBox\Crm\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\Rule;

class UpdateVehiculoRequest extends FormRequest
{
    public function authorize(): bool
    {
        return Auth::user()->can('editar vehiculos');
    }

    public function rules(): array
    {
        // Obtenemos el ID del vehículo que se está editando desde la ruta
        $vehiculoId = $this->route('vehiculo')->id;

        return [
            'patente' => ['required', 'string', 'max:255', Rule::unique('vehiculos', 'patente')->ignore($vehiculoId)],
            'marca' => ['required', 'string', 'max:255'],
            'modelo' => ['required', 'string', 'max:255'],
            'anio' => ['required', 'integer', 'min:1950', 'max:'.date('Y')],
            'kilometraje' => ['nullable', 'integer', 'min:0'],
            'vin' => ['nullable', 'string', 'max:255', Rule::unique('vehiculos', 'vin')->ignore($vehiculoId)],
            'numero_motor' => ['nullable', 'string', 'max:255'],
            'observaciones' => ['nullable', 'string'],
        ];
    }
}
</file>

<file path="src/Inventory/Actions/ActualizarProductoAction.php">
<?php
namespace FlipperBox\Inventory\Actions;

use FlipperBox\Inventory\Models\Product;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;

class ActualizarProductoAction
{
    public function execute(Product $product, array $data): Product
    {
        return DB::transaction(function () use ($product, $data) {
            // 1. Actualizar los datos principales del producto.
            // El evento 'saving' en el modelo se encargará de recalcular el 'price'.
            $product->update($data);

            // 2. Actualizar el costo en la tabla pivot para el proveedor seleccionado.
            // updateExistingPivot asume que la relación ya existe.
            $product->suppliers()->updateExistingPivot($data['supplier_id'], [
                'cost' => $data['cost'],
            ]);
            
            Log::info("Producto actualizado: ID {$product->id} - {$product->name}");

            return $product;
        });
    }
}
</file>

<file path="src/Inventory/Http/Requests/StoreSupplierRequest.php">
<?php
namespace FlipperBox\Inventory\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;

class StoreSupplierRequest extends FormRequest
{
    public function authorize(): bool
    {
        return Auth::user()->can('gestionar proveedores');
    }

    public function rules(): array
    {
        return [
            'name' => ['required', 'string', 'max:255', 'unique:suppliers,name'],
            'contact_person' => ['nullable', 'string', 'max:255'],
            'phone' => ['nullable', 'string', 'max:255'],
            'email' => ['nullable', 'email', 'max:255', 'unique:suppliers,email'],
            'address' => ['nullable', 'string'],
        ];
    }
}
</file>

<file path="src/Inventory/Http/Requests/UpdateProductRequest.php">
<?php

namespace FlipperBox\Inventory\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\Rule;

class UpdateProductRequest extends FormRequest
{
    public function authorize(): bool
    {
        return Auth::user()->can('gestionar inventario');
    }

    public function rules(): array
    {
        $productId = $this->route('product')->id;

        return [
            'name' => ['required', 'string', 'max:255'],
            'sku' => ['required', 'string', 'max:255', Rule::unique('products', 'sku')->ignore($productId)],
            'description' => ['nullable', 'string'],
            'cost' => ['required', 'numeric', 'min:0'],
            'iva_percentage' => ['required', 'numeric', 'min:0'],
            'profit_margin' => ['required', 'numeric', 'min:0'],
            'current_stock' => ['required', 'integer', 'min:0'],
            'min_threshold' => ['required', 'integer', 'min:0'],
            'supplier_id' => ['required', 'exists:suppliers,id'],
        ];
    }
}
</file>

<file path="src/Inventory/Http/Requests/UpdateSupplierRequest.php">
<?php
namespace FlipperBox\Inventory\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\Rule;

class UpdateSupplierRequest extends FormRequest
{
    public function authorize(): bool
    {
        return Auth::user()->can('gestionar proveedores');
    }

    public function rules(): array
    {
        $supplierId = $this->route('supplier')->id;

        return [
            'name' => ['required', 'string', 'max:255', Rule::unique('suppliers', 'name')->ignore($supplierId)],
            'contact_person' => ['nullable', 'string', 'max:255'],
            'phone' => ['nullable', 'string', 'max:255'],
            'email' => ['nullable', 'email', 'max:255', Rule::unique('suppliers', 'email')->ignore($supplierId)],
            'address' => ['nullable', 'string'],
        ];
    }
}
</file>

<file path="src/Inventory/Models/InventoryMovement.php">
<?php
namespace FlipperBox\Inventory\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use App\Models\User;

class InventoryMovement extends Model
{
    use HasFactory;
    protected $fillable = ['product_id', 'user_id', 'type', 'quantity', 'reason'];

    public function product(): BelongsTo
    {
        return $this->belongsTo(Product::class);
    }

    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }
}
</file>

<file path="src/Inventory/Models/Supplier.php">
<?php
namespace FlipperBox\Inventory\Models;

use Database\Factories\SupplierFactory;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;
use Illuminate\Database\Eloquent\SoftDeletes;

class Supplier extends Model
{
    use HasFactory, SoftDeletes;
    protected $fillable = ['name', 'contact_person', 'phone', 'email', 'address'];

    public function products(): BelongsToMany
    {
        return $this->belongsToMany(Product::class)
                    ->withPivot('cost')
                    ->withTimestamps();
    }

    protected static function newFactory()
    {
        return SupplierFactory::new();
    }
}
</file>

<file path="src/Inventory/Providers/InventoryServiceProvider.php">
<?php
namespace FlipperBox\Inventory\Providers;

use Illuminate\Support\Facades\Route;
use Illuminate\Support\ServiceProvider;

class InventoryServiceProvider extends ServiceProvider
{
    public function boot(): void
    {
        Route::middleware(['web', 'auth'])
            ->group(function () {
                $this->loadRoutesFrom(__DIR__.'/../routes/web.php');
            });
    }
}
</file>

<file path="src/MechanicPanel/Http/Controllers/DashboardController.php">
<?php

namespace FlipperBox\MechanicPanel\Http\Controllers;

use App\Http\Controllers\Controller;
use Inertia\Inertia;
use Inertia\Response;

class DashboardController extends Controller
{
    public function index(): Response
    {
        return Inertia::render('MechanicPanel/Dashboard');
    }
}
</file>

<file path="src/MechanicPanel/Providers/MechanicPanelServiceProvider.php">
<?php

namespace FlipperBox\MechanicPanel\Providers;

use Illuminate\Support\Facades\Route;
use Illuminate\Support\ServiceProvider;

class MechanicPanelServiceProvider extends ServiceProvider
{
    /**
     * Register services.
     */
    public function register(): void
    {
        //
    }

    /**
     * Bootstrap services.
     */
    public function boot(): void
    {
        Route::middleware(['web', 'auth'])
            ->prefix('mecanico')
            ->name('mecanico.')
            ->group(function () {
                $this->loadRoutesFrom(__DIR__ . '/../routes/web.php');
            });
    }
}
</file>

<file path="src/MechanicPanel/routes/web.php">
<?php

use FlipperBox\MechanicPanel\Http\Controllers\DashboardController;
use Illuminate\Support\Facades\Route;

Route::get('/dashboard', [DashboardController::class, 'index'])->name('dashboard');
</file>

<file path="src/Scheduling/Models/DailyCapacity.php">
<?php

namespace FlipperBox\Scheduling\Models;

use Illuminate\Database\Eloquent\Model;

class DailyCapacity extends Model
{
    protected $fillable = ['date', 'total_slots', 'booked_slots'];
    protected $casts = ['date' => 'date'];
}
</file>

<file path="src/Scheduling/Models/Reservation.php">
<?php

namespace FlipperBox\Scheduling\Models;

use App\Models\User;
use FlipperBox\Crm\Models\Vehiculo;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class Reservation extends Model
{
    protected $fillable = ['user_id', 'vehicle_id', 'reservation_date', 'status', 'notes'];
    protected $casts = ['reservation_date' => 'date'];

    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }

    public function vehicle(): BelongsTo
    {
        return $this->belongsTo(Vehiculo::class);
    }
}
</file>

<file path="src/Scheduling/Providers/SchedulingServiceProvider.php">
<?php
namespace FlipperBox\Scheduling\Providers;

use Illuminate\Support\Facades\Route;
use Illuminate\Support\ServiceProvider;

class SchedulingServiceProvider extends ServiceProvider
{
    public function boot(): void
    {
        Route::middleware(['web', 'auth'])
            ->group(function () {
                Route::middleware('can:gestionar cupos')
                     ->prefix('admin/scheduling')
                     ->name('admin.scheduling.')
                     ->group(function () {
                         $this->loadRoutesFrom(__DIR__.'/../routes/admin.php');
                     });
            });
    }
}
</file>

<file path="src/Scheduling/routes/admin.php">
<?php

use FlipperBox\Scheduling\Http\Controllers\CapacityController;
use Illuminate\Support\Facades\Route;

Route::get('/capacidades', [CapacityController::class, 'index'])->name('capacities.index');
Route::post('/capacidades', [CapacityController::class, 'store'])->name('capacities.store');
</file>

<file path="src/WorkManagement/Providers/WorkManagementServiceProvider.php">
<?php

namespace FlipperBox\WorkManagement\Providers;

use Illuminate\Support\Facades\Route;
use Illuminate\Support\ServiceProvider;

class WorkManagementServiceProvider extends ServiceProvider
{
    public function boot(): void
    {
        Route::middleware(['web', 'auth'])
            ->group(function () {
                $this->loadRoutesFrom(__DIR__.'/../routes/web.php');
            });
    }
}
</file>

<file path="storage/app/.gitignore">
*
!private/
!public/
!.gitignore
</file>

<file path="storage/app/private/.gitignore">
*
!.gitignore
</file>

<file path="storage/app/public/.gitignore">
*
!.gitignore
</file>

<file path="storage/framework/.gitignore">
compiled.php
config.php
down
events.scanned.php
maintenance.php
routes.php
routes.scanned.php
schedule-*
services.json
</file>

<file path="storage/framework/cache/.gitignore">
*
!data/
!.gitignore
</file>

<file path="storage/framework/cache/data/.gitignore">
*
!.gitignore
</file>

<file path="storage/framework/sessions/.gitignore">
*
!.gitignore
</file>

<file path="storage/framework/testing/.gitignore">
*
!.gitignore
</file>

<file path="storage/framework/views/.gitignore">
*
!.gitignore
</file>

<file path="storage/logs/.gitignore">
*
!.gitignore
</file>

<file path="tailwind.config.js">
import defaultTheme from 'tailwindcss/defaultTheme';
import forms from '@tailwindcss/forms';

/** @type {import('tailwindcss').Config} */
export default {
    content: [
        './vendor/laravel/framework/src/Illuminate/Pagination/resources/views/*.blade.php',
        './storage/framework/views/*.php',
        './resources/views/**/*.blade.php',
        './resources/js/**/*.vue',
    ],

    theme: {
        extend: {
            fontFamily: {
                sans: ['Figtree', ...defaultTheme.fontFamily.sans],
            },
        },
    },

    plugins: [forms],
};
</file>

<file path="tests/Feature/Auth/AuthenticationTest.php">
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class AuthenticationTest extends TestCase
{
    use RefreshDatabase;

    public function test_login_screen_can_be_rendered(): void
    {
        $response = $this->get('/login');

        $response->assertStatus(200);
    }

    public function test_users_can_authenticate_using_the_login_screen(): void
    {
        $user = User::factory()->create();

        $response = $this->post('/login', [
            'email' => $user->email,
            'password' => 'password',
        ]);

        $this->assertAuthenticated();
        $response->assertRedirect(route('dashboard', absolute: false));
    }

    public function test_users_can_not_authenticate_with_invalid_password(): void
    {
        $user = User::factory()->create();

        $this->post('/login', [
            'email' => $user->email,
            'password' => 'wrong-password',
        ]);

        $this->assertGuest();
    }

    public function test_users_can_logout(): void
    {
        $user = User::factory()->create();

        $response = $this->actingAs($user)->post('/logout');

        $this->assertGuest();
        $response->assertRedirect('/');
    }
}
</file>

<file path="tests/Feature/Auth/EmailVerificationTest.php">
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Auth\Events\Verified;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Facades\Event;
use Illuminate\Support\Facades\URL;
use Tests\TestCase;

class EmailVerificationTest extends TestCase
{
    use RefreshDatabase;

    public function test_email_verification_screen_can_be_rendered(): void
    {
        $user = User::factory()->unverified()->create();

        $response = $this->actingAs($user)->get('/verify-email');

        $response->assertStatus(200);
    }

    public function test_email_can_be_verified(): void
    {
        $user = User::factory()->unverified()->create();

        Event::fake();

        $verificationUrl = URL::temporarySignedRoute(
            'verification.verify',
            now()->addMinutes(60),
            ['id' => $user->id, 'hash' => sha1($user->email)]
        );

        $response = $this->actingAs($user)->get($verificationUrl);

        Event::assertDispatched(Verified::class);
        $this->assertTrue($user->fresh()->hasVerifiedEmail());
        $response->assertRedirect(route('dashboard', absolute: false).'?verified=1');
    }

    public function test_email_is_not_verified_with_invalid_hash(): void
    {
        $user = User::factory()->unverified()->create();

        $verificationUrl = URL::temporarySignedRoute(
            'verification.verify',
            now()->addMinutes(60),
            ['id' => $user->id, 'hash' => sha1('wrong-email')]
        );

        $this->actingAs($user)->get($verificationUrl);

        $this->assertFalse($user->fresh()->hasVerifiedEmail());
    }
}
</file>

<file path="tests/Feature/Auth/PasswordConfirmationTest.php">
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class PasswordConfirmationTest extends TestCase
{
    use RefreshDatabase;

    public function test_confirm_password_screen_can_be_rendered(): void
    {
        $user = User::factory()->create();

        $response = $this->actingAs($user)->get('/confirm-password');

        $response->assertStatus(200);
    }

    public function test_password_can_be_confirmed(): void
    {
        $user = User::factory()->create();

        $response = $this->actingAs($user)->post('/confirm-password', [
            'password' => 'password',
        ]);

        $response->assertRedirect();
        $response->assertSessionHasNoErrors();
    }

    public function test_password_is_not_confirmed_with_invalid_password(): void
    {
        $user = User::factory()->create();

        $response = $this->actingAs($user)->post('/confirm-password', [
            'password' => 'wrong-password',
        ]);

        $response->assertSessionHasErrors();
    }
}
</file>

<file path="tests/Feature/Auth/PasswordResetTest.php">
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Auth\Notifications\ResetPassword;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Facades\Notification;
use Tests\TestCase;

class PasswordResetTest extends TestCase
{
    use RefreshDatabase;

    public function test_reset_password_link_screen_can_be_rendered(): void
    {
        $response = $this->get('/forgot-password');

        $response->assertStatus(200);
    }

    public function test_reset_password_link_can_be_requested(): void
    {
        Notification::fake();

        $user = User::factory()->create();

        $this->post('/forgot-password', ['email' => $user->email]);

        Notification::assertSentTo($user, ResetPassword::class);
    }

    public function test_reset_password_screen_can_be_rendered(): void
    {
        Notification::fake();

        $user = User::factory()->create();

        $this->post('/forgot-password', ['email' => $user->email]);

        Notification::assertSentTo($user, ResetPassword::class, function ($notification) {
            $response = $this->get('/reset-password/'.$notification->token);

            $response->assertStatus(200);

            return true;
        });
    }

    public function test_password_can_be_reset_with_valid_token(): void
    {
        Notification::fake();

        $user = User::factory()->create();

        $this->post('/forgot-password', ['email' => $user->email]);

        Notification::assertSentTo($user, ResetPassword::class, function ($notification) use ($user) {
            $response = $this->post('/reset-password', [
                'token' => $notification->token,
                'email' => $user->email,
                'password' => 'password',
                'password_confirmation' => 'password',
            ]);

            $response
                ->assertSessionHasNoErrors()
                ->assertRedirect(route('login'));

            return true;
        });
    }
}
</file>

<file path="tests/Feature/Auth/PasswordUpdateTest.php">
<?php

namespace Tests\Feature\Auth;

use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Facades\Hash;
use Tests\TestCase;

class PasswordUpdateTest extends TestCase
{
    use RefreshDatabase;

    public function test_password_can_be_updated(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->from('/profile')
            ->put('/password', [
                'current_password' => 'password',
                'password' => 'new-password',
                'password_confirmation' => 'new-password',
            ]);

        $response
            ->assertSessionHasNoErrors()
            ->assertRedirect('/profile');

        $this->assertTrue(Hash::check('new-password', $user->refresh()->password));
    }

    public function test_correct_password_must_be_provided_to_update_password(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->from('/profile')
            ->put('/password', [
                'current_password' => 'wrong-password',
                'password' => 'new-password',
                'password_confirmation' => 'new-password',
            ]);

        $response
            ->assertSessionHasErrors('current_password')
            ->assertRedirect('/profile');
    }
}
</file>

<file path="tests/Feature/Auth/RegistrationTest.php">
<?php

namespace Tests\Feature\Auth;

use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class RegistrationTest extends TestCase
{
    use RefreshDatabase;

    public function test_registration_screen_can_be_rendered(): void
    {
        $response = $this->get('/register');

        $response->assertStatus(200);
    }

    public function test_new_users_can_register(): void
    {
        $response = $this->post('/register', [
            'name' => 'Test User',
            'email' => 'test@example.com',
            'password' => 'password',
            'password_confirmation' => 'password',
        ]);

        $this->assertAuthenticated();
        $response->assertRedirect(route('dashboard', absolute: false));
    }
}
</file>

<file path="tests/Feature/ExampleTest.php">
<?php

namespace Tests\Feature;

// use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     */
    public function test_the_application_returns_a_successful_response(): void
    {
        $response = $this->get('/');

        $response->assertStatus(200);
    }
}
</file>

<file path="tests/Feature/ProfileTest.php">
<?php

namespace Tests\Feature;

use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;

class ProfileTest extends TestCase
{
    use RefreshDatabase;

    public function test_profile_page_is_displayed(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->get('/profile');

        $response->assertOk();
    }

    public function test_profile_information_can_be_updated(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->patch('/profile', [
                'name' => 'Test User',
                'email' => 'test@example.com',
            ]);

        $response
            ->assertSessionHasNoErrors()
            ->assertRedirect('/profile');

        $user->refresh();

        $this->assertSame('Test User', $user->name);
        $this->assertSame('test@example.com', $user->email);
        $this->assertNull($user->email_verified_at);
    }

    public function test_email_verification_status_is_unchanged_when_the_email_address_is_unchanged(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->patch('/profile', [
                'name' => 'Test User',
                'email' => $user->email,
            ]);

        $response
            ->assertSessionHasNoErrors()
            ->assertRedirect('/profile');

        $this->assertNotNull($user->refresh()->email_verified_at);
    }

    public function test_user_can_delete_their_account(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->delete('/profile', [
                'password' => 'password',
            ]);

        $response
            ->assertSessionHasNoErrors()
            ->assertRedirect('/');

        $this->assertGuest();
        $this->assertNull($user->fresh());
    }

    public function test_correct_password_must_be_provided_to_delete_account(): void
    {
        $user = User::factory()->create();

        $response = $this
            ->actingAs($user)
            ->from('/profile')
            ->delete('/profile', [
                'password' => 'wrong-password',
            ]);

        $response
            ->assertSessionHasErrors('password')
            ->assertRedirect('/profile');

        $this->assertNotNull($user->fresh());
    }
}
</file>

<file path="tests/TestCase.php">
<?php

namespace Tests;

use Illuminate\Foundation\Testing\TestCase as BaseTestCase;

abstract class TestCase extends BaseTestCase
{
    //
}
</file>

<file path="tests/Unit/ExampleTest.php">
<?php

namespace Tests\Unit;

use PHPUnit\Framework\TestCase;

class ExampleTest extends TestCase
{
    /**
     * A basic test example.
     */
    public function test_that_true_is_true(): void
    {
        $this->assertTrue(true);
    }
}
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite';
import laravel from 'laravel-vite-plugin';
import vue from '@vitejs/plugin-vue';

export default defineConfig({
    plugins: [
        laravel({
            input: 'resources/js/app.js',
            refresh: true,
        }),
        vue({
            template: {
                transformAssetUrls: {
                    base: null,
                    includeAbsolute: false,
                },
            },
        }),
    ],
});
</file>

<file path="app/Http/Controllers/Controller.php">
<?php

namespace App\Http\Controllers;

use Illuminate\Foundation\Auth\Access\AuthorizesRequests;
use Illuminate\Foundation\Validation\ValidatesRequests;
use Illuminate\Routing\Controller as BaseController;

class Controller extends BaseController
{
    use AuthorizesRequests, ValidatesRequests;
}
</file>

<file path="app/Policies/VehiculoPolicy.php">
<?php

namespace App\Policies;

use App\Models\User;
use FlipperBox\Crm\Models\Vehiculo;

class VehiculoPolicy
{
    /**
     * Realiza una verificación "antes" de cualquier otro método.
     * Si el usuario es un Admin, se le concede acceso total inmediatamente.
     */
    public function before(User $user, string $ability): bool|null
    {
        if ($user->hasRole('Admin')) {
            return true;
        }
        return null; // Dejar que las otras reglas decidan
    }

    /**
     * Determina si el usuario puede ver la lista de sus vehículos.
     */
    public function viewAny(User $user): bool
    {
        // Verificamos el permiso explícito que creamos para el rol 'Cliente'.
        return $user->can('ver mis vehiculos');
    }

    /**
     * Determina si el usuario puede ver un vehículo específico.
     */
    public function view(User $user, Vehiculo $vehiculo): bool
    {
        // Un usuario puede ver un vehículo si es SU vehículo.
        return $user->id === $vehiculo->user_id;
    }

    /**
     * Determina si el usuario puede crear vehículos.
     */
    public function create(User $user): bool
    {
        // Cualquier usuario con permiso para ver la lista, puede crear.
        return $user->can('ver mis vehiculos');
    }

    /**
     * Determina si el usuario puede actualizar un vehículo.
     */
    public function update(User $user, Vehiculo $vehiculo): bool
    {
        // Un usuario puede actualizar un vehículo si es SU vehículo.
        return $user->id === $vehiculo->user_id;
    }

    /**
     * Determina si el usuario puede eliminar un vehículo.
     */
    public function delete(User $user, Vehiculo $vehiculo): bool
    {
        // Un usuario puede eliminar un vehículo si es SU vehículo.
        return $user->id === $vehiculo->user_id;
    }
}
</file>

<file path="app/Providers/AppServiceProvider.php">
<?php

namespace App\Providers;

use App\Models\User;
use App\Observers\ProductObserver;
use App\Observers\UserObserver;
use App\Observers\VehiculoObserver;
use App\Observers\WorkOrderObserver;
use FlipperBox\Inventory\Models\Product; 
use FlipperBox\Crm\Models\Vehiculo;
use FlipperBox\WorkManagement\Models\WorkOrder;
use Illuminate\Support\Facades\Vite;
use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Register any application services.
     */
    public function register(): void
    {
        //
    }

    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        Vite::prefetch(concurrency: 3);

        Product::observe(ProductObserver::class);
        User::observe(UserObserver::class);
        Vehiculo::observe(VehiculoObserver::class);
        WorkOrder::observe(WorkOrderObserver::class);
    }
}
</file>

<file path="database/factories/ProductFactory.php">
<?php

namespace Database\Factories;

use FlipperBox\Inventory\Models\Product;
use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Str;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\FlipperBox\Inventory\Models\Product>
 */
class ProductFactory extends Factory
{
    /**
     * The name of the factory's corresponding model.
     *
     * @var string
     */
    protected $model = Product::class;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        $productName = 'Filtro de ' . fake()->randomElement(['Aceite', 'Aire', 'Combustible']) . ' ' . fake()->word();
        
        $cost = fake()->randomFloat(2, 5, 300);
        $ivaPercentage = 21.00;
        $profitMargin = fake()->randomElement([30, 40, 50]);
        
        // Calcular el precio: (Costo + IVA) × (1 + Margen%)
        $costWithIva = $cost * (1 + ($ivaPercentage / 100));
        $price = $costWithIva * (1 + ($profitMargin / 100));

        return [
            'name' => $productName,
            'sku' => 'SKU-' . strtoupper(Str::random(8)),
            'description' => fake()->sentence(10),
            'cost' => $cost,
            'iva_percentage' => $ivaPercentage,
            'profit_margin' => $profitMargin,
            'price' => round($price, 2),
            'current_stock' => fake()->numberBetween(0, 100),
            'min_threshold' => fake()->numberBetween(5, 20),
        ];
    }
}
</file>

<file path="database/factories/UserFactory.php">
<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Str;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\User>
 */
class UserFactory extends Factory
{
    /**
     * The current password being used by the factory.
     */
    protected static ?string $password;

    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        return [
            'name' => fake()->firstName(),
            'apellido' => fake()->lastName(),
            'email' => fake()->unique()->safeEmail(),
            'telefono' => fake()->unique()->e164PhoneNumber(),
            'email_verified_at' => now(),
            'password' => static::$password ??= Hash::make('password'),
            'remember_token' => Str::random(10),
        ];
    }

    /**
     * Indicate that the model's email address should be unverified.
     */
    public function unverified(): static
    {
        return $this->state(fn(array $attributes) => [
            'email_verified_at' => null,
        ]);
    }
}
</file>

<file path="database/migrations/0001_01_01_000000_create_users_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('apellido')->nullable();
            $table->string('email')->unique();
            $table->string('telefono')->nullable()->unique();
            $table->string('documento_tipo')->nullable();
            $table->string('documento_valor')->nullable()->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->rememberToken();
            $table->timestamps();
        });

        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });

        Schema::create('sessions', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->foreignId('user_id')->nullable()->index();
            $table->string('ip_address', 45)->nullable();
            $table->text('user_agent')->nullable();
            $table->longText('payload');
            $table->integer('last_activity')->index();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('users');
        Schema::dropIfExists('password_reset_tokens');
        Schema::dropIfExists('sessions');
    }
};
</file>

<file path="database/migrations/2025_11_04_010930_create_vehiculos_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('vehiculos', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained('users')->onDelete('cascade');
            $table->string('patente')->unique();
            $table->string('marca');
            $table->string('modelo');
            $table->year('anio');
            $table->unsignedInteger('kilometraje')->nullable();
            $table->string('vin')->nullable()->unique()->comment('Número de chasis');
            $table->string('numero_motor')->nullable();
            $table->text('observaciones')->nullable()->comment('Notas del mecánico sobre el vehículo');
            $table->softDeletes();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('vehiculos');
    }
};
</file>

<file path="database/migrations/2025_11_04_193251_create_products_table.php">
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('products', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('sku')->unique()->comment('Stock Keeping Unit');
            $table->text('description')->nullable();
            $table->decimal('cost', 10, 2)->comment('Precio de compra');
            $table->decimal('iva_percentage', 5, 2)->default(21.00)->comment('Porcentaje de IVA');
            $table->decimal('profit_margin', 5, 2)->default(40.00)->comment('Margen de ganancia');
            $table->decimal('price', 10, 2)->comment('Precio de venta (calculado)');
            $table->integer('current_stock')->default(0);
            $table->integer('min_threshold')->default(5)->comment('Umbral de stock bajo');
            $table->timestamps();
            $table->softDeletes();
            $table->index('name');
            $table->index('sku');
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('products');
    }
};
</file>

<file path="database/seeders/DatabaseSeeder.php">
<?php

namespace Database\Seeders;

use App\Models\User;
use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    use WithoutModelEvents;

    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        $this->call(DemoSeeder::class);
    }
}
</file>

<file path="resources/js/Components/ApplicationLogo.vue">
<template>
    <img src="/images/logo-light.png" alt="FlipperBox Logo" />
</template>
</file>

<file path="resources/js/Components/ConfirmationModal.vue">
<script setup>
import Modal from './Modal.vue';

const emit = defineEmits(['close', 'confirm']);

defineProps({
    show: { type: Boolean, default: false },
    title: { type: String, default: 'Confirmar Acción' },
    message: { type: String, default: '¿Estás seguro de que deseas realizar esta acción?' },
    
    // --- NUEVAS PROPS PARA FLEXIBILIDAD ---
    confirmButtonText: { type: String, default: 'Confirmar' },
    confirmButtonClass: { type: String, default: 'bg-red-600 hover:bg-red-700' }, // Color por defecto (peligro)
});

const closeModal = () => emit('close');
const confirmAction = () => emit('confirm');
</script>

<template>
    <Modal :show="show" @close="closeModal">
        <div class="p-6">
            <h2 class="text-lg font-medium text-gray-900">
                {{ title }}
            </h2>

            <p class="mt-1 text-sm text-gray-600">
                {{ message }}
            </p>

            <div class="mt-6 flex justify-end">
                <button @click="closeModal" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none">
                    Cancelar
                </button>

                <!-- AHORA EL BOTÓN ES DINÁMICO -->
                <button 
                    @click="confirmAction" 
                    class="ml-3 px-4 py-2 text-sm font-medium text-white border border-transparent rounded-md shadow-sm focus:outline-none"
                    :class="confirmButtonClass"
                >
                    {{ confirmButtonText }}
                </button>
            </div>
        </div>
    </Modal>
</template>
</file>

<file path="resources/js/Components/FlashMessage.vue">
<script setup>
import { computed, ref } from 'vue';
import { usePage, router } from '@inertiajs/vue3';
import { onMounted, onUnmounted } from 'vue';

const page = usePage();
const show = ref(false);
const style = ref('success');
const message = ref('');
let removeFinishEventListener = null;

// Esta función se llamará cada vez que Inertia termine una visita a una página
const handleFlashMessage = () => {
    const flash = page.props.flash;
    if (flash && (flash.success || flash.error)) {
        style.value = flash.success ? 'success' : 'danger';
        message.value = flash.success || flash.error;
        show.value = true;

        // Ocultar el mensaje automáticamente después de 5 segundos
        setTimeout(() => {
            show.value = false;
            // Limpiamos el flash prop para la siguiente navegación
            page.props.flash = {}; 
        }, 5000);
    }
};

// Nos enganchamos a los eventos de Inertia
onMounted(() => {
    handleFlashMessage(); // Verificar si hay un mensaje en la carga inicial
    removeFinishEventListener = router.on('finish', handleFlashMessage);
});

onUnmounted(() => {
    if (removeFinishEventListener) {
        removeFinishEventListener();
    }
});

// Estilos para los diferentes tipos de notificación
const styles = {
    success: 'bg-green-100 border-green-500 text-green-700',
    danger: 'bg-red-100 border-red-500 text-red-700',
};
</script>

<template>
    <div>
        <transition
            enter-active-class="ease-out duration-300"
            enter-from-class="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
            enter-to-class="opacity-100 translate-y-0 sm:scale-100"
            leave-active-class="ease-in duration-200"
            leave-from-class="opacity-100 translate-y-0 sm:scale-100"
            leave-to-class="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
        >
            <div v-if="show && message" :class="styles[style]" class="border-l-4 p-4 mx-8 mt-4" role="alert">
                <div class="flex">
                    <div class="py-1">
                        <svg v-if="style === 'success'" class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <svg v-if="style === 'danger'" class="w-6 h-6 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <div>
                        <p class="font-bold">{{ style === 'success' ? 'Éxito' : 'Error' }}</p>
                        <p>{{ message }}</p>
                    </div>
                    <div class="ml-auto">
                        <button @click.prevent="show = false" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                        </button>
                    </div>
                </div>
            </div>
        </transition>
    </div>
</template>
</file>

<file path="resources/js/Pages/Crm/Clientes/Create.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';

const form = useForm({
    name: '',
    apellido: '',
    telefono: '',
    email: '',
    documento_tipo: 'DNI',
    documento_valor: '',
});

const submit = () => {
    form.post(route('clientes.store'));
};
</script>

<template>
    <Head title="Crear Cliente" />

    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Crear Nuevo Cliente</h2>
                <Link :href="route('clientes.index')" class="text-sm text-gray-700 underline">&larr; Volver al listado</Link>
            </div>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <form @submit.prevent="submit">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Campo Nombre -->
                                <div>
                                    <label for="name" class="block font-medium text-sm text-gray-700">Nombre</label>
                                    <input id="name" type="text" v-model="form.name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required autofocus />
                                    <div v-if="form.errors.name" class="text-sm text-red-600 mt-1">{{ form.errors.name }}</div>
                                </div>

                                <!-- Campo Apellido -->
                                <div>
                                    <label for="apellido" class="block font-medium text-sm text-gray-700">Apellido</label>
                                    <input id="apellido" type="text" v-model="form.apellido" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.apellido" class="text-sm text-red-600 mt-1">{{ form.errors.apellido }}</div>
                                </div>

                                <!-- Campo Teléfono -->
                                <div>
                                    <label for="telefono" class="block font-medium text-sm text-gray-700">Teléfono</label>
                                    <input id="telefono" type="text" v-model="form.telefono" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.telefono" class="text-sm text-red-600 mt-1">{{ form.errors.telefono }}</div>
                                </div>
                                
                                <!-- Campo Email -->
                                <div>
                                    <label for="email" class="block font-medium text-sm text-gray-700">Email</label>
                                    <input id="email" type="email" v-model="form.email" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.email" class="text-sm text-red-600 mt-1">{{ form.errors.email }}</div>
                                </div>

                                <!-- Campo Tipo de Documento -->
                                <div>
                                    <label for="documento_tipo" class="block font-medium text-sm text-gray-700">Tipo de Documento (Opcional)</label>
                                    <select id="documento_tipo" v-model="form.documento_tipo" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                        <option>DNI</option>
                                        <option>Pasaporte</option>
                                        <option>Otro</option>
                                    </select>
                                </div>

                                <!-- Campo Número de Documento -->
                                <div>
                                    <label for="documento_valor" class="block font-medium text-sm text-gray-700">Número de Documento (Opcional)</label>
                                    <input id="documento_valor" type="text" v-model="form.documento_valor" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
                                    <div v-if="form.errors.documento_valor" class="text-sm text-red-600 mt-1">{{ form.errors.documento_valor }}</div>
                                </div>
                            </div>

                            <!-- Botón de Envío -->
                            <div class="flex items-center justify-end mt-6">
                                <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700" :disabled="form.processing">
                                    Guardar Cliente
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Crm/Clientes/Edit.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';

const props = defineProps({
    cliente: {
        type: Object,
        required: true,
    },
});

const form = useForm({
    name: props.cliente.name,
    apellido: props.cliente.apellido,
    telefono: props.cliente.telefono,
    email: props.cliente.email,
    documento_tipo: props.cliente.documento_tipo,
    documento_valor: props.cliente.documento_valor,
});

const submit = () => {
    form.patch(route('clientes.update', { user: props.cliente.id }), {
        preserveScroll: true,
    });
};
</script>

<template>
    <Head :title="`Editar Cliente: ${cliente.name}`" />

    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Editar Cliente</h2>
                <Link :href="route('clientes.index')" class="text-sm text-gray-700 underline">
                    &larr; Volver al listado
                </Link>
            </div>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <form @submit.prevent="submit">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Campo Nombre -->
                                <div>
                                    <label for="name" class="block font-medium text-sm text-gray-700">Nombre</label>
                                    <input id="name" type="text" v-model="form.name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required autofocus />
                                    <div v-if="form.errors.name" class="text-sm text-red-600 mt-1">{{ form.errors.name }}</div>
                                </div>

                                <!-- Campo Apellido -->
                                <div>
                                    <label for="apellido" class="block font-medium text-sm text-gray-700">Apellido</label>
                                    <input id="apellido" type="text" v-model="form.apellido" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.apellido" class="text-sm text-red-600 mt-1">{{ form.errors.apellido }}</div>
                                </div>

                                <!-- Campo Teléfono -->
                                <div>
                                    <label for="telefono" class="block font-medium text-sm text-gray-700">Teléfono</label>
                                    <input id="telefono" type="text" v-model="form.telefono" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.telefono" class="text-sm text-red-600 mt-1">{{ form.errors.telefono }}</div>
                                </div>
                                
                                <!-- Campo Email -->
                                <div>
                                    <label for="email" class="block font-medium text-sm text-gray-700">Email</label>
                                    <input id="email" type="email" v-model="form.email" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.email" class="text-sm text-red-600 mt-1">{{ form.errors.email }}</div>
                                </div>

                                <!-- Campo Tipo de Documento -->
                                <div>
                                    <label for="documento_tipo" class="block font-medium text-sm text-gray-700">Tipo de Documento (Opcional)</label>
                                    <select id="documento_tipo" v-model="form.documento_tipo" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm">
                                        <option>DNI</option>
                                        <option>Pasaporte</option>
                                        <option>Otro</option>
                                    </select>
                                </div>

                                <!-- Campo Número de Documento -->
                                <div>
                                    <label for="documento_valor" class="block font-medium text-sm text-gray-700">Número de Documento (Opcional)</label>
                                    <input id="documento_valor" type="text" v-model="form.documento_valor" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
                                    <div v-if="form.errors.documento_valor" class="text-sm text-red-600 mt-1">{{ form.errors.documento_valor }}</div>
                                </div>
                            </div>

                            <!-- Botón de Envío -->
                            <div class="flex items-center justify-end mt-6">
                                <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700" :disabled="form.processing">
                                    Actualizar Cliente
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Crm/Vehiculos/Create.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';

const props = defineProps({
    cliente: {
        type: Object,
        required: true,
    },
});

const form = useForm({
    patente: '',
    marca: '',
    modelo: '',
    anio: new Date().getFullYear(),
    kilometraje: '',
    vin: '',
    numero_motor: '',
    observaciones: '',
});

const submit = () => {
    form.post(route('clientes.vehiculos.store', { user: props.cliente.id }));
};
</script>

<template>
    <Head title="Agregar Vehículo" />
    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                 <h2 class="font-semibold text-xl text-gray-800 leading-tight">
                    Agregar Vehículo a: <span class="font-bold">{{ cliente.name }} {{ cliente.apellido }}</span>
                </h2>
                <Link :href="route('clientes.show', { user: cliente.id })" class="text-sm text-gray-700 underline">
                    &larr; Volver al cliente
                </Link>
            </div>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <form @submit.prevent="submit">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Campo Patente -->
                                <div>
                                    <label for="patente" class="block font-medium text-sm text-gray-700">Patente</label>
                                    <input id="patente" type="text" v-model="form.patente" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required autofocus />
                                    <div v-if="form.errors.patente" class="text-sm text-red-600 mt-1">{{ form.errors.patente }}</div>
                                </div>

                                <!-- Campo Marca -->
                                <div>
                                    <label for="marca" class="block font-medium text-sm text-gray-700">Marca</label>
                                    <input id="marca" type="text" v-model="form.marca" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.marca" class="text-sm text-red-600 mt-1">{{ form.errors.marca }}</div>
                                </div>

                                <!-- Campo Modelo -->
                                <div>
                                    <label for="modelo" class="block font-medium text-sm text-gray-700">Modelo</label>
                                    <input id="modelo" type="text" v-model="form.modelo" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.modelo" class="text-sm text-red-600 mt-1">{{ form.errors.modelo }}</div>
                                </div>

                                <!-- Campo Año -->
                                <div>
                                    <label for="anio" class="block font-medium text-sm text-gray-700">Año</label>
                                    <input id="anio" type="number" v-model="form.anio" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.anio" class="text-sm text-red-600 mt-1">{{ form.errors.anio }}</div>
                                </div>

                                <!-- Campo Kilometraje -->
                                <div>
                                    <label for="kilometraje" class="block font-medium text-sm text-gray-700">Kilometraje (Opcional)</label>
                                    <input id="kilometraje" type="number" v-model="form.kilometraje" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
                                    <div v-if="form.errors.kilometraje" class="text-sm text-red-600 mt-1">{{ form.errors.kilometraje }}</div>
                                </div>

                                <!-- Campo VIN -->
                                <div>
                                    <label for="vin" class="block font-medium text-sm text-gray-700">N° de Chasis (VIN) (Opcional)</label>
                                    <input id="vin" type="text" v-model="form.vin" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
                                    <div v-if="form.errors.vin" class="text-sm text-red-600 mt-1">{{ form.errors.vin }}</div>
                                </div>

                                <!-- Campo Número de Motor -->
                                <div>
                                    <label for="numero_motor" class="block font-medium text-sm text-gray-700">Número de Motor (Opcional)</label>
                                    <input id="numero_motor" type="text" v-model="form.numero_motor" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
                                    <div v-if="form.errors.numero_motor" class="text-sm text-red-600 mt-1">{{ form.errors.numero_motor }}</div>
                                </div>

                                <!-- Campo Observaciones -->
                                <div class="md:col-span-2">
                                    <label for="observaciones" class="block font-medium text-sm text-gray-700">Observaciones (Opcional)</label>
                                    <textarea id="observaciones" v-model="form.observaciones" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                                    <div v-if="form.errors.observaciones" class="text-sm text-red-600 mt-1">{{ form.errors.observaciones }}</div>
                                </div>
                            </div>

                            <!-- Botón de Envío -->
                            <div class="flex items-center justify-end mt-6">
                                <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700" :disabled="form.processing">
                                    Guardar Vehículo
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Crm/Vehiculos/Edit.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';

const props = defineProps({
    cliente: {
        type: Object,
        required: true,
    },
    vehiculo: {
        type: Object,
        required: true,
    }
});

const form = useForm({
    patente: props.vehiculo.patente,
    marca: props.vehiculo.marca,
    modelo: props.vehiculo.modelo,
    anio: props.vehiculo.anio,
    kilometraje: props.vehiculo.kilometraje,
    vin: props.vehiculo.vin,
    numero_motor: props.vehiculo.numero_motor,
    observaciones: props.vehiculo.observaciones,
});

const submit = () => {
    form.patch(route('clientes.vehiculos.update', { user: props.cliente.id, vehiculo: props.vehiculo.id }), {
        preserveScroll: true,
    });
};
</script>

<template>
    <Head :title="`Editar Vehículo: ${vehiculo.patente}`" />

    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                 <h2 class="font-semibold text-xl text-gray-800 leading-tight">
                    Editar Vehículo: <span class="font-bold">{{ vehiculo.patente }}</span>
                </h2>
                <Link :href="route('clientes.show', { user: cliente.id })" class="text-sm text-gray-700 underline">
                    &larr; Volver al cliente
                </Link>
            </div>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <form @submit.prevent="submit">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Campo Patente -->
                                <div>
                                    <label for="patente" class="block font-medium text-sm text-gray-700">Patente</label>
                                    <input id="patente" type="text" v-model="form.patente" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required autofocus />
                                    <div v-if="form.errors.patente" class="text-sm text-red-600 mt-1">{{ form.errors.patente }}</div>
                                </div>

                                <!-- Campo Marca -->
                                <div>
                                    <label for="marca" class="block font-medium text-sm text-gray-700">Marca</label>
                                    <input id="marca" type="text" v-model="form.marca" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.marca" class="text-sm text-red-600 mt-1">{{ form.errors.marca }}</div>
                                </div>

                                <!-- Campo Modelo -->
                                <div>
                                    <label for="modelo" class="block font-medium text-sm text-gray-700">Modelo</label>
                                    <input id="modelo" type="text" v-model="form.modelo" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.modelo" class="text-sm text-red-600 mt-1">{{ form.errors.modelo }}</div>
                                </div>

                                <!-- Campo Año -->
                                <div>
                                    <label for="anio" class="block font-medium text-sm text-gray-700">Año</label>
                                    <input id="anio" type="number" v-model="form.anio" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required />
                                    <div v-if="form.errors.anio" class="text-sm text-red-600 mt-1">{{ form.errors.anio }}</div>
                                </div>

                                <!-- Campo Kilometraje -->
                                <div>
                                    <label for="kilometraje" class="block font-medium text-sm text-gray-700">Kilometraje (Opcional)</label>
                                    <input id="kilometraje" type="number" v-model="form.kilometraje" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
                                    <div v-if="form.errors.kilometraje" class="text-sm text-red-600 mt-1">{{ form.errors.kilometraje }}</div>
                                </div>

                                <!-- Campo VIN -->
                                <div>
                                    <label for="vin" class="block font-medium text-sm text-gray-700">N° de Chasis (VIN) (Opcional)</label>
                                    <input id="vin" type="text" v-model="form.vin" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
                                    <div v-if="form.errors.vin" class="text-sm text-red-600 mt-1">{{ form.errors.vin }}</div>
                                </div>

                                <!-- Campo Número de Motor -->
                                <div>
                                    <label for="numero_motor" class="block font-medium text-sm text-gray-700">Número de Motor (Opcional)</label>
                                    <input id="numero_motor" type="text" v-model="form.numero_motor" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" />
                                    <div v-if="form.errors.numero_motor" class="text-sm text-red-600 mt-1">{{ form.errors.numero_motor }}</div>
                                </div>

                                <!-- Campo Observaciones -->
                                <div class="md:col-span-2">
                                    <label for="observaciones" class="block font-medium text-sm text-gray-700">Observaciones (Opcional)</label>
                                    <textarea id="observaciones" v-model="form.observaciones" rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></textarea>
                                    <div v-if="form.errors.observaciones" class="text-sm text-red-600 mt-1">{{ form.errors.observaciones }}</div>
                                </div>
                            </div>

                            <!-- Botón de Envío -->
                            <div class="flex items-center justify-end mt-6">
                                <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700" :disabled="form.processing">
                                    Actualizar Vehículo
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Inventory/Products/Create.vue">
<!-- Archivo: resources/js/Pages/Inventory/Products/Create.vue (VERSIÓN FINAL SIMPLIFICADA) -->
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';
import { computed } from 'vue';

const props = defineProps({
    suppliers: {
        type: Array,
        required: true,
    },
});

const form = useForm({
    name: '',
    sku: '',
    description: '',
    cost: 0.00, // <-- ÚNICO CAMPO DE COSTO
    iva_percentage: 21,
    profit_margin: 40,
    current_stock: 0,
    min_threshold: 5,
    supplier_id: props.suppliers.length > 0 ? props.suppliers[0].id : null,
});

const calculatedPrice = computed(() => {
    const cost = parseFloat(form.cost) || 0;
    const ivaPercentage = parseFloat(form.iva_percentage) || 0;
    const profitMargin = parseFloat(form.profit_margin) || 0;
    const costWithIva = cost * (1 + (ivaPercentage / 100));
    const finalPrice = costWithIva * (1 + (profitMargin / 100));
    return finalPrice.toFixed(2);
});

const submit = () => {
    form.post(route('inventario.products.store'));
};
</script>

<template>
    <Head title="Crear Producto" />

    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Crear Nuevo Producto</h2>
                <Link :href="route('inventario.products.index')" class="text-sm text-gray-700 underline">
                    &larr; Volver al listado
                </Link>
            </div>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <form @submit.prevent="submit">
                            <!-- SECCIÓN 1: DATOS DEL PRODUCTO -->
                            <h3 class="text-lg font-medium text-gray-900 mb-4 border-b pb-2">Datos del Producto</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="md:col-span-2">
                                    <label for="name" class="block font-medium text-sm text-gray-700">Nombre del Producto</label>
                                    <input id="name" type="text" v-model="form.name" class="mt-1 block w-full" required autofocus />
                                    <div v-if="form.errors.name" class="text-sm text-red-600 mt-1">{{ form.errors.name }}</div>
                                </div>
                                <div>
                                    <label for="sku" class="block font-medium text-sm text-gray-700">SKU (Código Único)</label>
                                    <input id="sku" type="text" v-model="form.sku" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.sku" class="text-sm text-red-600 mt-1">{{ form.errors.sku }}</div>
                                </div>
                                <div>
                                    <label for="supplier_id" class="block font-medium text-sm text-gray-700">Proveedor</label>
                                    <select id="supplier_id" v-model="form.supplier_id" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required>
                                        <option v-for="supplier in suppliers" :key="supplier.id" :value="supplier.id">{{ supplier.name }}</option>
                                    </select>
                                    <div v-if="form.errors.supplier_id" class="text-sm text-red-600 mt-1">{{ form.errors.supplier_id }}</div>
                                </div>
                            </div>
                            <div class="mt-6">
                                <label for="description" class="block font-medium text-sm text-gray-700">Descripción (Opcional)</label>
                                <textarea id="description" v-model="form.description" rows="3" class="mt-1 block w-full"></textarea>
                            </div>

                            <!-- SECCIÓN 2: PRECIOS Y STOCK -->
                            <h3 class="text-lg font-medium text-gray-900 mt-8 mb-4 border-b pb-2">Precios y Stock</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <div>
                                    <label for="cost" class="block font-medium text-sm text-gray-700">Precio de Costo ($)</label>
                                    <input id="cost" type="number" step="0.01" v-model="form.cost" class="mt-1 block w-full" required />
                                    <div v-if="form.errors.cost" class="text-sm text-red-600 mt-1">{{ form.errors.cost }}</div>
                                </div>
                                <div>
                                    <label for="iva_percentage" class="block font-medium text-sm text-gray-700">IVA (%)</label>
                                    <input id="iva_percentage" type="number" v-model="form.iva_percentage" class="mt-1 block w-full" required />
                                </div>
                                <div>
                                    <label for="profit_margin" class="block font-medium text-sm text-gray-700">Margen de Ganancia (%)</label>
                                    <input id="profit_margin" type="number" v-model="form.profit_margin" class="mt-1 block w-full" required />
                                </div>
                                <div class="bg-gray-100 p-4 rounded-md flex items-center justify-center">
                                    <div>
                                        <label class="block font-medium text-sm text-gray-700">Precio de Venta Calculado</label>
                                        <p class="text-2xl font-bold text-gray-900 mt-1">${{ calculatedPrice }}</p>
                                    </div>
                                </div>
                                <div>
                                    <label for="current_stock" class="block font-medium text-sm text-gray-700">Stock Inicial</label>
                                    <input id="current_stock" type="number" v-model="form.current_stock" class="mt-1 block w-full" required />
                                </div>
                                <div>
                                    <label for="min_threshold" class="block font-medium text-sm text-gray-700">Umbral de Stock Bajo</label>
                                    <input id="min_threshold" type="number" v-model="form.min_threshold" class="mt-1 block w-full" required />
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-end mt-8">
                                <button type="submit" class="px-6 py-3 bg-gray-800 text-white rounded-md hover:bg-gray-700 font-semibold" :disabled="form.processing">
                                    Guardar Producto
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/Inventory/Suppliers/Index.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, Link, usePage, router } from '@inertiajs/vue3';
import Pagination from '@/Components/Pagination.vue';
import ConfirmationModal from '@/Components/ConfirmationModal.vue';
import { ref } from 'vue';

defineProps({
    suppliers: {
        type: Object,
        required: true,
    },
});

const can = (permission) => usePage().props.auth.user.permissions.includes(permission);

// Lógica para el Modal de Eliminación
const confirmingSupplierDeletion = ref(false);
const supplierToDelete = ref(null);

const confirmSupplierDeletion = (supplier) => {
    supplierToDelete.value = supplier;
    confirmingSupplierDeletion.value = true;
};

const deleteSupplier = () => {
    router.delete(route('inventario.suppliers.destroy', supplierToDelete.value.id), {
        onSuccess: () => closeModal(),
        preserveScroll: true,
    });
};

const closeModal = () => {
    confirmingSupplierDeletion.value = false;
    supplierToDelete.value = null;
};
</script>
<template>
    <Head title="Proveedores" />
    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Gestión de Proveedores</h2>
                <Link v-if="can('gestionar proveedores')" :href="route('inventario.suppliers.create')" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition">
                    Crear Nuevo Proveedor
                </Link>
            </div>
        </template>
        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Nombre</th>
                                        <th scope="col" class="px-6 py-3">Persona de Contacto</th>
                                        <th scope="col" class="px-6 py-3">Teléfono</th>
                                        <th scope="col" class="px-6 py-3 text-right">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="supplier in suppliers.data" :key="supplier.id" class="bg-white border-b hover:bg-gray-50">
                                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ supplier.name }}</th>
                                        <td class="px-6 py-4">{{ supplier.contact_person }}</td>
                                        <td class="px-6 py-4">{{ supplier.phone }}</td>
                                        <td class="px-6 py-4 text-right">
                                            <Link v-if="can('gestionar proveedores')" :href="route('inventario.suppliers.edit', supplier.id)" class="font-medium text-blue-600 hover:underline mr-4">Editar</Link>
                                            <button v-if="can('gestionar proveedores')" @click="confirmSupplierDeletion(supplier)" class="font-medium text-red-600 hover:underline">Eliminar</button>
                                        </td>
                                    </tr>
                                    <tr v-if="suppliers.data.length === 0">
                                        <td colspan="4" class="px-6 py-4 text-center text-gray-500">No se encontraron proveedores.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div v-if="suppliers.links.length > 3" class="p-6 border-t">
                        <Pagination :links="suppliers.links" />
                    </div>
                </div>
            </div>
        </div>

        <ConfirmationModal 
            :show="confirmingSupplierDeletion" 
            @close="closeModal"
            @confirm="deleteSupplier"
            title="Eliminar Proveedor"
            :message="`¿Estás seguro de que deseas eliminar al proveedor '${supplierToDelete?.name}'? Esta acción no se puede deshacer.`"
        />
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/WorkManagement/Create.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, useForm, Link } from '@inertiajs/vue3';

const props = defineProps({
    vehiculo: {
        type: Object,
        required: true,
    },
});

const form = useForm({
    vehicle_id: props.vehiculo.id,
    description: '',
});

const submit = () => {
    form.post(route('work-orders.store'));
};
</script>
<template>
    <Head title="Crear Orden de Trabajo" />
    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Nueva Orden de Trabajo</h2>
                <Link :href="route('clientes.show', { user: vehiculo.user_id })" class="text-sm text-gray-700 underline">
                    &larr; Volver al Cliente
                </Link>
            </div>
        </template>
        <div class="py-12">
            <div class="max-w-4xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6 bg-white border-b border-gray-200">
                        <div class="mb-6 p-4 border rounded-md">
                            <h3 class="font-bold text-lg">Vehículo Seleccionado</h3>
                            <p class="text-sm text-gray-600">Cliente: {{ vehiculo.cliente.name }} {{ vehiculo.cliente.apellido }}</p>
                            <p class="text-sm text-gray-600">Patente: {{ vehiculo.patente }}</p>
                            <p class="text-sm text-gray-600">Modelo: {{ vehiculo.marca }} {{ vehiculo.modelo }} ({{ vehiculo.anio }})</p>
                        </div>
                        <form @submit.prevent="submit">
                            <div>
                                <label for="description" class="block font-medium text-sm text-gray-700">Descripción del Problema o Servicio Solicitado</label>
                                <textarea id="description" v-model="form.description" rows="4" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm" required autofocus></textarea>
                                <div v-if="form.errors.description" class="text-sm text-red-600 mt-1">{{ form.errors.description }}</div>
                            </div>
                            <div class="flex items-center justify-end mt-6">
                                <button type="submit" class="px-6 py-3 bg-gray-800 text-white rounded-md hover:bg-gray-700 font-semibold" :disabled="form.processing">
                                    Crear Orden de Trabajo
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </AuthenticatedLayout>
</template>
</file>

<file path="src/ClientPortal/Http/Controllers/VehiculoController.php">
<?php

namespace FlipperBox\ClientPortal\Http\Controllers;

use App\Http\Controllers\Controller;
use FlipperBox\Crm\Models\Vehiculo;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Validation\Rule;
use Inertia\Inertia;
use Inertia\Response;

class VehiculoController extends Controller
{
    public function index(): Response
    {
        $this->authorize('viewAny', Vehiculo::class);

        $vehiculos = Auth::user()->vehiculos()->latest()->paginate(10);
        return Inertia::render('ClientPortal/Vehicles/Index', [
            'vehiculos' => $vehiculos,
        ]);
    }

    public function create(): Response
    {
        $this->authorize('create', Vehiculo::class);
        return Inertia::render('ClientPortal/Vehicles/Create');
    }

    public function store(Request $request): RedirectResponse
    {
        $this->authorize('create', Vehiculo::class);

        $validated = $request->validate([
            'patente' => ['required', 'string', 'max:255', 'unique:vehiculos,patente'],
            'marca' => ['required', 'string', 'max:255'],
            'modelo' => ['required', 'string', 'max:255'],
            'anio' => ['required', 'integer', 'min:1950', 'max:'.date('Y')],
            'kilometraje' => ['nullable', 'integer', 'min:0'],
        ]);

        Auth::user()->vehiculos()->create($validated);

        return to_route('cliente.vehiculos.index')->with('success', 'Vehículo agregado exitosamente.');
    }

    public function edit(Vehiculo $vehiculo): Response
    {
        $this->authorize('update', $vehiculo);

        return Inertia::render('ClientPortal/Vehicles/Edit', [
            'vehiculo' => $vehiculo,
        ]);
    }

    public function update(Request $request, Vehiculo $vehiculo): RedirectResponse
    {
        $this->authorize('update', $vehiculo);

        $validated = $request->validate([
            'patente' => ['required', 'string', 'max:255', Rule::unique('vehiculos', 'patente')->ignore($vehiculo->id)],
            'marca' => ['required', 'string', 'max:255'],
            'modelo' => ['required', 'string', 'max:255'],
            'anio' => ['required', 'integer', 'min:1950', 'max:'.date('Y')],
            'kilometraje' => ['nullable', 'integer', 'min:0'],
        ]);

        $vehiculo->update($validated);
        return to_route('cliente.vehiculos.index')->with('success', 'Vehículo actualizado exitosamente.');
    }

    public function destroy(Vehiculo $vehiculo): RedirectResponse
    {
        $this->authorize('delete', $vehiculo);

        $vehiculo->delete();
        return to_route('cliente.vehiculos.index')->with('success', 'Vehículo eliminado exitosamente.');
    }
}
</file>

<file path="src/ClientPortal/routes/web.php">
<?php

use FlipperBox\ClientPortal\Http\Controllers\DashboardController;
use FlipperBox\ClientPortal\Http\Controllers\VehiculoController;
use Illuminate\Support\Facades\Route;

// Ruta del Dashboard del Cliente
Route::get('/dashboard', [DashboardController::class, 'index'])->name('dashboard');

// Grupo de Rutas para la Gestión de Vehículos del Cliente
Route::prefix('vehiculos')->name('vehiculos.')->group(function () {
    Route::get('/', [VehiculoController::class, 'index'])->name('index');
    Route::get('/crear', [VehiculoController::class, 'create'])->name('create');
    Route::post('/', [VehiculoController::class, 'store'])->name('store');
    Route::get('/{vehiculo}/editar', [VehiculoController::class, 'edit'])->name('edit');
    Route::patch('/{vehiculo}', [VehiculoController::class, 'update'])->name('update');
    Route::delete('/{vehiculo}', [VehiculoController::class, 'destroy'])->name('destroy');
});
</file>

<file path="src/Crm/Http/Controllers/CrmController.php">
<?php

namespace FlipperBox\Crm\Http\Controllers;

use App\Http\Controllers\Controller;
use App\Models\User;
use FlipperBox\Crm\Actions\CreateUserAsClientAction;
use FlipperBox\Crm\Http\Requests\StoreUserAsClientRequest;
use FlipperBox\Crm\Http\Requests\UpdateUserAsClientRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Validation\ValidationException;
use Inertia\Inertia;
use Inertia\Response;

class CrmController extends Controller
{
    public function index(): Response
    {
        return Inertia::render('Crm/Clientes/Index', [
            'clientes' => User::role('Cliente')->latest()->paginate(10),
        ]);
    }

    public function create(): Response
    {
        return Inertia::render('Crm/Clientes/Create');
    }

    public function store(StoreUserAsClientRequest $request, CreateUserAsClientAction $createUserAsClient): RedirectResponse
    {
        $createUserAsClient->execute($request->validated());
        return to_route('clientes.index')->with('success', 'Cliente creado exitosamente.');
    }

    public function show(User $user): Response
    {
        abort_if(!$user->hasRole('Cliente'), 404);
        $user->load('vehiculos');
        return Inertia::render('Crm/Clientes/Show', [
            'cliente' => $user,
        ]);
    }

    public function edit(User $user): Response
    {
        abort_if(!$user->hasRole('Cliente'), 404);
        return Inertia::render('Crm/Clientes/Edit', [
            'cliente' => $user,
        ]);
    }

    public function update(UpdateUserAsClientRequest $request, User $user): RedirectResponse
    {
        $user->update($request->validated());
        return to_route('clientes.index')->with('success', 'Cliente actualizado exitosamente.');
    }

    public function destroy(User $user): RedirectResponse
    {
        // 1. Verificación de Rol explícita
        if (!$user->hasRole('Cliente')) {
            return back()->with('error', 'La acción de eliminación solo es aplicable a usuarios con el rol de Cliente.');
        }

        // 2. Verificación de Regla de Negocio explícita
        if ($user->vehiculos()->whereHas('workOrders')->exists()) {
            return back()->with('error', 'No se puede eliminar este cliente porque tiene órdenes de trabajo asociadas. Por favor, gestione esas órdenes primero.');
        }

        // Si pasa las validaciones, procedemos a eliminar
        try {
            $user->delete();
        } catch (ValidationException $e) {
            // El catch se mantiene como una segunda capa de seguridad por si un Observer lanza una excepción
            return back()->with('error', $e->validator->errors()->first('error'));
        }
        
        return to_route('clientes.index')->with('success', 'Cliente eliminado exitosamente.');
    }
}
</file>

<file path="src/Crm/Providers/CrmServiceProvider.php">
<?php

namespace FlipperBox\Crm\Providers;

use Illuminate\Support\Facades\Route;
use Illuminate\Support\ServiceProvider;

class CrmServiceProvider extends ServiceProvider
{
    /**
     * Register services.
     */
    public function register(): void
    {
        //
    }

    /**
     * Bootstrap services.
     */
    public function boot(): void
    {
        Route::middleware('web')
            ->group(function () {
                $this->loadRoutesFrom(__DIR__.'/../routes/web.php');
            });
    }
}
</file>

<file path="src/Inventory/Actions/CrearNuevoProductoAction.php">
<?php

namespace FlipperBox\Inventory\Actions;

use FlipperBox\Inventory\Models\Product;
use FlipperBox\Inventory\Models\InventoryMovement;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;

class CrearNuevoProductoAction
{
    public function execute(array $data): Product
    {
        return DB::transaction(function () use ($data) {
            // 1. Instanciamos el modelo y asignamos propiedades
            $product = new Product();
            $product->fill($data);
            $product->save();

            // 2. Vinculamos el producto con el proveedor en la tabla pivot
            $product->suppliers()->attach($data['supplier_id'], ['cost' => $data['cost']]);

            // 3. Si hay stock inicial, crear el primer movimiento de inventario
            if ($product->current_stock > 0) {
                InventoryMovement::create([
                    'product_id' => $product->id,
                    'user_id' => Auth::id(),
                    'type' => 'in',
                    'quantity' => $product->current_stock,
                    'reason' => 'Stock Inicial',
                ]);
            }
            
            Log::info("Nuevo producto creado: ID {$product->id} - {$product->name}");

            return $product;
        });
    }
}
</file>

<file path="src/Inventory/Http/Requests/StoreProductRequest.php">
<?php

namespace FlipperBox\Inventory\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;
use Illuminate\Support\Facades\Auth;

class StoreProductRequest extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     *
     * @return bool
     */
    public function authorize(): bool
    {
        return Auth::user()->can('gestionar inventario');
    }

    /**
     * Get the validation rules that apply to the request.
     *
     * @return array<string, \Illuminate\Contracts\Validation\ValidationRule|array<mixed>|string>
     */
    public function rules(): array
    {
        return [
            'name' => ['required', 'string', 'max:255'],
            'sku' => ['required', 'string', 'max:255', 'unique:products,sku'],
            'description' => ['nullable', 'string'],
            'cost' => ['required', 'numeric', 'min:0'],
            'iva_percentage' => ['required', 'numeric', 'min:0', 'max:100'],
            'profit_margin' => ['required', 'numeric', 'min:0'],
            'current_stock' => ['required', 'integer', 'min:0'],
            'min_threshold' => ['required', 'integer', 'min:0'],
            'supplier_id' => ['required', 'exists:suppliers,id'],
        ];
    }

    /**
     * Get the custom validation messages for the defined rules.
     *
     * @return array<string, string>
     */
    public function messages(): array
    {
        return [
            'name.required' => 'El nombre del producto es obligatorio.',
            'sku.required' => 'El SKU es obligatorio.',
            'sku.unique' => 'Este SKU ya está registrado. Por favor, elige otro.',
            'cost.required' => 'El precio de costo es obligatorio.',
            'cost.numeric' => 'El costo debe ser un valor numérico.',
            'cost.min' => 'El costo no puede ser negativo.',
            'iva_percentage.required' => 'El porcentaje de IVA es obligatorio.',
            'iva_percentage.numeric' => 'El IVA debe ser un valor numérico.',
            'profit_margin.required' => 'El margen de ganancia es obligatorio.',
            'profit_margin.numeric' => 'El margen de ganancia debe ser un valor numérico.',
            'current_stock.required' => 'El stock inicial es obligatorio.',
            'current_stock.integer' => 'El stock debe ser un número entero.',
            'current_stock.min' => 'El stock no puede ser negativo.',
            'min_threshold.required' => 'El umbral de stock bajo es obligatorio.',
            'min_threshold.integer' => 'El umbral debe ser un número entero.',
            'min_threshold.min' => 'El umbral no puede ser negativo.',
            'supplier_id.required' => 'Debes seleccionar un proveedor.',
            'supplier_id.exists' => 'El proveedor seleccionado no es válido.',
        ];
    }
}
</file>

<file path="src/Scheduling/Http/Controllers/CapacityController.php">
<?php

namespace FlipperBox\Scheduling\Http\Controllers;

use App\Http\Controllers\Controller;
use FlipperBox\Scheduling\Models\DailyCapacity;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Carbon;
use Inertia\Inertia;
use Inertia\Response;

class CapacityController extends Controller
{
    public function index(Request $request): Response
    {
        $year = $request->input('year', now()->year);
        $month = $request->input('month', now()->month);

        // Obtener capacidades para el mes especÃ­fico
        $capacities = DailyCapacity::whereYear('date', $year)
            ->whereMonth('date', $month)
            ->orderBy('date')
            ->get()
            ->map(function ($capacity) {
                return [
                    'id' => $capacity->id,
                    'date' => $capacity->date->format('Y-m-d'),
                    'total_slots' => $capacity->total_slots,
                    'booked_slots' => $capacity->booked_slots,
                    'created_at' => $capacity->created_at,
                    'updated_at' => $capacity->updated_at,
                ];
            });

        return Inertia::render('Scheduling/Admin/CapacityIndex', [
            'capacities' => $capacities,
            'currentYear' => (int)$year,
            'currentMonth' => (int)$month,
        ]);
    }

    public function store(Request $request): RedirectResponse
    {
        $validated = $request->validate([
            'date' => ['required', 'date'],
            'total_slots' => ['required', 'integer', 'min:1'],
        ]);

        DailyCapacity::updateOrCreate(
            ['date' => $validated['date']],
            ['total_slots' => $validated['total_slots']]
        );

        $date = Carbon::parse($validated['date']);

        return redirect()->route('admin.scheduling.capacities.index', [
            'year' => $date->year,
            'month' => $date->month,
        ])->with('success', 'Capacidad guardada correctamente.');
    }
}
</file>

<file path="src/WorkManagement/Models/ExternalCost.php">
<?php

namespace FlipperBox\WorkManagement\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class ExternalCost extends Model
{
    protected $fillable = ['work_order_id', 'description', 'cost', 'price'];

    /**
     * Define la relación inversa: Un costo externo pertenece a una orden de trabajo.
     */
    public function workOrder(): BelongsTo
    {
        return $this->belongsTo(WorkOrder::class);
    }
}
</file>

<file path="src/WorkManagement/Models/Service.php">
<?php

namespace FlipperBox\WorkManagement\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;

class Service extends Model
{
    protected $fillable = ['name', 'description', 'price'];

    /**
     * Define la relación: Un servicio puede estar en muchas órdenes de trabajo.
     */
    public function workOrders(): BelongsToMany
    {
        return $this->belongsToMany(WorkOrder::class, 'work_order_service')
                    ->withPivot('price')
                    ->withTimestamps();
    }
}
</file>

<file path="src/WorkManagement/Models/WorkOrder.php">
<?php

namespace FlipperBox\WorkManagement\Models;

use App\Models\User;
use FlipperBox\Crm\Models\Vehiculo;
use FlipperBox\Inventory\Models\Product;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Database\Eloquent\SoftDeletes;

class WorkOrder extends Model
{
    use HasFactory, SoftDeletes;
    protected $fillable = ['vehicle_id', 'mechanic_id', 'status', 'description', 'notes', 'entry_date', 'completion_date', 'total'];
    protected $casts = ['entry_date' => 'datetime', 'completion_date' => 'datetime'];

    public function vehicle(): BelongsTo
    {
        return $this->belongsTo(Vehiculo::class, 'vehicle_id')->withTrashed();
    }

    public function mechanic(): BelongsTo
    {
        return $this->belongsTo(User::class, 'mechanic_id');
    }

    public function products(): BelongsToMany
    {
        return $this->belongsToMany(Product::class, 'work_order_product')
            ->withPivot('quantity', 'unit_price')
            ->withTimestamps()
            ->withTrashed();
    }

    public function services(): BelongsToMany
    {
        return $this->belongsToMany(Service::class, 'work_order_service')
            ->withPivot('price')
            ->withTimestamps();
    }

    public function externalCosts(): HasMany
    {
        return $this->hasMany(ExternalCost::class);
    }
}
</file>

<file path="bootstrap/app.php">
<?php

use Illuminate\Foundation\Application;
use Illuminate\Foundation\Configuration\Exceptions;
use Illuminate\Foundation\Configuration\Middleware;

return Application::configure(basePath: dirname(__DIR__))
    ->withRouting(
        commands: __DIR__.'/../routes/console.php',
        health: '/up',
    )
    ->withMiddleware(function (Middleware $middleware) {
        
        $middleware->web(append: [
            \App\Http\Middleware\HandleInertiaRequests::class,
        ]);

        $middleware->alias([
            'role' => \Spatie\Permission\Middleware\RoleMiddleware::class,
            'permission' => \Spatie\Permission\Middleware\PermissionMiddleware::class,
            'role_or_permission' => \Spatie\Permission\Middleware\RoleOrPermissionMiddleware::class,
        ]);
    })
    ->withExceptions(function (Exceptions $exceptions) {
        //
    })->create();
</file>

<file path="resources/js/Pages/Inventory/Products/Index.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, Link, usePage, router } from '@inertiajs/vue3';
import Pagination from '@/Components/Pagination.vue';
import ConfirmationModal from '@/Components/ConfirmationModal.vue';
import { ref } from 'vue';

defineProps({
    products: {
        type: Object,
        required: true,
    },
});

const can = (permission) => usePage().props.auth.user.permissions.includes(permission);

// --- Lógica para el Modal de Eliminación ---
const confirmingProductDeletion = ref(false);
const productToDelete = ref(null);

const confirmProductDeletion = (product) => {
    productToDelete.value = product;
    confirmingProductDeletion.value = true;
};

const deleteProduct = () => {
    router.delete(route('inventario.products.destroy', productToDelete.value.id), {
        onSuccess: () => closeModal(),
        preserveScroll: true,
    });
};

const closeModal = () => {
    confirmingProductDeletion.value = false;
    productToDelete.value = null;
};
</script>

<template>
    <Head title="Productos" />
    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Gestión de Productos</h2>
                <Link v-if="can('gestionar inventario')" :href="route('inventario.products.create')" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition">
                    Crear Nuevo Producto
                </Link>
            </div>
        </template>
        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">SKU</th>
                                        <th scope="col" class="px-6 py-3">Nombre</th>
                                        <th scope="col" class="px-6 py-3">Precio Venta</th>
                                        <th scope="col" class="px-6 py-3">Stock Actual</th>
                                        <th scope="col" class="px-6 py-3 text-right">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="product in products.data" :key="product.id" class="bg-white border-b hover:bg-gray-50">
                                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ product.sku }}</th>
                                        <td class="px-6 py-4">{{ product.name }}</td>
                                        <td class="px-6 py-4">${{ product.price }}</td>
                                        <td class="px-6 py-4">{{ product.current_stock }}</td>
                                        <td class="px-6 py-4 text-right">
                                            <!-- ENLACES CORREGIDOS -->
                                            <Link v-if="can('gestionar inventario')" :href="route('inventario.products.edit', product.id)" class="font-medium text-blue-600 hover:underline mr-4">Editar</Link>
                                            <button v-if="can('gestionar inventario')" @click="confirmProductDeletion(product)" class="font-medium text-red-600 hover:underline">Eliminar</button>
                                        </td>
                                    </tr>
                                    <tr v-if="products.data.length === 0">
                                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">No se encontraron productos.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div v-if="products.links.length > 3" class="p-6 border-t">
                        <Pagination :links="products.links" />
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL DE CONFIRMACIÓN PARA PRODUCTOS -->
        <ConfirmationModal 
            :show="confirmingProductDeletion" 
            @close="closeModal"
            @confirm="deleteProduct"
            title="Eliminar Producto"
            :message="`¿Estás seguro de que deseas eliminar el producto '${productToDelete?.name}'? Esta acción no se puede deshacer.`"
        />
    </AuthenticatedLayout>
</template>
</file>

<file path="src/Inventory/Http/Controllers/SupplierController.php">
<?php

namespace FlipperBox\Inventory\Http\Controllers;

use App\Http\Controllers\Controller;
use FlipperBox\Inventory\Http\Requests\StoreSupplierRequest;
use FlipperBox\Inventory\Http\Requests\UpdateSupplierRequest;
use FlipperBox\Inventory\Models\Supplier;
use Illuminate\Http\RedirectResponse;
use Inertia\Inertia;
use Inertia\Response;

class SupplierController extends Controller
{
    public function index(): Response
    {
        return Inertia::render('Inventory/Suppliers/Index', [
            'suppliers' => Supplier::latest()->paginate(10),
        ]);
    }

    public function create(): Response
    {
        return Inertia::render('Inventory/Suppliers/Create');
    }

    public function store(StoreSupplierRequest $request): RedirectResponse
    {
        Supplier::create($request->validated());
        return to_route('inventario.suppliers.index')->with('success', 'Proveedor creado exitosamente.');
    }

    public function edit(Supplier $supplier): Response
    {
        return Inertia::render('Inventory/Suppliers/Edit', [
            'supplier' => $supplier,
        ]);
    }

    public function update(UpdateSupplierRequest $request, Supplier $supplier): RedirectResponse
    {
        $supplier->update($request->validated());
        return to_route('inventario.suppliers.index')->with('success', 'Proveedor actualizado exitosamente.');
    }

    public function destroy(Supplier $supplier): RedirectResponse
    {
        $supplier->delete(); // Usamos Soft Delete
        return to_route('inventario.suppliers.index')->with('success', 'Proveedor eliminado exitosamente.');
    }
}
</file>

<file path="src/Inventory/Models/Product.php">
<?php

namespace FlipperBox\Inventory\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;
use FlipperBox\WorkManagement\Models\WorkOrder;
use Illuminate\Database\Eloquent\Relations\BelongsToMany;

class Product extends Model
{
    use HasFactory, SoftDeletes;

    protected $fillable = [
        'name',
        'sku',
        'description',
        'cost',
        'iva_percentage',
        'profit_margin',
        'price',
        'current_stock',
        'min_threshold',
    ];

    protected $casts = [
        'cost' => 'decimal:2',
        'iva_percentage' => 'decimal:2',
        'profit_margin' => 'decimal:2',
        'price' => 'decimal:2',
    ];

    protected static function boot()
    {
        parent::boot();

        // Calcular automáticamente el precio antes de guardar
        static::saving(function ($product) {
            if (empty($product->price) || $product->isDirty(['cost', 'iva_percentage', 'profit_margin'])) {
                $product->price = $product->calculatePrice();
            }
        });
    }

    /**
     * Calcular el precio basado en costo, IVA y margen
     * Fórmula: (Costo + IVA) × (1 + Margen%)
     */
    public function calculatePrice(): float
    {
        $costWithIva = $this->cost * (1 + ($this->iva_percentage / 100));
        $price = $costWithIva * (1 + ($this->profit_margin / 100));
        return round($price, 2);
    }

    // Relaciones
    public function suppliers()
    {
        return $this->belongsToMany(Supplier::class)
            ->withPivot('cost')
            ->withTimestamps();
    }

    public function inventoryMovements()
    {
        return $this->hasMany(InventoryMovement::class);
    }

    public function workOrders(): BelongsToMany
    {
        return $this->belongsToMany(WorkOrder::class, 'work_order_product')
            ->withPivot('quantity', 'unit_price')
            ->withTimestamps();
    }
}
</file>

<file path="src/WorkManagement/routes/web.php">
<?php

use FlipperBox\WorkManagement\Http\Controllers\WorkOrderController;
use Illuminate\Support\Facades\Route;

Route::middleware('can:ver ordenes de trabajo')->prefix('ordenes-trabajo')->name('work-orders.')->group(function () {
    Route::get('/', [WorkOrderController::class, 'index'])->name('index');
    
    Route::middleware('can:gestionar ordenes de trabajo')->group(function() {
        Route::get('/crear/vehiculo/{vehiculo}', [WorkOrderController::class, 'create'])->name('create');
        Route::post('/', [WorkOrderController::class, 'store'])->name('store');
        Route::get('/{workOrder}', [WorkOrderController::class, 'show'])->name('show');
        Route::patch('/{workOrder}', [WorkOrderController::class, 'update'])->name('update');
        Route::delete('/{workOrder}', [WorkOrderController::class, 'destroy'])->name('destroy');

        // Rutas para gestionar los ítems de una orden de trabajo
        Route::post('/{workOrder}/products', [WorkOrderController::class, 'addProduct'])->name('products.add');
        Route::delete('/{workOrder}/products/{product}', [WorkOrderController::class, 'removeProduct'])->name('products.remove');
        
        Route::post('/{workOrder}/services', [WorkOrderController::class, 'addService'])->name('services.add');
        Route::delete('/{workOrder}/services/{service}', [WorkOrderController::class, 'removeService'])->name('services.remove');
        
        Route::post('/{workOrder}/external-costs', [WorkOrderController::class, 'addExternalCost'])->name('external-costs.add');
        Route::delete('/external-costs/{externalCost}', [WorkOrderController::class, 'removeExternalCost'])->name('external-costs.remove');

        Route::patch('/{workOrder}/assign-mechanic', [WorkOrderController::class, 'assignMechanic'])->name('assign-mechanic');
    });
});
</file>

<file path="app/Http/Controllers/Auth/AuthenticatedSessionController.php">
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Http\Requests\Auth\LoginRequest;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Route;
use Inertia\Inertia;
use Inertia\Response;

class AuthenticatedSessionController extends Controller
{
    /**
     * Display the login view.
     */
    public function create(): Response
    {
        return Inertia::render('Auth/Login', [
            'canResetPassword' => Route::has('password.request'),
            'status' => session('status'),
        ]);
    }

    /**
     * Handle an incoming authentication request.
     */
    public function store(LoginRequest $request): RedirectResponse
    {
        $request->authenticate();
        $request->session()->regenerate();
        $user = $request->user();

        if ($user->hasRole('Admin')) {
            return redirect()->intended(route('dashboard'));
        }
        if ($user->hasRole('Mecanico')) {
            return redirect()->intended(route('mecanico.dashboard'));
        }
        if ($user->hasRole('Cliente')) {
            return redirect()->intended(route('cliente.dashboard'));
        }

        // Fallback por si un usuario no tiene un rol principal
        return redirect()->intended(route('dashboard'));
    }

    /**
     * Destroy an authenticated session.
     */
    public function destroy(Request $request): RedirectResponse
    {
        Auth::guard('web')->logout();

        $request->session()->invalidate();

        $request->session()->regenerateToken();

        return redirect('/');
    }
}
</file>

<file path="app/Http/Controllers/Auth/RegisteredUserController.php">
<?php

namespace App\Http\Controllers\Auth;

use App\Http\Controllers\Controller;
use App\Models\User;
use Illuminate\Auth\Events\Registered;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules;
use Inertia\Inertia;
use Inertia\Response;
use Spatie\Permission\Models\Role;

class RegisteredUserController extends Controller
{
    /**
     * Display the registration view.
     */
    public function create(): Response
    {
        return Inertia::render('Auth/Register');
    }

    /**
     * Handle an incoming registration request.
     *
     * @throws \Illuminate\Validation\ValidationException
     */
    public function store(Request $request): RedirectResponse
    {
        $request->validate([
            'name' => 'required|string|max:255',
            'email' => 'required|string|lowercase|email|max:255|unique:' . User::class,
            'password' => ['required', 'confirmed', Rules\Password::defaults()],
        ]);

        $user = User::create([
            'name' => $request->name,
            'email' => $request->email,
            'password' => Hash::make($request->password),
        ]);

        $clienteRole = Role::findByName('Cliente');
        $user->assignRole($clienteRole);

        event(new Registered($user));
        Auth::login($user);

        // Redirección correcta al dashboard del cliente
        return redirect(route('cliente.dashboard'));
    }
}
</file>

<file path="app/Http/Middleware/HandleInertiaRequests.php">
<?php

namespace App\Http\Middleware;

use Illuminate\Http\Request;
use Inertia\Middleware;

class HandleInertiaRequests extends Middleware
{
    /**
     * The root template that is loaded on the first page visit.
     *
     * @var string
     */
    protected $rootView = 'app';

    /**
     * Determine the current asset version.
     */
    public function version(Request $request): ?string
    {
        return parent::version($request);
    }

    /**
     * Define the props that are shared by default.
     *
     * @return array<string, mixed>
     */
    public function share(Request $request): array
    {
        return [
            // Heredamos cualquier prop compartida por el middleware padre.
            ...parent::share($request),

            // Compartimos la información de autenticación de forma "lazy" (diferida).
            // El código dentro de la función solo se ejecutará si el frontend lo necesita.
            'auth' => function () use ($request) {
                return [
                    'user' => $request->user() ? [
                        'id' => $request->user()->id,
                        'name' => $request->user()->name,
                        'email' => $request->user()->email,
                        // Los permisos solo se calculan si el usuario existe.
                        'permissions' => $request->user()->getAllPermissions()->pluck('name'),
                    ] : null,
                ];
            },
            
            // Compartimos los mensajes flash también de forma "lazy".
            'flash' => [
                'success' => fn () => $request->session()->get('success'),
                'error' => fn () => $request->session()->get('error'),
            ],
        ];
    }
}
</file>

<file path="app/Models/User.php">
<?php

namespace App\Models;

// use Illuminate\Contracts\Auth\MustVerifyEmail;
use FlipperBox\Crm\Models\Vehiculo;
use FlipperBox\WorkManagement\Models\WorkOrder;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Spatie\Permission\Traits\HasRoles;

class User extends Authenticatable
{
    /** @use HasFactory<\Database\Factories\UserFactory> */
    use HasFactory, Notifiable, HasRoles;

    /**
     * The attributes that are mass assignable.
     *
     * @var array<int, string>
     */
    protected $fillable = [
        'name',
        'apellido',
        'email',
        'telefono',
        'documento_tipo',
        'documento_valor',
        'password',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var array<int, string>
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * Get the attributes that should be cast.
     *
     * @return array<string, string>
     */
    protected function casts(): array
    {
        return [
            'email_verified_at' => 'datetime',
            'password' => 'hashed',
        ];
    }

    /**
     * Define la relación: Un usuario (si es cliente) puede tener muchos vehículos.
     */
    public function vehiculos(): HasMany
    {
        return $this->hasMany(Vehiculo::class);
    }

    /**
     * Define la relación: Un usuario (si es mecánico) puede tener muchas órdenes de trabajo asignadas.
     */
    public function workOrders(): HasMany
    {
        return $this->hasMany(WorkOrder::class, 'mechanic_id');
    }
}
</file>

<file path="resources/js/Pages/Crm/Clientes/Show.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, Link, usePage, router } from '@inertiajs/vue3';
import ConfirmationModal from '@/Components/ConfirmationModal.vue';
import { ref } from 'vue';

const props = defineProps({
    cliente: {
        type: Object,
        required: true,
    },
});

const can = (permission) => usePage().props.auth.user.permissions.includes(permission);

const confirmingVehicleDeletion = ref(false);
const vehicleToDelete = ref(null);

const confirmVehicleDeletion = (vehiculo) => {
    vehicleToDelete.value = vehiculo;
    confirmingVehicleDeletion.value = true;
};

const deleteVehicle = () => {
    router.delete(route('clientes.vehiculos.destroy', { user: props.cliente.id, vehiculo: vehicleToDelete.value.id }), {
        onSuccess: () => closeModal(),
        preserveScroll: true,
    });
};

const closeModal = () => {
    confirmingVehicleDeletion.value = false;
    vehicleToDelete.value = null;
};
</script>

<template>
    <Head :title="`Cliente: ${cliente.name} ${cliente.apellido}`" />

    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">
                    Detalle del Cliente
                </h2>
                <Link :href="route('clientes.index')" class="text-sm text-gray-700 underline">
                    &larr; Volver al listado
                </Link>
            </div>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 space-y-6">
                <!-- Sección de Datos del Cliente -->
                <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
                    <section>
                        <header>
                            <h2 class="text-lg font-medium text-gray-900">{{ cliente.name }} {{ cliente.apellido }}</h2>
                            <p class="mt-1 text-sm text-gray-600">Información de contacto y personal del cliente.</p>
                        </header>
                        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <span class="font-bold text-gray-700">Email:</span>
                                <span class="ml-2 text-gray-900">{{ cliente.email || 'No especificado' }}</span>
                            </div>
                            <div>
                                <span class="font-bold text-gray-700">Teléfono:</span>
                                <span class="ml-2 text-gray-900">{{ cliente.telefono || 'No especificado' }}</span>
                            </div>
                            <div>
                                <span class="font-bold text-gray-700">Documento:</span>
                                <span class="ml-2 text-gray-900">{{ cliente.documento_tipo || '' }} {{ cliente.documento_valor || 'No especificado' }}</span>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Sección de Vehículos Asociados -->
                <div class="p-4 sm:p-8 bg-white shadow sm:rounded-lg">
                    <section>
                        <header class="flex justify-between items-center">
                            <div>
                                <h2 class="text-lg font-medium text-gray-900">Vehículos Registrados</h2>
                                <p class="mt-1 text-sm text-gray-600">Listado de vehículos asociados a este cliente.</p>
                            </div>
                            <Link v-if="can('crear vehiculos')" :href="route('clientes.vehiculos.create', { user: cliente.id })" class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition">
                                Agregar Vehículo
                            </Link>
                        </header>
                        <div class="mt-6 overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Patente</th>
                                        <th scope="col" class="px-6 py-3">Marca</th>
                                        <th scope="col" class="px-6 py-3">Modelo</th>
                                        <th scope="col" class="px-6 py-3">Año</th>
                                        <th scope="col" class="px-6 py-3 text-right">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="vehiculo in cliente.vehiculos" :key="vehiculo.id" class="bg-white border-b hover:bg-gray-50">
                                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ vehiculo.patente }}</th>
                                        <td class="px-6 py-4">{{ vehiculo.marca }}</td>
                                        <td class="px-6 py-4">{{ vehiculo.modelo }}</td>
                                        <td class="px-6 py-4">{{ vehiculo.anio }}</td>
                                        <td class="px-6 py-4 text-right">
                                            <Link :href="route('work-orders.create', { vehiculo: vehiculo.id })" class="font-medium text-green-600 hover:underline mr-4">Crear OT</Link>
                                            <Link v-if="can('editar vehiculos')" :href="route('clientes.vehiculos.edit', { user: cliente.id, vehiculo: vehiculo.id })" class="font-medium text-blue-600 hover:underline mr-4">Editar</Link>
                                            <button v-if="can('eliminar vehiculos')" @click="confirmVehicleDeletion(vehiculo)" class="font-medium text-red-600 hover:underline">Eliminar</button>
                                        </td>
                                    </tr>
                                    <tr v-if="cliente.vehiculos.length === 0">
                                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">Este cliente no tiene vehículos registrados.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- MODAL DE CONFIRMACIÓN PARA VEHÍCULOS -->
        <ConfirmationModal 
            :show="confirmingVehicleDeletion" 
            @close="closeModal"
            @confirm="deleteVehicle"
            title="Eliminar Vehículo"
            :message="`¿Estás seguro de que deseas eliminar el vehículo con patente ${vehicleToDelete?.patente}? Esta acción no se puede deshacer.`"
        />
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/WorkManagement/Index.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, Link, usePage, router } from '@inertiajs/vue3';
import Pagination from '@/Components/Pagination.vue';
import ConfirmationModal from '@/Components/ConfirmationModal.vue';
import { ref } from 'vue';

const props = defineProps({
    workOrders: {
        type: Object,
        required: true,
    },
});

const can = (permission) => usePage().props.auth.user.permissions.includes(permission);

// Helper para dar estilo al estado de la orden
const statusClass = (status) => {
    return {
        'bg-yellow-100 text-yellow-800': status === 'Pendiente',
        'bg-blue-100 text-blue-800': status === 'En Progreso',
        'bg-green-100 text-green-800': status === 'Completada',
        'bg-red-100 text-red-800': status === 'Cancelada',
    };
};

// Helper para formatear fechas
const formatDate = (dateString) => {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    return new Date(dateString).toLocaleDateString('es-ES', options);
};

// --- Lógica para el Modal de Eliminación ---
const confirmingOrderDeletion = ref(false);
const orderToDelete = ref(null);

const confirmOrderDeletion = (workOrder) => {
    orderToDelete.value = workOrder;
    confirmingOrderDeletion.value = true;
};

const deleteOrder = () => {
    router.delete(route('work-orders.destroy', orderToDelete.value.id), {
        onSuccess: () => closeModal(),
        preserveScroll: true, // Mantiene al usuario en la misma página de la paginación
    });
};

const closeModal = () => {
    confirmingOrderDeletion.value = false;
    orderToDelete.value = null;
};
</script>

<template>

    <Head title="Órdenes de Trabajo" />

    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Gestión de Órdenes de Trabajo</h2>
                <!-- El botón Crear ahora es solo un placeholder, la creación se inicia desde el cliente -->
                <p v-if="can('gestionar ordenes de trabajo')" class="text-sm text-gray-500">
                    Para crear una orden, ve al detalle del cliente y selecciona un vehículo.
                </p>
            </div>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">ID</th>
                                        <th scope="col" class="px-6 py-3">Vehículo (Patente)</th>
                                        <th scope="col" class="px-6 py-3">Cliente</th>
                                        <th scope="col" class="px-6 py-3">Estado</th>
                                        <th scope="col" class="px-6 py-3">Fecha Ingreso</th>
                                        <th scope="col" class="px-6 py-3 text-right">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="workOrder in workOrders.data" :key="workOrder.id"
                                        class="bg-white border-b hover:bg-gray-50">
                                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                            #{{
                                                workOrder.id }}</th>
                                        <td class="px-6 py-4">
                                            {{ workOrder.vehicle.patente }}
                                            <span v-if="workOrder.vehicle.deleted_at"
                                                class="ml-2 text-xs text-red-500 bg-red-100 px-2 py-1 rounded-full">Archivado</span>
                                        </td>
                                        <td class="px-6 py-4">{{ workOrder.vehicle.cliente.nombre }} {{
                                            workOrder.vehicle.cliente.apellido }}</td>
                                        <td class="px-6 py-4">
                                            <span class="px-2 py-1 font-semibold leading-tight text-xs rounded-full"
                                                :class="statusClass(workOrder.status)">
                                                {{ workOrder.status }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">{{ formatDate(workOrder.entry_date) }}</td>
                                        <td class="px-6 py-4 text-right">
                                            <Link :href="route('work-orders.show', workOrder.id)"
                                                class="font-medium text-blue-600 hover:underline mr-4">Ver Detalle
                                            </Link>

                                            <!-- Botón de Eliminación Condicional -->
                                            <button
                                                v-if="can('gestionar ordenes de trabajo') && workOrder.status !== 'Completada'"
                                                @click="confirmOrderDeletion(workOrder)"
                                                class="font-medium text-red-600 hover:underline">
                                                Eliminar
                                            </button>
                                        </td>
                                    </tr>
                                    <tr v-if="workOrders.data.length === 0">
                                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">No se encontraron
                                            órdenes de
                                            trabajo.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Paginación -->
                    <div v-if="workOrders.links.length > 3" class="mt-6">
                        <Pagination :links="workOrders.links" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Confirmación -->
        <ConfirmationModal :show="confirmingOrderDeletion" @close="closeModal" @confirm="deleteOrder"
            title="Eliminar Orden de Trabajo"
            :message="`¿Estás seguro de que deseas eliminar la orden #${orderToDelete?.id}? Si se utilizaron productos, el stock será devuelto. Esta acción no se puede deshacer.`" />
    </AuthenticatedLayout>
</template>
</file>

<file path="resources/js/Pages/WorkManagement/Show.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, Link, useForm, usePage, router } from '@inertiajs/vue3';
import ConfirmationModal from '@/Components/ConfirmationModal.vue';
import { ref, computed } from 'vue';

// --- PROPS ---
const props = defineProps({
    workOrder: Object,
    products: Array, // Catálogo de productos disponibles
    services: Array, // Catálogo de servicios disponibles
    mechanics: Array, // Lista de mecánicos disponibles
});

// --- COMPUTED PROPERTIES ---
// Propiedad computada para determinar si la orden está finalizada (no se puede editar)
const isFinalized = computed(() =>
    props.workOrder.status === 'Completada' || props.workOrder.status === 'Cancelada'
);

// --- HELPERS ---
const can = (permission) => usePage().props.auth.user.permissions.includes(permission);
const formatDate = (dateString) => new Date(dateString).toLocaleDateString('es-ES', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });

// --- FORMULARIOS ---
const addProductForm = useForm({ product_id: null, quantity: 1 });
const addServiceForm = useForm({ service_id: null });
const addExternalCostForm = useForm({ description: '', cost: 0, price: 0 });
const assignMechanicForm = useForm({ mechanic_id: props.workOrder.mechanic?.id || null });

// --- FUNCIONES DE SUBMIT (CON RECARGA DE DATOS PARA SOLUCIONAR BUG DE RENDERIZADO) ---
const submitProduct = () => addProductForm.post(route('work-orders.products.add', props.workOrder.id), { preserveScroll: true, onSuccess: () => { addProductForm.reset(); router.reload({ only: ['workOrder'] }); } });
const submitService = () => addServiceForm.post(route('work-orders.services.add', props.workOrder.id), { preserveScroll: true, onSuccess: () => { addServiceForm.reset(); router.reload({ only: ['workOrder'] }); } });
const submitExternalCost = () => addExternalCostForm.post(route('work-orders.external-costs.add', props.workOrder.id), { preserveScroll: true, onSuccess: () => { addExternalCostForm.reset(); router.reload({ only: ['workOrder'] }); } });
const submitMechanicAssignment = () => assignMechanicForm.patch(route('work-orders.assign-mechanic', props.workOrder.id), { preserveState: true, preserveScroll: true });

// --- LÓGICA PARA MODALES DE CONFIRMACIÓN (REFACTORIZADA) ---
const confirmingAction = ref(false);
const actionToConfirm = ref({}); // Objeto para guardar la configuración completa del modal

// Función genérica para abrir el modal con una configuración específica
const setupConfirmation = (config) => {
    actionToConfirm.value = config;
    confirmingAction.value = true;
};

const confirmItemDeletion = (item, type) => {
    let routeName = '';
    let params = {};
    let itemName = '';

    if (type === 'product') {
        routeName = 'work-orders.products.remove';
        params = { workOrder: props.workOrder.id, product: item.id };
        itemName = item.name;
    } else if (type === 'service') {
        routeName = 'work-orders.services.remove';
        params = { workOrder: props.workOrder.id, service: item.id };
        itemName = item.name;
    } else if (type === 'externalCost') {
        routeName = 'work-orders.external-costs.remove';
        params = { externalCost: item.id };
        itemName = item.description;
    }

    setupConfirmation({
        title: 'Quitar Ítem',
        message: `¿Estás seguro de que deseas quitar "${itemName}" de la orden de trabajo?`,
        confirmButtonText: 'Sí, Quitar',
        confirmButtonClass: 'bg-red-600 hover:bg-red-700',
        method: () => router.delete(route(routeName, params), {
            onSuccess: () => closeModal(),
            preserveScroll: true,
        })
    });
};

const confirmStatusChange = (status) => {
    let config = {};
    if (status === 'Completada') {
        config = {
            title: 'Completar Orden de Trabajo',
            message: '¿Estás seguro de que deseas marcar esta orden como "Completada"? Ya no podrás realizar modificaciones.',
            confirmButtonText: 'Sí, Completar',
            confirmButtonClass: 'bg-green-600 hover:bg-green-700',
        };
    } else if (status === 'Cancelada') {
        config = {
            title: 'Cancelar Orden de Trabajo',
            message: '¿Estás seguro de que deseas cancelar esta orden? Si se utilizaron productos del inventario, el stock será devuelto.',
            confirmButtonText: 'Sí, Cancelar Orden',
            confirmButtonClass: 'bg-orange-600 hover:bg-orange-700',
        };
    }

    config.method = () => router.patch(route('work-orders.update', props.workOrder.id), { status: status }, {
        onSuccess: () => closeModal(),
        preserveScroll: true,
    });

    setupConfirmation(config);
};

const closeModal = () => confirmingAction.value = false;
</script>

<template>

    <Head :title="`Orden de Trabajo #${workOrder.id}`" />

    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Detalle de Orden de Trabajo #{{
                    workOrder.id }}</h2>
                <Link :href="route('work-orders.index')" class="text-sm text-gray-700 underline">&larr; Volver al
                listado</Link>
            </div>
        </template>

        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8 grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Columna Izquierda: Detalles e Items -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Mensaje de Advertencia si está Finalizada -->
                    <div v-if="isFinalized" class="p-4 rounded-md"
                        :class="workOrder.status === 'Completada' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                        <p class="font-bold">Esta orden de trabajo está {{ workOrder.status.toLowerCase() }} y ya no
                            puede ser
                            modificada.</p>
                    </div>

                    <!-- Productos del Inventario -->
                    <div class="bg-white shadow sm:rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 border-b pb-2 mb-4">Productos del Inventario</h3>
                        <form v-if="!isFinalized && can('gestionar ordenes de trabajo')" @submit.prevent="submitProduct"
                            class="flex gap-4 items-end mb-4">
                            <div class="flex-1"><label
                                    class="block text-sm font-medium text-gray-700">Producto</label><select
                                    v-model="addProductForm.product_id"
                                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm text-sm">
                                    <option :value="null" disabled>Selecciona un producto</option>
                                    <option v-for="product in products" :key="product.id" :value="product.id">{{
                                        product.name }}
                                        (Stock: {{ product.current_stock }})</option>
                                </select>
                                <div v-if="addProductForm.errors.product_id" class="text-sm text-red-600 mt-1">{{
                                    addProductForm.errors.product_id }}</div>
                            </div>
                            <div><label class="block text-sm font-medium text-gray-700">Cantidad</label><input
                                    type="number" v-model="addProductForm.quantity"
                                    class="mt-1 block w-24 border-gray-300 rounded-md shadow-sm text-sm" />
                                <div v-if="addProductForm.errors.quantity" class="text-sm text-red-600 mt-1">{{
                                    addProductForm.errors.quantity }}</div>
                            </div>
                            <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md h-fit text-sm"
                                :disabled="addProductForm.processing">Agregar</button>
                        </form>
                        <table v-if="workOrder.products && workOrder.products.length > 0" class="w-full text-sm">
                            <tbody>
                                <tr v-for="product in workOrder.products" :key="`prod-${product.id}`" class="border-b">
                                    <td class="py-2">
                                        {{ product.name }}
                                        <span v-if="product.deleted_at"
                                            class="ml-2 text-xs text-red-500 bg-red-100 px-2 py-1 rounded-full">Archivado</span>
                                    </td>
                                    <td class="py-2 text-center">{{ product.pivot.quantity }} x ${{
                                        product.pivot.unit_price }}
                                    </td>
                                    <td class="py-2 text-right font-bold">${{ (product.pivot.quantity *
                                        product.pivot.unit_price).toFixed(2) }}</td>
                                    <td v-if="!isFinalized && can('gestionar ordenes de trabajo')"
                                        class="py-2 text-right pl-4">
                                        <button @click="confirmItemDeletion(product, 'product')"
                                            class="text-red-500 hover:text-red-700 text-xs">Quitar</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <p v-else class="text-sm text-gray-500 italic">No hay productos agregados a esta orden.</p>
                    </div>

                    <!-- Servicios (Mano de Obra) -->
                    <div class="bg-white shadow sm:rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 border-b pb-2 mb-4">Servicios (Mano de Obra)</h3>
                        <form v-if="!isFinalized && can('gestionar ordenes de trabajo')" @submit.prevent="submitService"
                            class="flex gap-4 items-end mb-4">
                            <div class="flex-1"><label
                                    class="block text-sm font-medium text-gray-700">Servicio</label><select
                                    v-model="addServiceForm.service_id"
                                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm text-sm">
                                    <option :value="null" disabled>Selecciona un servicio</option>
                                    <option v-for="service in services" :key="service.id" :value="service.id">{{
                                        service.name }}
                                    </option>
                                </select></div>
                            <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md h-fit text-sm"
                                :disabled="addServiceForm.processing">Agregar</button>
                        </form>
                        <table v-if="workOrder.services && workOrder.services.length > 0" class="w-full text-sm">
                            <tbody>
                                <tr v-for="service in workOrder.services" :key="`serv-${service.id}`" class="border-b">
                                    <td class="py-2">{{ service.name }}</td>
                                    <td class="py-2 text-right font-bold">${{ service.pivot.price }}</td>
                                    <td v-if="!isFinalized && can('gestionar ordenes de trabajo')"
                                        class="py-2 text-right pl-4">
                                        <button @click="confirmItemDeletion(service, 'service')"
                                            class="text-red-500 hover:text-red-700 text-xs">Quitar</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <p v-else class="text-sm text-gray-500 italic">No hay servicios agregados a esta orden.</p>
                    </div>

                    <!-- Costos Externos -->
                    <div class="bg-white shadow sm:rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 border-b pb-2 mb-4">Costos Externos</h3>
                        <form v-if="!isFinalized && can('gestionar ordenes de trabajo')"
                            @submit.prevent="submitExternalCost" class="space-y-4 mb-4">
                            <div><label for="ext-desc"
                                    class="block text-sm font-medium text-gray-700">Descripción</label><input
                                    id="ext-desc" type="text" placeholder="Ej: Repuesto comprado por fuera"
                                    v-model="addExternalCostForm.description"
                                    class="mt-1 block w-full border-gray-300 rounded-md shadow-sm text-sm" required />
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div><label for="ext-cost" class="block text-sm font-medium text-gray-700">Costo
                                        ($)</label><input id="ext-cost" type="number" step="0.01"
                                        placeholder="Lo que costó" v-model="addExternalCostForm.cost"
                                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm text-sm"
                                        required /></div>
                                <div><label for="ext-price" class="block text-sm font-medium text-gray-700">Precio Venta
                                        ($)</label><input id="ext-price" type="number" step="0.01"
                                        placeholder="A cobrar al cliente" v-model="addExternalCostForm.price"
                                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm text-sm"
                                        required /></div>
                            </div>
                            <button type="submit" class="px-4 py-2 bg-gray-800 text-white rounded-md w-full text-sm"
                                :disabled="addExternalCostForm.processing">Agregar Costo Externo</button>
                        </form>
                        <table v-if="workOrder.external_costs && workOrder.external_costs.length > 0"
                            class="w-full text-sm">
                            <tbody>
                                <tr v-for="cost in workOrder.external_costs" :key="`ext-${cost.id}`" class="border-b">
                                    <td class="py-2">{{ cost.description }}</td>
                                    <td class="py-2 text-right font-bold">${{ cost.price }}</td>
                                    <td v-if="!isFinalized && can('gestionar ordenes de trabajo')"
                                        class="py-2 text-right pl-4">
                                        <button @click="confirmItemDeletion(cost, 'externalCost')"
                                            class="text-red-500 hover:text-red-700 text-xs">Quitar</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <p v-else class="text-sm text-gray-500 italic">No hay costos externos agregados a esta orden.
                        </p>
                    </div>
                </div>

                <!-- Columna Derecha: Estado y Total -->
                <div class="lg:col-span-1 space-y-6">
                    <div class="bg-white shadow sm:rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Detalles de la Orden</h3>
                        <div class="space-y-2 text-sm">
                            <p><strong>Cliente:</strong> {{ workOrder.vehicle.cliente.nombre }} {{
                                workOrder.vehicle.cliente.apellido }}</p>
                            <p><strong>Vehículo:</strong> {{ workOrder.vehicle.marca }} {{ workOrder.vehicle.modelo }}
                                ({{
                                    workOrder.vehicle.patente }})</p>
                            <p><strong>Fecha Ingreso:</strong> {{ formatDate(workOrder.entry_date) }}</p>
                            <p><strong>Descripción:</strong> {{ workOrder.description }}</p>
                        </div>
                    </div>
                    <div class="bg-white shadow sm:rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Asignar Mecánico</h3>
                        <form @submit.prevent="submitMechanicAssignment"><select
                                v-model="assignMechanicForm.mechanic_id" @change="submitMechanicAssignment"
                                class="block w-full border-gray-300 rounded-md shadow-sm text-sm">
                                <option :value="null">Sin asignar</option>
                                <option v-for="mechanic in mechanics" :key="mechanic.id" :value="mechanic.id">{{
                                    mechanic.name
                                    }}</option>
                            </select></form>
                        <p class="text-sm mt-4"><strong>Estado Actual: </strong><span
                                class="px-2 py-1 font-semibold leading-tight text-xs rounded-full"
                                :class="{ 'bg-yellow-100 text-yellow-800': workOrder.status === 'Pendiente', 'bg-blue-100 text-blue-800': workOrder.status === 'En Progreso', 'bg-green-100 text-green-800': workOrder.status === 'Completada', 'bg-red-100 text-red-800': workOrder.status === 'Cancelada' }">{{
                                    workOrder.status }}</span></p>
                    </div>
                    <!-- Panel de Acciones de la Orden -->
                    <div v-if="!isFinalized && can('gestionar ordenes de trabajo')"
                        class="bg-white shadow sm:rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Acciones de la Orden</h3>
                        <div class="space-y-4">
                            <button @click="confirmStatusChange('Completada')"
                                class="w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold text-sm">Marcar
                                como Completada</button>
                            <button @click="confirmStatusChange('Cancelada')"
                                class="w-full px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 font-semibold text-sm">Marcar
                                como Cancelada</button>
                        </div>
                    </div>
                    <div class="bg-white shadow sm:rounded-lg p-6 text-right">
                        <h3 class="text-lg font-medium text-gray-900">Total de la Orden</h3>
                        <p class="text-4xl font-extrabold text-gray-900 mt-2">${{ parseFloat(workOrder.total ||
                            0).toFixed(2) }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <ConfirmationModal :show="confirmingAction" @close="closeModal" @confirm="actionToConfirm.method"
            :title="actionToConfirm.title" :message="actionToConfirm.message"
            :confirm-button-text="actionToConfirm.confirmButtonText"
            :confirm-button-class="actionToConfirm.confirmButtonClass" />
    </AuthenticatedLayout>
</template>
</file>

<file path="src/Core/routes/web.php">
<?php

use App\Http\Controllers\ProfileController;
use Illuminate\Foundation\Application;
use Illuminate\Support\Facades\Route;
use Inertia\Inertia;

/*
|--------------------------------------------------------------------------
| Rutas del Módulo Core
|--------------------------------------------------------------------------
|
| Este archivo contiene las rutas fundamentales de la aplicación, como la
| página de bienvenida, el dashboard principal y la gestión de perfiles.
| Todas estas rutas se cargan a través del CoreServiceProvider.
|
*/

// --- Ruta de Bienvenida (Pública) ---
Route::get('/', function () {
    return Inertia::render('Welcome', [
        'canLogin' => Route::has('login'),
        'canRegister' => Route::has('register'),
        'laravelVersion' => Application::VERSION,
        'phpVersion' => PHP_VERSION,
    ]);
});

// --- Ruta del Dashboard Principal (Accesible para cualquier usuario autenticado) ---
Route::get('/dashboard', function () {
    return Inertia::render('Dashboard');
})->middleware(['auth', 'verified', 'role:Admin'])->name('dashboard');

// --- Rutas de Gestión de Perfil (Accesible para cualquier usuario autenticado) ---
Route::middleware('auth')->group(function () {
    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');
    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');
});

// --- Inclusión de las Rutas de Autenticación (Login, Registro, etc.) ---
require __DIR__.'/../../../routes/auth.php';
</file>

<file path="src/Crm/Http/Controllers/VehiculoController.php">
<?php

namespace FlipperBox\Crm\Http\Controllers;

use App\Http\Controllers\Controller;
use App\Models\User;
use FlipperBox\Crm\Http\Requests\UpdateVehiculoRequest;
use FlipperBox\Crm\Models\Vehiculo;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Validation\ValidationException;
use Inertia\Inertia;
use Inertia\Response;

class VehiculoController extends Controller
{
    /**
     * Muestra el formulario para crear un nuevo vehículo para un cliente (User).
     */
    public function create(User $user): Response
    {
        abort_if(!$user->hasRole('Cliente'), 404);

        return Inertia::render('Crm/Vehiculos/Create', [
            'cliente' => $user,
        ]);
    }

    /**
     * Almacena un nuevo vehículo y lo asocia a un cliente (User).
     */
    public function store(Request $request, User $user): RedirectResponse
    {
        abort_if(!$user->hasRole('Cliente'), 404);

        $validated = $request->validate([
            'patente' => ['required', 'string', 'max:255', 'unique:vehiculos,patente'],
            'marca' => ['required', 'string', 'max:255'],
            'modelo' => ['required', 'string', 'max:255'],
            'anio' => ['required', 'integer', 'min:1950', 'max:' . date('Y')],
            'kilometraje' => ['nullable', 'integer', 'min:0'],
            'vin' => ['nullable', 'string', 'max:255', 'unique:vehiculos,vin'],
            'numero_motor' => ['nullable', 'string', 'max:255'],
            'observaciones' => ['nullable', 'string'],
        ]);

        // Creamos el vehículo a través de la relación definida en el modelo User
        $user->vehiculos()->create($validated);

        return to_route('clientes.show', $user->id)->with('success', 'Vehículo agregado exitosamente.');
    }

    /**
     * Muestra el formulario para editar un vehículo.
     * El Model-Route Binding se encarga de que $user y $vehiculo sean los correctos.
     */
    public function edit(User $user, Vehiculo $vehiculo): Response
    {
        abort_if(!$user->hasRole('Cliente'), 404);

        return Inertia::render('Crm/Vehiculos/Edit', [
            'cliente' => $user,
            'vehiculo' => $vehiculo,
        ]);
    }

    /**
     * Actualiza un vehículo existente.
     */
    public function update(UpdateVehiculoRequest $request, User $user, Vehiculo $vehiculo): RedirectResponse
    {
        $vehiculo->update($request->validated());
        return to_route('clientes.show', $user->id)->with('success', 'Vehículo actualizado exitosamente.');
    }

    /**
     * Elimina (Soft Delete) un vehículo.
     */
    public function destroy(User $user, Vehiculo $vehiculo): RedirectResponse
    {
        try {
            $vehiculo->delete();
        } catch (ValidationException $e) {
            return back()->with('error', $e->validator->errors()->first());
        }
        return to_route('clientes.show', $user->id)->with('success', 'Vehículo eliminado exitosamente.');
    }
}
</file>

<file path="src/Crm/Models/Vehiculo.php">
<?php

namespace FlipperBox\Crm\Models;

use App\Models\User; 
use Database\Factories\VehiculoFactory;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\SoftDeletes;
use FlipperBox\WorkManagement\Models\WorkOrder;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Vehiculo extends Model
{
    use HasFactory, SoftDeletes;

    protected $table = 'vehiculos';

    protected $fillable = [
        'cliente_id',
        'patente',
        'marca',
        'modelo',
        'anio',
        'kilometraje',
        'vin', // Número de chasis
        'numero_motor',
        'observaciones',
    ];

    /**
     * Define la relación: Un vehículo pertenece a un cliente.
     */
    public function cliente(): BelongsTo
    {
        return $this->belongsTo(User::class, 'user_id');
    }

    /**
     * Crea una nueva instancia de la factory para el modelo.
     */
    protected static function newFactory()
    {
        return VehiculoFactory::new();
    }

    public function workOrders(): HasMany
    {
        return $this->hasMany(WorkOrder::class, 'vehicle_id'); 
    }
}
</file>

<file path="src/Inventory/routes/web.php">
<?php

use FlipperBox\Inventory\Http\Controllers\ProductController;
use FlipperBox\Inventory\Http\Controllers\SupplierController;
use Illuminate\Support\Facades\Route;

// Rutas para Productos
Route::middleware('can:ver inventario')->prefix('inventario')->name('inventario.')->group(function () {
    Route::get('/productos', [ProductController::class, 'index'])->name('products.index');
    
    Route::middleware('can:gestionar inventario')->group(function() {
        Route::get('/productos/crear', [ProductController::class, 'create'])->name('products.create');
        Route::post('/productos', [ProductController::class, 'store'])->name('products.store');
        Route::get('/productos/{product}/editar', [ProductController::class, 'edit'])->name('products.edit');
        Route::patch('/productos/{product}', [ProductController::class, 'update'])->name('products.update');
        Route::delete('/productos/{product}', [ProductController::class, 'destroy'])->name('products.destroy');
    });
});

// Rutas para Proveedores
Route::prefix('inventario')->name('inventario.')->group(function () {
    Route::get('/proveedores', [SupplierController::class, 'index'])->middleware('can:ver proveedores')->name('suppliers.index');
    
    Route::middleware('can:gestionar proveedores')->group(function() {
        Route::get('/proveedores/crear', [SupplierController::class, 'create'])->name('suppliers.create');
        Route::post('/proveedores', [SupplierController::class, 'store'])->name('suppliers.store');
        Route::get('/proveedores/{supplier}/editar', [SupplierController::class, 'edit'])->name('suppliers.edit');
        Route::patch('/proveedores/{supplier}', [SupplierController::class, 'update'])->name('suppliers.update');
        Route::delete('/proveedores/{supplier}', [SupplierController::class, 'destroy'])->name('suppliers.destroy');
    });
});
</file>

<file path="config/app.php">
<?php

return [

    /*
    |--------------------------------------------------------------------------
    | Application Name
    |--------------------------------------------------------------------------
    |
    | This value is the name of your application, which will be used when the
    | framework needs to place the application's name in a notification or
    | other UI elements where an application name needs to be displayed.
    |
    */

    'name' => env('APP_NAME', 'Laravel'),

    /*
    |--------------------------------------------------------------------------
    | Application Environment
    |--------------------------------------------------------------------------
    |
    | This value determines the "environment" your application is currently
    | running in. This may determine how you prefer to configure various
    | services the application utilizes. Set this in your ".env" file.
    |
    */

    'env' => env('APP_ENV', 'production'),

    /*
    |--------------------------------------------------------------------------
    | Application Debug Mode
    |--------------------------------------------------------------------------
    |
    | When your application is in debug mode, detailed error messages with
    | stack traces will be shown on every error that occurs within your
    | application. If disabled, a simple generic error page is shown.
    |
    */

    'debug' => (bool) env('APP_DEBUG', false),

    /*
    |--------------------------------------------------------------------------
    | Application URL
    |--------------------------------------------------------------------------
    |
    | This URL is used by the console to properly generate URLs when using
    | the Artisan command line tool. You should set this to the root of
    | the application so that it's available within Artisan commands.
    |
    */

    'url' => env('APP_URL', 'http://localhost'),

    /*
    |--------------------------------------------------------------------------
    | Application Timezone
    |--------------------------------------------------------------------------
    |
    | Here you may specify the default timezone for your application, which
    | will be used by the PHP date and date-time functions. The timezone
    | is set to "UTC" by default as it is suitable for most use cases.
    |
    */

    'timezone' => 'America/Argentina/Buenos_Aires',

    /*
    |--------------------------------------------------------------------------
    | Application Locale Configuration
    |--------------------------------------------------------------------------
    |
    | The application locale determines the default locale that will be used
    | by Laravel's translation / localization methods. This option can be
    | set to any locale for which you plan to have translation strings.
    |
    */

    'locale' => env('APP_LOCALE', 'en'),

    'fallback_locale' => env('APP_FALLBACK_LOCALE', 'en'),

    'faker_locale' => env('APP_FAKER_LOCALE', 'en_US'),

    /*
    |--------------------------------------------------------------------------
    | Encryption Key
    |--------------------------------------------------------------------------
    |
    | This key is utilized by Laravel's encryption services and should be set
    | to a random, 32 character string to ensure that all encrypted values
    | are secure. You should do this prior to deploying the application.
    |
    */

    'cipher' => 'AES-256-CBC',

    'key' => env('APP_KEY'),

    'previous_keys' => [
        ...array_filter(
            explode(',', (string) env('APP_PREVIOUS_KEYS', ''))
        ),
    ],

    /*
    |--------------------------------------------------------------------------
    | Maintenance Mode Driver
    |--------------------------------------------------------------------------
    |
    | These configuration options determine the driver used to determine and
    | manage Laravel's "maintenance mode" status. The "cache" driver will
    | allow maintenance mode to be controlled across multiple machines.
    |
    | Supported drivers: "file", "cache"
    |
    */

    'maintenance' => [
        'driver' => env('APP_MAINTENANCE_DRIVER', 'file'),
        'store' => env('APP_MAINTENANCE_STORE', 'database'),
    ],

    /*
    |--------------------------------------------------------------------------
    | Autoloaded Service Providers
    |--------------------------------------------------------------------------
    |
    | The service providers listed here will be automatically loaded on the
    | request to your application. Feel free to add your own services to
    | this array to grant expanded functionality to your applications.
    |
    */

    'providers' => [

        /*
         * Laravel Framework Service Providers...
         */
        Illuminate\Auth\AuthServiceProvider::class,
        Illuminate\Broadcasting\BroadcastServiceProvider::class,
        Illuminate\Bus\BusServiceProvider::class,
        Illuminate\Cache\CacheServiceProvider::class,
        Illuminate\Foundation\Providers\ConsoleSupportServiceProvider::class,
        Illuminate\Cookie\CookieServiceProvider::class,
        Illuminate\Database\DatabaseServiceProvider::class,
        Illuminate\Encryption\EncryptionServiceProvider::class,
        Illuminate\Filesystem\FilesystemServiceProvider::class,
        Illuminate\Foundation\Providers\FoundationServiceProvider::class,
        Illuminate\Hashing\HashServiceProvider::class,
        Illuminate\Mail\MailServiceProvider::class,
        Illuminate\Notifications\NotificationServiceProvider::class,
        Illuminate\Pagination\PaginationServiceProvider::class,
        Illuminate\Pipeline\PipelineServiceProvider::class,
        Illuminate\Queue\QueueServiceProvider::class,
        Illuminate\Redis\RedisServiceProvider::class,
        Illuminate\Auth\Passwords\PasswordResetServiceProvider::class,
        Illuminate\Session\SessionServiceProvider::class,
        Illuminate\Translation\TranslationServiceProvider::class,
        Illuminate\Validation\ValidationServiceProvider::class,
        Illuminate\View\ViewServiceProvider::class,

        /*
         * Package Service Providers...
         */

        /*
         * Application Service Providers...
         */
        App\Providers\AppServiceProvider::class,
        //App\Providers\AuthServiceProvider::class,
        // App\Providers\BroadcastServiceProvider::class,
        //App\Providers\EventServiceProvider::class,
        //App\Providers\RouteServiceProvider::class,
        
        /*
         * Módulos de la Aplicación FlipperBox
         */
        // FlipperBox\Core\Providers\CoreServiceProvider::class,
        // FlipperBox\Crm\Providers\CrmServiceProvider::class,
        // FlipperBox\MechanicPanel\Providers\MechanicPanelServiceProvider::class,

    ],

];
</file>

<file path="src/WorkManagement/Http/Controllers/WorkOrderController.php">
<?php

namespace FlipperBox\WorkManagement\Http\Controllers;

use App\Http\Controllers\Controller;
use App\Models\User;
use FlipperBox\Crm\Models\Vehiculo;
use FlipperBox\Inventory\Models\Product;
use FlipperBox\WorkManagement\Models\ExternalCost;
use FlipperBox\WorkManagement\Models\Service;
use FlipperBox\WorkManagement\Models\WorkOrder;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;
use Illuminate\Validation\Rule;
use Illuminate\Validation\ValidationException;
use Inertia\Inertia;
use Inertia\Response;

class WorkOrderController extends Controller
{
    public function index(): Response
    {
        // La relación 'vehicle.cliente' ahora es 'vehicle.user' debido a la refactorización
        $workOrders = WorkOrder::with(['vehicle.cliente', 'mechanic'])->latest('entry_date')->paginate(15);
        return Inertia::render('WorkManagement/Index', ['workOrders' => $workOrders]);
    }

    public function create(Vehiculo $vehiculo): Response
    {
        // La relación 'cliente' ahora es 'user'
        return Inertia::render('WorkManagement/Create', ['vehiculo' => $vehiculo->load('cliente')]);
    }

    public function store(Request $request): RedirectResponse
    {
        $validated = $request->validate(['vehicle_id' => ['required', 'exists:vehiculos,id'], 'description' => ['required', 'string']]);
        $workOrder = WorkOrder::create($validated);
        return to_route('work-orders.show', $workOrder->id)->with('success', 'Orden de Trabajo creada exitosamente.');
    }

    public function show(WorkOrder $workOrder): Response
    {
        $workOrder->load(['vehicle.cliente', 'mechanic', 'products', 'services', 'externalCosts']);
        $mechanics = User::role('Mecanico')->orderBy('name')->get(['id', 'name']);

        return Inertia::render('WorkManagement/Show', [
            'workOrder' => $workOrder,
            'products' => Product::orderBy('name')->get(['id', 'name', 'price', 'current_stock']),
            'services' => Service::orderBy('name')->get(['id', 'name', 'price']),
            'mechanics' => $mechanics,
        ]);
    }

    /**
     * Actualiza el estado de una Orden de Trabajo.
     */
    public function update(Request $request, WorkOrder $workOrder): RedirectResponse
    {
        $validated = $request->validate([
            'status' => ['required', Rule::in(['En Progreso', 'Completada', 'Cancelada'])],
        ]);

        if ($workOrder->status === 'Completada' && $validated['status'] !== 'Cancelada') {
            return back()->with('error', 'Una orden completada solo puede ser cancelada.');
        }

        $originalStatus = $workOrder->status;
        $workOrder->status = $validated['status'];

        if ($validated['status'] === 'Completada') {
            $workOrder->completion_date = now();
        }

        // Si se cancela una orden que tenía productos, el Observer se encargará de devolver el stock.
        if ($originalStatus !== 'Cancelada' && $validated['status'] === 'Cancelada') {
            // La lógica de devolución de stock se ha movido al WorkOrderObserver en el evento 'updating'.
            // Aquí solo guardamos el cambio de estado.
        }

        $workOrder->save();

        return back()->with('success', 'Estado de la orden actualizado.');
    }

    /**
     * Elimina (Soft Delete) una Orden de Trabajo.
     */
    public function destroy(WorkOrder $workOrder): RedirectResponse
    {
        if ($workOrder->status === 'Completada') {
            return to_route('work-orders.index')->with('error', 'No se puede eliminar una orden de trabajo completada.');
        }

        $workOrder->delete(); // El Observer se encargará de devolver el stock

        return to_route('work-orders.index')->with('success', 'Orden de trabajo eliminada exitosamente.');
    }

    // --- MÉTODOS PARA AÑADIR ÍTEMS ---
    public function addProduct(Request $request, WorkOrder $workOrder): RedirectResponse
    {
        $validated = $request->validate(['product_id' => ['required', 'exists:products,id'], 'quantity' => ['required', 'integer', 'min:1']]);
        DB::transaction(function () use ($validated, $workOrder) {
            $product = Product::lockForUpdate()->find($validated['product_id']);
            if ($product->current_stock < $validated['quantity']) {
                throw ValidationException::withMessages(['quantity' => 'Stock insuficiente. Stock actual: ' . $product->current_stock]);
            }
            $product->decrement('current_stock', $validated['quantity']);
            $existingProduct = $workOrder->products()->where('product_id', $product->id)->first();
            if ($existingProduct) {
                $newQuantity = $existingProduct->pivot->quantity + $validated['quantity'];
                $workOrder->products()->updateExistingPivot($product->id, ['quantity' => $newQuantity]);
            } else {
                $workOrder->products()->attach($product->id, ['quantity' => $validated['quantity'], 'unit_price' => $product->price]);
            }
            $this->recalculateTotal($workOrder);
        });
        return to_route('work-orders.show', $workOrder->id)->with('success', 'Producto agregado.');
    }

    public function addService(Request $request, WorkOrder $workOrder): RedirectResponse
    {
        $validated = $request->validate(['service_id' => ['required', 'exists:services,id']]);
        $service = Service::find($validated['service_id']);
        if (!$workOrder->services()->where('service_id', $service->id)->exists()) {
            $workOrder->services()->attach($service->id, ['price' => $service->price]);
            $this->recalculateTotal($workOrder);
        }
        return to_route('work-orders.show', $workOrder->id)->with('success', 'Servicio agregado.');
    }

    public function addExternalCost(Request $request, WorkOrder $workOrder): RedirectResponse
    {
        $validated = $request->validate([
            'description' => ['required', 'string', 'max:255'],
            'cost' => ['required', 'numeric', 'min:0'],
            'price' => ['required', 'numeric', 'min:0']
        ]);
        $workOrder->externalCosts()->create($validated);
        $workOrder->load('externalCosts');
        $this->recalculateTotal($workOrder);
        return to_route('work-orders.show', $workOrder->id)->with('success', 'Costo externo agregado.');
    }

    // --- MÉTODO PARA ASIGNAR MECÁNICO ---
    public function assignMechanic(Request $request, WorkOrder $workOrder): RedirectResponse
    {
        $validated = $request->validate(['mechanic_id' => ['nullable', 'exists:users,id']]);
        $workOrder->update([
            'mechanic_id' => $validated['mechanic_id'],
            'status' => $workOrder->status === 'Pendiente' && $validated['mechanic_id'] ? 'En Progreso' : $workOrder->status
        ]);
        return to_route('work-orders.show', $workOrder->id)->with('success', 'Mecánico asignado/actualizado.');
    }

    // --- MÉTODOS PARA ELIMINAR ÍTEMS ---
    public function removeProduct(WorkOrder $workOrder, Product $product): RedirectResponse
    {
        DB::transaction(function () use ($workOrder, $product) {
            $pivot = DB::table('work_order_product')->where('work_order_id', $workOrder->id)->where('product_id', $product->id)->first();
            if ($pivot) {
                $productToUpdate = Product::lockForUpdate()->find($product->id);
                $productToUpdate->increment('current_stock', $pivot->quantity);
                $workOrder->products()->detach($product->id);
                $this->recalculateTotal($workOrder);
            }
        });
        return to_route('work-orders.show', $workOrder->id)->with('success', 'Producto eliminado de la orden.');
    }

    public function removeService(WorkOrder $workOrder, Service $service): RedirectResponse
    {
        $workOrder->services()->detach($service->id);
        $this->recalculateTotal($workOrder);
        return to_route('work-orders.show', $workOrder->id)->with('success', 'Servicio eliminado de la orden.');
    }

    public function removeExternalCost(ExternalCost $externalCost): RedirectResponse
    {
        $workOrder = $externalCost->workOrder;
        $externalCost->delete();
        $workOrder->load('externalCosts');
        $this->recalculateTotal($workOrder);
        return to_route('work-orders.show', $workOrder->id)->with('success', 'Costo externo eliminado de la orden.');
    }

    // --- MÉTODO PRIVADO PARA RECALCULAR TOTALES ---
    private function recalculateTotal(WorkOrder $workOrder)
    {
        $workOrder->load(['products', 'services', 'externalCosts']);
        $totalProducts = $workOrder->products->sum(fn($p) => $p->pivot->unit_price * $p->pivot->quantity);
        $totalServices = $workOrder->services->sum('pivot.price');
        $totalExternalCosts = $workOrder->externalCosts->sum('price');
        $workOrder->total = $totalProducts + $totalServices + $totalExternalCosts;
        $workOrder->save();
    }
}
</file>

<file path="resources/js/Components/Sidebar.vue">
<script setup>
import { Link, usePage } from '@inertiajs/vue3';
import ApplicationLogo from '@/Components/ApplicationLogo.vue';
import { ref } from 'vue';

// Definimos la estructura de nuestra navegación en un solo lugar
const navigationLinks = ref([
    { name: 'Dashboard', href: route('dashboard'), permission: null }, // Sin permiso, visible para todos
    { name: 'Clientes', href: route('clientes.index'), permission: 'ver clientes' },
    { name: 'Productos', href: route('inventario.products.index'), permission: 'ver inventario' },
    { name: 'Proveedores', href: route('inventario.suppliers.index'), permission: 'ver proveedores' },
    { name: 'Órdenes de Trabajo', href: route('work-orders.index'), permission: 'ver ordenes de trabajo' },
    { name: 'Gestión de Cupos', href: route('admin.scheduling.capacities.index'), permission: 'gestionar cupos' },
    { name: 'Mis Vehículos', href: route('cliente.vehiculos.index'), permission: 'ver mis vehiculos' },
    // Aquí añadiremos más enlaces en el futuro (Turnos, etc.)
]);

// Creamos una función helper para verificar permisos
const can = (permission) => {
    if (!permission) return true; // Si el enlace no requiere permiso, siempre se muestra
    return usePage().props.auth.user.permissions.includes(permission);
};
</script>

<template>
    <div class="flex flex-col w-64 py-4 px-4 bg-white border-r">
        <!-- Logo -->
        <div class="flex items-center justify-center mb-6">
            <Link :href="route('dashboard')">
                <ApplicationLogo class="block h-12 w-auto" />
            </Link>
        </div>
        
        <!-- Links de Navegación (Ahora generados dinámicamente) -->
        <nav class="flex-1">
            <template v-for="link in navigationLinks" :key="link.name">
                <!-- Usamos v-if con nuestra función 'can' para mostrar/ocultar el enlace -->
                <Link
                    v-if="can(link.permission)"
                    :href="link.href"
                    :class="{
                        'bg-gray-100 text-gray-900': $page.url.startsWith(link.href.substring(link.href.lastIndexOf('/'))),
                        'text-gray-600 hover:bg-gray-100 hover:text-gray-900': !$page.url.startsWith(link.href.substring(link.href.lastIndexOf('/')))
                    }"
                    class="flex items-center px-4 py-2 mt-2 transition-colors duration-300 transform rounded-md"
                >
                    <span class="mx-4 font-medium">{{ link.name }}</span>
                </Link>
            </template>
        </nav>
    </div>
</template>
</file>

<file path="src/Inventory/Http/Controllers/ProductController.php">
<?php

namespace FlipperBox\Inventory\Http\Controllers;

use App\Http\Controllers\Controller;
use FlipperBox\Inventory\Actions\ActualizarProductoAction;
use FlipperBox\Inventory\Actions\CrearNuevoProductoAction;
use FlipperBox\Inventory\Http\Requests\StoreProductRequest;
use FlipperBox\Inventory\Http\Requests\UpdateProductRequest;
use FlipperBox\Inventory\Models\Product;
use FlipperBox\Inventory\Models\Supplier;
use Illuminate\Http\RedirectResponse;
use Illuminate\Validation\ValidationException;
use Inertia\Inertia;
use Inertia\Response;

class ProductController extends Controller
{
    public function index(): Response
    {
        return Inertia::render('Inventory/Products/Index', [
            'products' => Product::with('suppliers')->latest()->paginate(10),
        ]);
    }

    public function create(): Response
    {
        return Inertia::render('Inventory/Products/Create', [
            'suppliers' => Supplier::orderBy('name')->get(['id', 'name']),
        ]);
    }

    public function store(StoreProductRequest $request, CrearNuevoProductoAction $crearNuevoProducto): RedirectResponse
    {
        $crearNuevoProducto->execute($request->validated());
        return to_route('inventario.products.index')->with('success', 'Producto creado exitosamente.');
    }

    public function edit(Product $product): Response
    {
        // Cargamos la relación para saber qué proveedor tiene asociado
        $product->load('suppliers');

        return Inertia::render('Inventory/Products/Edit', [
            'product' => $product,
            'suppliers' => Supplier::orderBy('name')->get(['id', 'name']),
        ]);
    }

    public function update(UpdateProductRequest $request, Product $product, ActualizarProductoAction $actualizarProducto): RedirectResponse
    {
        $actualizarProducto->execute($product, $request->validated());
        return to_route('inventario.products.index')->with('success', 'Producto actualizado exitosamente.');
    }

    public function destroy(Product $product): RedirectResponse
    {
        try {
            // Esto disparará el Observer. Si falla, el catch lo manejará.
            $product->delete();
        } catch (ValidationException $e) {
            return back()->with('error', $e->validator->errors()->first('error'));
        }
        return to_route('inventario.products.index')->with('success', 'Producto eliminado exitosamente.');
    }
}
</file>

<file path="resources/js/Layouts/AuthenticatedLayout.vue">
<script setup>
import { ref } from 'vue';
import ApplicationLogo from '@/Components/ApplicationLogo.vue';
import Dropdown from '@/Components/Dropdown.vue';
import DropdownLink from '@/Components/DropdownLink.vue';
import ResponsiveNavLink from '@/Components/ResponsiveNavLink.vue';
import { Link, usePage } from '@inertiajs/vue3';
import Sidebar from '@/Components/Sidebar.vue';
import FlashMessage from '@/Components/FlashMessage.vue';

const showingNavigationDropdown = ref(false);

const navigationLinks = ref([
    { name: 'Dashboard', routeName: 'dashboard', permission: null },
    { name: 'Clientes', routeName: 'clientes.index', permission: 'ver clientes' },
    { name: 'Productos', routeName: 'inventario.products.index', permission: 'ver inventario' },
    { name: 'Proveedores', routeName: 'inventario.suppliers.index', permission: 'ver proveedores' },
    { name: 'Órdenes de Trabajo', routeName: 'work-orders.index', permission: 'ver ordenes de trabajo' },
    { name: 'Gestión de Cupos', routeName: 'admin.scheduling.capacities.index', permission: 'gestionar cupos' },
    { name: 'Mis Vehículos', routeName: 'cliente.vehiculos.index', permission: 'ver mis vehiculos' },
]);

const can = (permission) => {
    if (!permission) return true;
    return usePage().props.auth.user.permissions.includes(permission);
};
</script>

<template>
    <div class="flex h-screen bg-gray-100">
        <!-- Sidebar para Escritorio -->
        <aside class="z-20 h-full w-64 overflow-y-auto bg-white flex-shrink-0 hidden md:block">
            <Sidebar />
        </aside>

        <!-- Menú Hamburguesa para Móvil -->
        <div v-show="showingNavigationDropdown" @click="showingNavigationDropdown = false" class="fixed inset-0 z-20 bg-black opacity-50 md:hidden"></div>
        <aside 
            class="fixed inset-y-0 z-30 flex-shrink-0 w-64 overflow-y-auto bg-white md:hidden" 
            v-show="showingNavigationDropdown"
            @click.away="showingNavigationDropdown = false"
        >
            <div class="py-4 text-gray-500">
                <Link class="ml-6" href="/">
                    <ApplicationLogo class="block h-10 w-auto" />
                </Link>
            </div>
            <div class="space-y-1 pb-3 pt-2">
                <template v-for="link in navigationLinks" :key="link.name">
                    <ResponsiveNavLink 
                        v-if="can(link.permission)"
                        :href="route(link.routeName)" 
                        :active="route().current(link.routeName)"
                    >
                        {{ link.name }}
                    </ResponsiveNavLink>
                </template>
            </div>
            <div class="border-t border-gray-200 pb-1 pt-4">
                <div class="px-4">
                    <div class="text-base font-medium text-gray-800">{{ $page.props.auth.user.name }}</div>
                    <div class="text-sm font-medium text-gray-500">{{ $page.props.auth.user.email }}</div>
                </div>
                <div class="mt-3 space-y-1">
                    <ResponsiveNavLink :href="route('profile.edit')"> Perfil </ResponsiveNavLink>
                    <ResponsiveNavLink :href="route('logout')" method="post" as="button"> Cerrar Sesión </ResponsiveNavLink>
                </div>
            </div>
        </aside>

        <!-- Contenido Principal -->
        <div class="flex flex-col flex-1 w-full">
            <!-- Barra de Navegación Superior -->
            <header class="z-10 py-4 bg-white shadow-md">
                <div class="container flex items-center justify-between h-full px-6 mx-auto">
                    <button @click="showingNavigationDropdown = !showingNavigationDropdown" class="p-1 -ml-1 mr-5 rounded-md md:hidden focus:outline-none">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
                    </button>
                    <div class="flex-1"></div>
                    <div class="hidden sm:flex sm:items-center sm:ms-6">
                        <div class="ms-3 relative">
                            <Dropdown align="right" width="48">
                                <template #trigger>
                                    <span class="inline-flex rounded-md">
                                        <button type="button" class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-gray-500 bg-white hover:text-gray-700 focus:outline-none transition ease-in-out duration-150">
                                            {{ $page.props.auth.user.name }}
                                            <svg class="ms-2 -me-0.5 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                                        </button>
                                    </span>
                                </template>
                                <template #content>
                                    <DropdownLink :href="route('profile.edit')"> Perfil </DropdownLink>
                                    <DropdownLink :href="route('logout')" method="post" as="button"> Cerrar Sesión </DropdownLink>
                                </template>
                            </Dropdown>
                        </div>
                    </div>
                </div>
            </header>
            
            <FlashMessage />

            <main class="h-full overflow-y-auto">
                <header class="bg-white shadow" v-if="$slots.header">
                    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                        <slot name="header" />
                    </div>
                </header>
                <slot />
            </main>
        </div>
    </div>
</template>
</file>

<file path="resources/js/Pages/Crm/Clientes/Index.vue">
<script setup>
import AuthenticatedLayout from '@/Layouts/AuthenticatedLayout.vue';
import { Head, Link, usePage, router } from '@inertiajs/vue3';
import Pagination from '@/Components/Pagination.vue';
import ConfirmationModal from '@/Components/ConfirmationModal.vue';
import { ref } from 'vue';

defineProps({
    clientes: {
        type: Object,
        required: true,
    },
});

const can = (permission) => usePage().props.auth.user.permissions.includes(permission);

const confirmingClientDeletion = ref(false);
const clientToDelete = ref(null);

const confirmClientDeletion = (cliente) => {
    clientToDelete.value = cliente;
    confirmingClientDeletion.value = true;
};

const deleteClient = () => {
    // El parámetro de ruta ahora es 'user'
    router.delete(route('clientes.destroy', { user: clientToDelete.value.id }), {
        onSuccess: () => closeModal(),
        preserveScroll: true,
    });
};

const closeModal = () => {
    confirmingClientDeletion.value = false;
    clientToDelete.value = null;
};
</script>

<template>
    <Head title="Clientes" />
    <AuthenticatedLayout>
        <template #header>
            <div class="flex justify-between items-center">
                <h2 class="font-semibold text-xl text-gray-800 leading-tight">Gestión de Clientes</h2>
                <Link v-if="can('crear clientes')" :href="route('clientes.create')"
                    class="px-4 py-2 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition">
                Crear Nuevo Cliente
                </Link>
            </div>
        </template>
        <div class="py-12">
            <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
                <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Nombre Completo</th>
                                        <th scope="col" class="px-6 py-3">Email</th>
                                        <th scope="col" class="px-6 py-3">Teléfono</th>
                                        <th scope="col" class="px-6 py-3 text-right">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="cliente in clientes.data" :key="cliente.id"
                                        class="bg-white border-b hover:bg-gray-50">
                                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                                            <Link :href="route('clientes.show', { user: cliente.id })" class="hover:underline text-blue-600">
                                                {{ cliente.name }} {{ cliente.apellido }}
                                            </Link>
                                        </th>
                                        <td class="px-6 py-4">{{ cliente.email }}</td>
                                        <td class="px-6 py-4">{{ cliente.telefono }}</td>
                                        <td class="px-6 py-4 text-right">
                                            <Link v-if="can('editar clientes')" :href="route('clientes.edit', { user: cliente.id })" class="font-medium text-blue-600 hover:underline mr-4">Editar</Link>
                                            <button v-if="can('eliminar clientes')" @click="confirmClientDeletion(cliente)" class="font-medium text-red-600 hover:underline">Eliminar</button>
                                        </td>
                                    </tr>
                                    <tr v-if="clientes.data.length === 0">
                                        <td colspan="4" class="px-6 py-4 text-center text-gray-500">No se encontraron clientes.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div v-if="clientes.links.length > 3" class="p-6 border-t">
                        <Pagination :links="clientes.links" />
                    </div>
                </div>
            </div>
        </div>
        <!-- MODAL DE CONFIRMACIÓN -->
        <ConfirmationModal :show="confirmingClientDeletion" @close="closeModal" @confirm="deleteClient"
            title="Eliminar Cliente"
            :message="`¿Estás seguro de que deseas eliminar a ${clientToDelete?.name} ${clientToDelete?.apellido}? Esta acción no se puede deshacer.`" />
    </AuthenticatedLayout>
</template>
</file>

<file path="src/Crm/routes/web.php">
<?php

use FlipperBox\Crm\Http\Controllers\CrmController;
use FlipperBox\Crm\Http\Controllers\VehiculoController;
use Illuminate\Support\Facades\Route;

Route::middleware(['auth', 'verified'])->group(function () {
    // Rutas de Clientes (gestionan el modelo User)
    Route::get('/clientes', [CrmController::class, 'index'])->middleware('can:ver clientes')->name('clientes.index');
    Route::get('/clientes/crear', [CrmController::class, 'create'])->middleware('can:crear clientes')->name('clientes.create');
    Route::post('/clientes', [CrmController::class, 'store'])->middleware('can:crear clientes')->name('clientes.store');
    Route::get('/clientes/{user}', [CrmController::class, 'show'])->middleware('can:ver clientes')->name('clientes.show');
    Route::get('/clientes/{user}/editar', [CrmController::class, 'edit'])->middleware('can:editar clientes')->name('clientes.edit');
    Route::patch('/clientes/{user}', [CrmController::class, 'update'])->middleware('can:editar clientes')->name('clientes.update');
    Route::delete('/clientes/{user}', [CrmController::class, 'destroy'])->middleware('can:eliminar clientes')->name('clientes.destroy');

    // Rutas Anidadas para Vehículos (refactorizadas)
    Route::prefix('/clientes/{user}/vehiculos')->name('clientes.vehiculos.')->group(function () {
        Route::get('/crear', [VehiculoController::class, 'create'])->middleware('can:crear vehiculos')->name('create');
        Route::post('/', [VehiculoController::class, 'store'])->middleware('can:crear vehiculos')->name('store');
        Route::get('/{vehiculo}/editar', [VehiculoController::class, 'edit'])->middleware('can:editar vehiculos')->name('edit');
        Route::patch('/{vehiculo}', [VehiculoController::class, 'update'])->middleware('can:editar vehiculos')->name('update');
        Route::delete('/{vehiculo}', [VehiculoController::class, 'destroy'])->middleware('can:eliminar vehiculos')->name('destroy');
    });
});
</file>

<file path="bootstrap/providers.php">
<?php

return [
    App\Providers\AppServiceProvider::class,
    FlipperBox\Scheduling\Providers\SchedulingServiceProvider::class,
    FlipperBox\ClientPortal\Providers\ClientPortalServiceProvider::class,
    FlipperBox\Core\Providers\CoreServiceProvider::class,
    FlipperBox\Crm\Providers\CrmServiceProvider::class,
    FlipperBox\Inventory\Providers\InventoryServiceProvider::class,
    FlipperBox\MechanicPanel\Providers\MechanicPanelServiceProvider::class,
    FlipperBox\WorkManagement\Providers\WorkManagementServiceProvider::class,
];
</file>

<file path="composer.json">
{
    "$schema": "https://getcomposer.org/schema.json",
    "name": "laravel/laravel",
    "type": "project",
    "description": "The skeleton application for the Laravel framework.",
    "keywords": ["laravel", "framework"],
    "license": "MIT",
    "require": {
        "php": "^8.2",
        "inertiajs/inertia-laravel": "^2.0",
        "laravel/framework": "^12.0",
        "laravel/sanctum": "^4.0",
        "laravel/tinker": "^2.10.1",
        "spatie/laravel-permission": "^6.22",
        "tightenco/ziggy": "^2.0"
    },
    "require-dev": {
        "fakerphp/faker": "^1.23",
        "laravel-lang/common": "^6.7",
        "laravel/breeze": "^2.3",
        "laravel/pail": "^1.2.2",
        "laravel/pint": "^1.24",
        "laravel/sail": "^1.41",
        "mockery/mockery": "^1.6",
        "nunomaduro/collision": "^8.6",
        "phpunit/phpunit": "^11.5.3"
    },
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "FlipperBox\\Core\\": "src/Core/",
            "FlipperBox\\Crm\\": "src/Crm/",
            "FlipperBox\\MechanicPanel\\": "src/MechanicPanel/",
            "FlipperBox\\ClientPortal\\": "src/ClientPortal/",
            "FlipperBox\\Inventory\\": "src/Inventory/",
            "FlipperBox\\WorkManagement\\": "src/WorkManagement/",
            "FlipperBox\\Scheduling\\": "src/Scheduling/",
            "Database\\Factories\\": "database/factories/",
            "Database\\Seeders\\": "database/seeders/"
        }
    },
    "autoload-dev": {
        "psr-4": {
            "Tests\\": "tests/"
        }
    },
    "scripts": {
        "setup": [
            "composer install",
            "@php -r \"file_exists('.env') || copy('.env.example', '.env');\"",
            "@php artisan key:generate",
            "@php artisan migrate --force",
            "npm install",
            "npm run build"
        ],
        "dev": [
            "Composer\\Config::disableProcessTimeout",
            "npx concurrently -c \"#93c5fd,#c4b5fd,#fb7185,#fdba74\" \"php artisan serve\" \"php artisan queue:listen --tries=1\" \"php artisan pail --timeout=0\" \"npm run dev\" --names=server,queue,logs,vite --kill-others"
        ],
        "test": [
            "@php artisan config:clear --ansi",
            "@php artisan test"
        ],
        "post-autoload-dump": [
            "Illuminate\\Foundation\\ComposerScripts::postAutoloadDump",
            "@php artisan package:discover --ansi"
        ],
        "post-update-cmd": [
            "@php artisan vendor:publish --tag=laravel-assets --ansi --force"
        ],
        "post-root-package-install": [
            "@php -r \"file_exists('.env') || copy('.env.example', '.env');\""
        ],
        "post-create-project-cmd": [
            "@php artisan key:generate --ansi",
            "@php -r \"file_exists('database/database.sqlite') || touch('database/database.sqlite');\"",
            "@php artisan migrate --graceful --ansi"
        ],
        "pre-package-uninstall": [
            "Illuminate\\Foundation\\ComposerScripts::prePackageUninstall"
        ]
    },
    "extra": {
        "laravel": {
            "dont-discover": []
        }
    },
    "config": {
        "optimize-autoloader": true,
        "preferred-install": "dist",
        "sort-packages": true,
        "allow-plugins": {
            "pestphp/pest-plugin": true,
            "php-http/discovery": true
        }
    },
    "minimum-stability": "stable",
    "prefer-stable": true
}
</file>

<file path="database/seeders/DemoSeeder.php">
<?php

namespace Database\Seeders;

use FlipperBox\Crm\Models\Vehiculo;
use FlipperBox\Inventory\Models\Product;
use FlipperBox\Inventory\Models\Supplier;
use FlipperBox\WorkManagement\Models\Service;
use FlipperBox\WorkManagement\Models\WorkOrder;
use App\Models\User;
use Illuminate\Database\Seeder;
use Spatie\Permission\Models\Permission;
use Spatie\Permission\Models\Role;
use Spatie\Permission\PermissionRegistrar;

class DemoSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // Resetear roles y permisos cacheados para evitar problemas de caché
        app()[PermissionRegistrar::class]->forgetCachedPermissions();

        // Definimos el guard explícitamente para asegurar la consistencia
        $guard = 'web';

        // --- CREACIÓN DE PERMISOS ---
        $permissions = [
            'ver clientes',
            'crear clientes',
            'editar clientes',
            'eliminar clientes',
            'crear vehiculos',
            'editar vehiculos',
            'eliminar vehiculos',
            'ver inventario',
            'gestionar inventario',
            'ver proveedores',
            'gestionar proveedores',
            'ver ordenes de trabajo',
            'gestionar ordenes de trabajo',
            'ver cupos',
            'gestionar cupos',
            'ver reservas',
            'gestionar reservas',
            'ver mis vehiculos',
        ];

        foreach ($permissions as $permission) {
            Permission::create(['name' => $permission, 'guard_name' => $guard]);
        }

        // --- CREACIÓN DE ROLES ---
        $adminRole = Role::create(['name' => 'Admin', 'guard_name' => $guard]);
        $mecanicoRole = Role::create(['name' => 'Mecanico', 'guard_name' => $guard]);
        $clienteRole = Role::create(['name' => 'Cliente', 'guard_name' => $guard]);

        // --- ASIGNACIÓN DE PERMISOS A ROLES ---
        $adminRole->givePermissionTo(Permission::all());
        $mecanicoRole->givePermissionTo(['ver clientes', 'ver inventario', 'ver ordenes de trabajo', 'gestionar ordenes de trabajo']);
        // --- ASIGNACIÓN AL ROL CLIENTE ---
        $clienteRole->givePermissionTo('ver mis vehiculos');
        // --- CREACIÓN DE USUARIOS DE PRUEBA ---
        $adminUser = User::factory()->create([
            'name' => 'Administrador',
            'apellido' => 'Flipper',
            'email' => 'admin@flipperbox.com',
        ]);
        $adminUser->assignRole($adminRole);

        $mecanicoUser = User::factory()->create([
            'name' => 'Mecánico',
            'apellido' => 'de Prueba',
            'email' => 'mecanico@flipperbox.com',
        ]);
        $mecanicoUser->assignRole($mecanicoRole);

        // --- REFACTORIZACIÓN: CREACIÓN DE CLIENTES (COMO USUARIOS) Y VEHÍCULOS ---
        // Creamos 50 usuarios, les asignamos el rol 'Cliente' y luego creamos sus vehículos
        User::factory(50)
            ->create()
            ->each(function ($user) use ($clienteRole) {
                $user->assignRole($clienteRole);
                // Usamos 'make' para crear los vehículos en memoria y luego 'saveMany' para asociarlos al usuario
                $user->vehiculos()->saveMany(
                    Vehiculo::factory(fake()->numberBetween(1, 3))->make()
                );
            });

        // --- INVENTARIO REAL ---
        // 1. Creamos los Proveedores
        $hasting = Supplier::create(['name' => 'HASTING', 'contact_person' => 'Ventas Resistencia']);
        $wurth = Supplier::create(['name' => 'WURTH', 'contact_person' => 'Vendedor Juan Perez']);
        $indeser = Supplier::create(['name' => 'INDESER', 'contact_person' => 'Oficina Santa Fe']);

        // 2. Creamos los Productos
        $productosData = [
            ['name' => 'Filtro Aceite VW Gol/Trend/Fox', 'sku' => 'J3393PA', 'cost' => 85.00, 'iva_percentage' => 21, 'profit_margin' => 40, 'current_stock' => 20, 'min_threshold' => 5, 'supplier' => $hasting, 'supplier_cost' => 80.00],
            ['name' => 'Filtro Aire Renault Logan 1.6 8v', 'sku' => 'J3605PA', 'cost' => 100.00, 'iva_percentage' => 21, 'profit_margin' => 40, 'current_stock' => 15, 'min_threshold' => 5, 'supplier' => $hasting, 'supplier_cost' => 95.00],
            ['name' => 'Abrazadera Zincada 8x12x9', 'sku' => 'WURTH-ABZ-01', 'cost' => 5.50, 'iva_percentage' => 21, 'profit_margin' => 50, 'current_stock' => 100, 'min_threshold' => 20, 'supplier' => $wurth, 'supplier_cost' => 5.00],
            ['name' => 'Desengrasante 5Lts', 'sku' => 'IND-DEG-05', 'cost' => 350.00, 'iva_percentage' => 21, 'profit_margin' => 35, 'current_stock' => 10, 'min_threshold' => 2, 'supplier' => $indeser, 'supplier_cost' => 350.00],
        ];

        foreach ($productosData as $data) {
            $costWithIva = $data['cost'] * (1 + ($data['iva_percentage'] / 100));
            $price = $costWithIva * (1 + ($data['profit_margin'] / 100));
            
            $product = Product::create([
                'name' => $data['name'], 'sku' => $data['sku'], 'cost' => $data['cost'], 'iva_percentage' => $data['iva_percentage'],
                'profit_margin' => $data['profit_margin'], 'price' => round($price, 2), 'current_stock' => $data['current_stock'], 'min_threshold' => $data['min_threshold'],
            ]);

            if (isset($data['supplier'])) {
                $product->suppliers()->attach($data['supplier']->id, ['cost' => $data['supplier_cost']]);
            }
        }

        // --- SERVICIOS ---
        $servicioCambioAceite = Service::create(['name' => 'Cambio de Aceite y Filtros', 'price' => 50.00]);
        Service::create(['name' => 'Diagnóstico General', 'price' => 30.00]);
        Service::create(['name' => 'Reparación de Tren Delantero', 'price' => 150.00]);

        // --- ÓRDENES DE TRABAJO DE PRUEBA ---
        $vehiculos = Vehiculo::all();
        $mecanico = User::where('email', 'mecanico@flipperbox.com')->first();
        $filtroAceite = Product::where('sku', 'J3393PA')->first();

        if ($vehiculos->count() > 0 && $mecanico && $filtroAceite && $servicioCambioAceite) {
            // --- Orden Completada (con ítems) ---
            $ordenCompletada = WorkOrder::create([
                'vehicle_id' => $vehiculos->random()->id,
                'mechanic_id' => $mecanico->id,
                'status' => 'Completada',
                'description' => 'Servicio completo de 50.000km.',
                'completion_date' => now(),
            ]);
            
            $ordenCompletada->products()->attach($filtroAceite->id, ['quantity' => 1, 'unit_price' => $filtroAceite->price]);
            $ordenCompletada->services()->attach($servicioCambioAceite->id, ['price' => $servicioCambioAceite->price]);
            
            $total = ($filtroAceite->price * 1) + $servicioCambioAceite->price;
            $ordenCompletada->update(['total' => $total]);

            // --- Orden en Progreso ---
            WorkOrder::create(['vehicle_id' => $vehiculos->random()->id, 'mechanic_id' => $mecanico->id, 'status' => 'En Progreso', 'description' => 'Revisión de tren delantero, ruido al girar.']);
            // --- Orden Pendiente ---
            WorkOrder::create(['vehicle_id' => $vehiculos->random()->id, 'status' => 'Pendiente', 'description' => 'Falla en el arranque, posible problema eléctrico.']);
        }
    }
}
</file>

</files>
